<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="author" content="The Khronos® Vulkan Working Group">
<title>Vulkan® 1.1.111 - A Specification (with KHR extensions)</title>
<style>
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: #fff; color: #222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.spread { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: black; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #0068b0; text-decoration: none; line-height: inherit; }
a:hover, a:focus { color: #333; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: Noto, sans-serif; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 0.75em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Noto, sans-serif; font-weight: normal; font-style: normal; color: black; text-rendering: optimizeLegibility; margin-top: 0.5em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #4d4d4d; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #ddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; color: #264357; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 0.75em; list-style-position: outside; font-family: Noto, sans-serif; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3em; font-weight: bold; }
dl dd { margin-bottom: 0.75em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: black; border-bottom: 1px dotted #ddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 0.75em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #ddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #5e93b8; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #5e93b8; }

blockquote, blockquote p { line-height: 1.6; color: #333; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #ddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: #fff; margin-bottom: 1.25em; border: solid 1px #d8d8ce; }
table thead, table tfoot { background: #eee; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #6d6e71; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f8f8f8; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

body { -moz-osx-font-smoothing: grayscale; -webkit-font-smoothing: antialiased; tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }

a:hover, a:focus { text-decoration: underline; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 0; background-color: transparent; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; word-wrap: break-word; }
*:not(pre) > code.nobreak { word-wrap: normal; }
*:not(pre) > code.nowrap { white-space: nowrap; }

pre, pre > code { line-height: 1.6; color: #264357; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }

em em { font-style: normal; }

strong strong { font-weight: normal; }

.keyseq { color: #333333; }

kbd { font-family: Consolas, "Liberation Mono", Courier, monospace; display: inline-block; color: black; font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -moz-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menuref { color: #000; }

.menuseq b:not(.caret), .menuref { font-weight: inherit; }

.menuseq { word-spacing: -0.02em; }
.menuseq b.caret { font-size: 1.25em; line-height: 0.8; }
.menuseq i.caret { font-weight: bold; text-align: center; width: 0.45em; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 1.5em; padding-right: 1.5em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: black; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #ddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #ddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #ddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #5e93b8; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #333; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #333; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; border-bottom: 1px solid #ddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 0 solid #ddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: Noto, sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: black; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #fff; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #ddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #ddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: #fff; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: none; padding: 1.25em; }

#footer-text { color: black; line-height: 1.44; }

#content { margin-bottom: 0.625em; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { #content { margin-bottom: 1.25em; }
  .sect1 { padding-bottom: 1.25em; } }
.sect1:last-child { padding-bottom: 0; }

.sect1 + .sect1 { border-top: 0 solid #ddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: black; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: black; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: black; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: initial; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: Noto, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #ddd; color: #5e93b8; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: #fff; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: #fff; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: black; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px hidden #666; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 1.25em 1.5625em 1.125em 1.5625em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eee; background-color: #264357; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 1.25em 1.5625em 1.125em 1.5625em; -webkit-border-radius: 0; border-radius: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; line-height: 1.6; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #ddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 0.75em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #333; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: black; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #5e93b8; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 0.75em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #333; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: #5e93b8; }

.quoteblock.abstract { margin: 0 0 0.75em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #d8d8ce; }

table.grid-all > thead > tr > .tableblock, table.grid-all > tbody > tr > .tableblock { border-width: 0 1px 1px 0; }

table.grid-all > tfoot > tr > .tableblock { border-width: 1px 1px 0 0; }

table.grid-cols > * > tr > .tableblock { border-width: 0 1px 0 0; }

table.grid-rows > thead > tr > .tableblock, table.grid-rows > tbody > tr > .tableblock { border-width: 0 0 1px 0; }

table.grid-rows > tfoot > tr > .tableblock { border-width: 1px 0 0 0; }

table.grid-all > * > tr > .tableblock:last-child, table.grid-cols > * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-all > tbody > tr:last-child > .tableblock, table.grid-all > thead:last-child > tr > .tableblock, table.grid-rows > tbody > tr:last-child > .tableblock, table.grid-rows > thead:last-child > tr > .tableblock { border-bottom-width: 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.4; background: #eee; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.375em; }

ul.checklist, ul.none, ol.none, ul.no-bullet, ol.no-bullet, ol.unnumbered, ul.unstyled, ol.unstyled { list-style-type: none; }

ul.no-bullet, ol.no-bullet, ol.unnumbered { margin-left: 0.625em; }

ul.unstyled, ol.unstyled { margin-left: 0; }

ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1.25em; font-size: 0.8em; position: relative; bottom: 0.125em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.inline { display: -ms-flexbox; display: -webkit-box; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; list-style: none; margin: 0 0 0.375em -0.75em; }

ul.inline > li { margin-left: 0.75em; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 0.75em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0.4em 0.75em 0 0.75em; line-height: 1; vertical-align: top; }
.colist > table tr > td:first-of-type img { max-width: initial; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px #fff; -webkit-box-shadow: 0 0 0 1px #ddd; box-shadow: 0 0 0 1px #ddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; margin-left: -1.05em; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }
a span.icon > .fa { cursor: inherit; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #29475c; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: black; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { border-bottom: 1px solid #ddd; }

.sect1 { padding-bottom: 0; }

#toctitle { color: #00406F; font-weight: normal; margin-top: 1.5em; }

.sidebarblock { border-color: #aaa; }

code { -webkit-border-radius: 4px; border-radius: 4px; }

p.tableblock.header { color: #6d6e71; }

.literalblock pre, .listingblock pre { background: #eee; }

/* From https://github.com/KhronosGroup/Vulkan-Docs/pull/901 */
a code { color: inherit; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<link rel="stylesheet" href="../katex/katex.min.css">
<link href="chunked.css?4" rel="stylesheet">
<script>var searchindexurl = 'search.index.js?4' + (document.title.replace(/[^0-9.]/g, ''));</script>
<script src="chunked.js?4"></script>
<script src="../katex/katex.min.js"></script>
<script src="../katex/contrib/auto-render.min.js"></script>
    <!-- Use KaTeX to render math once document is loaded, see
         https://github.com/Khan/KaTeX/tree/master/contrib/auto-render -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(
            document.body,
            {
                delimiters: [
                    { left: "$$", right: "$$", display: true},
                    { left: "\\[", right: "\\]", display: true},
                    { left: "$", right: "$", display: false},
                    { left: "\\(", right: "\\)", display: false}
                ]
            }
        );
    });
</script></head>
<body class="book toc2 toc-left" style="max-width: 100;">
<div id="header">
<h1>Vulkan<sup>®</sup> 1.1.111 - A Specification (with KHR extensions)</h1>
<div class="details">
<span id="author" class="author">The Khronos<sup>®</sup> Vulkan Working Group</span><br>
<span id="revnumber">version 1.1.111,</span>
<span id="revdate">2019-06-10 10:38:01Z</span>
<br><span id="revremark">from git branch: github-master commit: ad46c7dc688fe973ac7299b651403be5f562db8e</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1"><li><a href="index.html#preamble">0. Preamble</a></li></ul>
<ul class="sectlevel1">
<li><a href="chap1.html#introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="chap1.html#introduction-conventions">1.1. Document Conventions</a></li>
</ul>
</li>
<li><a href="chap2.html#fundamentals">2. Fundamentals</a>
<ul class="sectlevel2">
<li><a href="chap2.html#fundamentals-host-environment">2.1. Host and Device Environment</a></li>
<li><a href="chap2.html#fundamentals-execmodel">2.2. Execution Model</a></li>
<li><a href="chap2.html#fundamentals-objectmodel-overview">2.3. Object Model</a></li>
<li><a href="chap2.html#fundamentals-abi">2.4. Application Binary Interface</a></li>
<li><a href="chap2.html#fundamentals-commandsyntax">2.5. Command Syntax and Duration</a></li>
<li><a href="chap2.html#fundamentals-threadingbehavior">2.6. Threading Behavior</a></li>
<li><a href="chap2.html#fundamentals-errors">2.7. Errors</a></li>
<li><a href="chap2.html#fundamentals-numerics">2.8. Numeric Representation and Computation</a></li>
<li><a href="chap2.html#fundamentals-fixedconv">2.9. Fixed-Point Data Conversions</a></li>
<li><a href="chap2.html#fundamentals-common-objects">2.10. Common Object Types</a></li>
</ul>
</li>
<li><a href="chap3.html#initialization">3. Initialization</a>
<ul class="sectlevel2">
<li><a href="chap3.html#initialization-functionpointers">3.1. Command Function Pointers</a></li>
<li><a href="chap3.html#initialization-instances">3.2. Instances</a></li>
</ul>
</li>
<li><a href="chap4.html#devsandqueues">4. Devices and Queues</a>
<ul class="sectlevel2">
<li><a href="chap4.html#devsandqueues-physical-device-enumeration">4.1. Physical Devices</a></li>
<li><a href="chap4.html#devsandqueues-devices">4.2. Devices</a></li>
<li><a href="chap4.html#devsandqueues-queues">4.3. Queues</a></li>
</ul>
</li>
<li><a href="chap5.html#commandbuffers">5. Command Buffers</a>
<ul class="sectlevel2">
<li><a href="chap5.html#commandbuffers-lifecycle">5.1. Command Buffer Lifecycle</a></li>
<li><a href="chap5.html#commandbuffers-pools">5.2. Command Pools</a></li>
<li><a href="chap5.html#commandbuffer-allocation">5.3. Command Buffer Allocation and Management</a></li>
<li><a href="chap5.html#commandbuffers-recording">5.4. Command Buffer Recording</a></li>
<li><a href="chap5.html#commandbuffers-submission">5.5. Command Buffer Submission</a></li>
<li><a href="chap5.html#commandbuffers-submission-progress">5.6. Queue Forward Progress</a></li>
<li><a href="chap5.html#commandbuffers-secondary">5.7. Secondary Command Buffer Execution</a></li>
<li><a href="chap5.html#commandbuffers-devicemask">5.8. Command Buffer Device Mask</a></li>
</ul>
</li>
<li><a href="#synchronization">6. Synchronization and Cache Control</a>
<ul class="sectlevel2">
<li><a href="#synchronization-dependencies">6.1. Execution and Memory Dependencies</a></li>
<li><a href="#synchronization-implicit">6.2. Implicit Synchronization Guarantees</a></li>
<li><a href="#synchronization-fences">6.3. Fences</a></li>
<li><a href="#synchronization-semaphores">6.4. Semaphores</a></li>
<li><a href="#synchronization-events">6.5. Events</a></li>
<li><a href="#synchronization-pipeline-barriers">6.6. Pipeline Barriers</a></li>
<li><a href="#synchronization-memory-barriers">6.7. Memory Barriers</a></li>
<li><a href="#synchronization-wait-idle">6.8. Wait Idle Operations</a></li>
<li><a href="#synchronization-submission-host-writes">6.9. Host Write Ordering Guarantees</a></li>
<li><a href="#synchronization-device-group">6.10. Synchronization and Multiple Physical Devices</a></li>
</ul>
</li>
<li><a href="chap7.html#renderpass">7. Render Pass</a>
<ul class="sectlevel2">
<li><a href="chap7.html#renderpass-creation">7.1. Render Pass Creation</a></li>
<li><a href="chap7.html#renderpass-compatibility">7.2. Render Pass Compatibility</a></li>
<li><a href="chap7.html#_framebuffers">7.3. Framebuffers</a></li>
<li><a href="chap7.html#renderpass-commands">7.4. Render Pass Commands</a></li>
</ul>
</li>
<li><a href="chap8.html#shaders">8. Shaders</a>
<ul class="sectlevel2">
<li><a href="chap8.html#shader-modules">8.1. Shader Modules</a></li>
<li><a href="chap8.html#shaders-execution">8.2. Shader Execution</a></li>
<li><a href="chap8.html#shaders-execution-memory-ordering">8.3. Shader Memory Access Ordering</a></li>
<li><a href="chap8.html#shaders-inputs">8.4. Shader Inputs and Outputs</a></li>
<li><a href="chap8.html#shaders-vertex">8.5. Vertex Shaders</a></li>
<li><a href="chap8.html#shaders-tessellation-control">8.6. Tessellation Control Shaders</a></li>
<li><a href="chap8.html#shaders-tessellation-evaluation">8.7. Tessellation Evaluation Shaders</a></li>
<li><a href="chap8.html#shaders-geometry">8.8. Geometry Shaders</a></li>
<li><a href="chap8.html#shaders-fragment">8.9. Fragment Shaders</a></li>
<li><a href="chap8.html#shaders-compute">8.10. Compute Shaders</a></li>
<li><a href="chap8.html#shaders-interpolation-decorations">8.11. Interpolation Decorations</a></li>
<li><a href="chap8.html#shaders-staticuse">8.12. Static Use</a></li>
<li><a href="chap8.html#shaders-invocationgroups">8.13. Invocation and Derivative Groups</a></li>
<li><a href="chap8.html#shaders-subgroup">8.14. Subgroups</a></li>
</ul>
</li>
<li><a href="chap9.html#pipelines">9. Pipelines</a>
<ul class="sectlevel2">
<li><a href="chap9.html#pipelines-compute">9.1. Compute Pipelines</a></li>
<li><a href="chap9.html#pipelines-graphics">9.2. Graphics Pipelines</a></li>
<li><a href="chap9.html#pipelines-destruction">9.3. Pipeline destruction</a></li>
<li><a href="chap9.html#pipelines-multiple">9.4. Multiple Pipeline Creation</a></li>
<li><a href="chap9.html#pipelines-pipeline-derivatives">9.5. Pipeline Derivatives</a></li>
<li><a href="chap9.html#pipelines-cache">9.6. Pipeline Cache</a></li>
<li><a href="chap9.html#pipelines-specialization-constants">9.7. Specialization Constants</a></li>
<li><a href="chap9.html#pipelines-binding">9.8. Pipeline Binding</a></li>
<li><a href="chap9.html#pipelines-dynamic-state">9.9. Dynamic State</a></li>
</ul>
</li>
<li><a href="chap10.html#memory">10. Memory Allocation</a>
<ul class="sectlevel2">
<li><a href="chap10.html#memory-host">10.1. Host Memory</a></li>
<li><a href="chap10.html#memory-device">10.2. Device Memory</a></li>
</ul>
</li>
<li><a href="chap11.html#resources">11. Resource Creation</a>
<ul class="sectlevel2">
<li><a href="chap11.html#resources-buffers">11.1. Buffers</a></li>
<li><a href="chap11.html#resources-buffer-views">11.2. Buffer Views</a></li>
<li><a href="chap11.html#resources-images">11.3. Images</a></li>
<li><a href="chap11.html#resources-image-layouts">11.4. Image Layouts</a></li>
<li><a href="chap11.html#resources-image-views">11.5. Image Views</a></li>
<li><a href="chap11.html#resources-association">11.6. Resource Memory Association</a></li>
<li><a href="chap11.html#resources-sharing">11.7. Resource Sharing Mode</a></li>
<li><a href="chap11.html#resources-memory-aliasing">11.8. Memory Aliasing</a></li>
</ul>
</li>
<li><a href="chap12.html#samplers">12. Samplers</a>
<ul class="sectlevel2">
<li><a href="chap12.html#samplers-YCbCr-conversion">12.1. Sampler Y’C<sub>B</sub>C<sub>R</sub> conversion</a></li>
</ul>
</li>
<li><a href="chap13.html#descriptorsets">13. Resource Descriptors</a>
<ul class="sectlevel2">
<li><a href="chap13.html#descriptorsets-types">13.1. Descriptor Types</a></li>
<li><a href="chap13.html#descriptorsets-sets">13.2. Descriptor Sets</a></li>
</ul>
</li>
<li><a href="chap14.html#interfaces">14. Shader Interfaces</a>
<ul class="sectlevel2">
<li><a href="chap14.html#interfaces-iointerfaces">14.1. Shader Input and Output Interfaces</a></li>
<li><a href="chap14.html#interfaces-vertexinput">14.2. Vertex Input Interface</a></li>
<li><a href="chap14.html#interfaces-fragmentoutput">14.3. Fragment Output Interface</a></li>
<li><a href="chap14.html#interfaces-inputattachment">14.4. Fragment Input Attachment Interface</a></li>
<li><a href="chap14.html#interfaces-resources">14.5. Shader Resource Interface</a></li>
<li><a href="chap14.html#interfaces-builtin-variables">14.6. Built-In Variables</a></li>
</ul>
</li>
<li><a href="chap15.html#textures">15. Image Operations</a>
<ul class="sectlevel2">
<li><a href="chap15.html#_image_operations_overview">15.1. Image Operations Overview</a></li>
<li><a href="chap15.html#_conversion_formulas">15.2. Conversion Formulas</a></li>
<li><a href="chap15.html#_texel_input_operations">15.3. Texel Input Operations</a></li>
<li><a href="chap15.html#_texel_output_operations">15.4. Texel Output Operations</a></li>
<li><a href="chap15.html#texture-derivatives">15.5. Derivative Operations</a></li>
<li><a href="chap15.html#textures-normalized-operations">15.6. Normalized Texel Coordinate Operations</a></li>
<li><a href="chap15.html#_unnormalized_texel_coordinate_operations">15.7. Unnormalized Texel Coordinate Operations</a></li>
<li><a href="chap15.html#textures-integer-coordinate-operations">15.8. Integer Texel Coordinate Operations</a></li>
<li><a href="chap15.html#textures-sample-operations">15.9. Image Sample Operations</a></li>
<li><a href="chap15.html#textures-instructions">15.10. Image Operation Steps</a></li>
</ul>
</li>
<li><a href="chap16.html#queries">16. Queries</a>
<ul class="sectlevel2">
<li><a href="chap16.html#queries-pools">16.1. Query Pools</a></li>
<li><a href="chap16.html#queries-operation">16.2. Query Operation</a></li>
<li><a href="chap16.html#queries-occlusion">16.3. Occlusion Queries</a></li>
<li><a href="chap16.html#queries-pipestats">16.4. Pipeline Statistics Queries</a></li>
<li><a href="chap16.html#queries-timestamps">16.5. Timestamp Queries</a></li>
</ul>
</li>
<li><a href="chap17.html#clears">17. Clear Commands</a>
<ul class="sectlevel2">
<li><a href="chap17.html#clears-outside">17.1. Clearing Images Outside A Render Pass Instance</a></li>
<li><a href="chap17.html#clears-inside">17.2. Clearing Images Inside A Render Pass Instance</a></li>
<li><a href="chap17.html#clears-values">17.3. Clear Values</a></li>
<li><a href="chap17.html#clears-filling-buffers">17.4. Filling Buffers</a></li>
<li><a href="chap17.html#clears-updating-buffers">17.5. Updating Buffers</a></li>
</ul>
</li>
<li><a href="chap18.html#copies">18. Copy Commands</a>
<ul class="sectlevel2">
<li><a href="chap18.html#_common_operation">18.1. Common Operation</a></li>
<li><a href="chap18.html#copies-buffers">18.2. Copying Data Between Buffers</a></li>
<li><a href="chap18.html#copies-images">18.3. Copying Data Between Images</a></li>
<li><a href="chap18.html#copies-buffers-images">18.4. Copying Data Between Buffers and Images</a></li>
<li><a href="chap18.html#copies-imagescaling">18.5. Image Copies with Scaling</a></li>
<li><a href="chap18.html#copies-resolve">18.6. Resolving Multisample Images</a></li>
</ul>
</li>
<li><a href="chap19.html#drawing">19. Drawing Commands</a>
<ul class="sectlevel2">
<li><a href="chap19.html#drawing-primitive-topologies">19.1. Primitive Topologies</a></li>
<li><a href="chap19.html#drawing-primitive-order">19.2. Primitive Order</a></li>
<li><a href="chap19.html#drawing-primitive-shading">19.3. Programmable Primitive Shading</a></li>
</ul>
</li>
<li><a href="chap20.html#fxvertex">20. Fixed-Function Vertex Processing</a>
<ul class="sectlevel2">
<li><a href="chap20.html#fxvertex-attrib">20.1. Vertex Attributes</a></li>
<li><a href="chap20.html#fxvertex-input">20.2. Vertex Input Description</a></li>
<li><a href="chap20.html#fxvertex-example">20.3. Example</a></li>
</ul>
</li>
<li><a href="chap21.html#tessellation">21. Tessellation</a>
<ul class="sectlevel2">
<li><a href="chap21.html#_tessellator">21.1. Tessellator</a></li>
<li><a href="chap21.html#_tessellator_patch_discard">21.2. Tessellator Patch Discard</a></li>
<li><a href="chap21.html#tessellation-tessellator-spacing">21.3. Tessellator Spacing</a></li>
<li><a href="chap21.html#tessellation-primitive-order">21.4. Tessellation Primitive Ordering</a></li>
<li><a href="chap21.html#tessellation-vertex-winding-order">21.5. Tessellator Vertex Winding Order</a></li>
<li><a href="chap21.html#tessellation-triangle-tessellation">21.6. Triangle Tessellation</a></li>
<li><a href="chap21.html#tessellation-quad-tessellation">21.7. Quad Tessellation</a></li>
<li><a href="chap21.html#tessellation-isoline-tessellation">21.8. Isoline Tessellation</a></li>
<li><a href="chap21.html#tessellation-point-mode">21.9. Tessellation Point Mode</a></li>
<li><a href="chap21.html#_tessellation_pipeline_state">21.10. Tessellation Pipeline State</a></li>
</ul>
</li>
<li><a href="chap22.html#geometry">22. Geometry Shading</a>
<ul class="sectlevel2">
<li><a href="chap22.html#geometry-input">22.1. Geometry Shader Input Primitives</a></li>
<li><a href="chap22.html#geometry-output">22.2. Geometry Shader Output Primitives</a></li>
<li><a href="chap22.html#geometry-invocations">22.3. Multiple Invocations of Geometry Shaders</a></li>
<li><a href="chap22.html#geometry-ordering">22.4. Geometry Shader Primitive Ordering</a></li>
</ul>
</li>
<li><a href="chap23.html#vertexpostproc">23. Fixed-Function Vertex Post-Processing</a>
<ul class="sectlevel2">
<li><a href="chap23.html#vertexpostproc-flatshading">23.1. Flat Shading</a></li>
<li><a href="chap23.html#vertexpostproc-clipping">23.2. Primitive Clipping</a></li>
<li><a href="chap23.html#vertexpostproc-clipping-shader-outputs">23.3. Clipping Shader Outputs</a></li>
<li><a href="chap23.html#vertexpostproc-coord-transform">23.4. Coordinate Transformations</a></li>
<li><a href="chap23.html#vertexpostproc-viewport">23.5. Controlling the Viewport</a></li>
</ul>
</li>
<li><a href="chap24.html#primsrast">24. Rasterization</a>
<ul class="sectlevel2">
<li><a href="chap24.html#primsrast-discard">24.1. Discarding Primitives Before Rasterization</a></li>
<li><a href="chap24.html#primrast-order">24.2. Rasterization Order</a></li>
<li><a href="chap24.html#primsrast-multisampling">24.3. Multisampling</a></li>
<li><a href="chap24.html#primsrast-sampleshading">24.4. Sample Shading</a></li>
<li><a href="chap24.html#primsrast-points">24.5. Points</a></li>
<li><a href="chap24.html#primsrast-lines">24.6. Line Segments</a></li>
<li><a href="chap24.html#primsrast-polygons">24.7. Polygons</a></li>
</ul>
</li>
<li><a href="chap25.html#fragops">25. Fragment Operations</a>
<ul class="sectlevel2">
<li><a href="chap25.html#fragops-early">25.1. Early Per-Fragment Tests</a></li>
<li><a href="chap25.html#fragops-scissor">25.2. Scissor Test</a></li>
<li><a href="chap25.html#fragops-samplemask">25.3. Sample Mask</a></li>
<li><a href="chap25.html#fragops-early-mode">25.4. Early Fragment Test Mode</a></li>
<li><a href="chap25.html#fragops-late">25.5. Late Per-Fragment Tests</a></li>
<li><a href="chap25.html#fragops-covg">25.6. Multisample Coverage</a></li>
<li><a href="chap25.html#fragops-ds-state">25.7. Depth and Stencil Operations</a></li>
<li><a href="chap25.html#fragops-dbt">25.8. Depth Bounds Test</a></li>
<li><a href="chap25.html#fragops-stencil">25.9. Stencil Test</a></li>
<li><a href="chap25.html#fragops-depth">25.10. Depth Test</a></li>
<li><a href="chap25.html#fragops-samplecount">25.11. Sample Counting</a></li>
<li><a href="chap25.html#fragops-coverage-reduction">25.12. Coverage Reduction</a></li>
</ul>
</li>
<li><a href="chap26.html#framebuffer">26. The Framebuffer</a>
<ul class="sectlevel2">
<li><a href="chap26.html#framebuffer-blending">26.1. Blending</a></li>
<li><a href="chap26.html#framebuffer-logicop">26.2. Logical Operations</a></li>
<li><a href="chap26.html#framebuffer-color-write-mask">26.3. Color Write Mask</a></li>
</ul>
</li>
<li><a href="chap27.html#dispatch">27. Dispatching Commands</a></li>
<li><a href="chap28.html#sparsememory">28. Sparse Resources</a>
<ul class="sectlevel2">
<li><a href="chap28.html#sparsememory-sparseresourcefeatures">28.1. Sparse Resource Features</a></li>
<li><a href="chap28.html#sparsememory-fully-resident">28.2. Sparse Buffers and Fully-Resident Images</a></li>
<li><a href="chap28.html#sparsememory-partially-resident-buffers">28.3. Sparse Partially-Resident Buffers</a></li>
<li><a href="chap28.html#sparsememory-partially-resident-images">28.4. Sparse Partially-Resident Images</a></li>
<li><a href="chap28.html#sparsememory-sparse-memory-aliasing">28.5. Sparse Memory Aliasing</a></li>
<li><a href="chap28.html#_sparse_resource_implementation_guidelines">28.6. Sparse Resource Implementation Guidelines</a></li>
<li><a href="chap28.html#sparsememory-resourceapi">28.7. Sparse Resource API</a></li>
<li><a href="chap28.html#sparsememory-examples">28.8. Examples</a></li>
</ul>
</li>
<li><a href="chap29.html#wsi">29. Window System Integration (WSI)</a>
<ul class="sectlevel2">
<li><a href="chap29.html#_wsi_platform">29.1. WSI Platform</a></li>
<li><a href="chap29.html#_wsi_surface">29.2. WSI Surface</a></li>
<li><a href="chap29.html#display">29.3. Presenting Directly to Display Devices</a></li>
<li><a href="chap29.html#_querying_for_wsi_support">29.4. Querying for WSI Support</a></li>
<li><a href="chap29.html#_surface_queries">29.5. Surface Queries</a></li>
<li><a href="chap29.html#_device_group_queries">29.6. Device Group Queries</a></li>
<li><a href="chap29.html#_wsi_swapchain">29.7. WSI Swapchain</a></li>
</ul>
</li>
<li><a href="chap30.html#extendingvulkan">30. Extending Vulkan</a>
<ul class="sectlevel2">
<li><a href="chap30.html#extendingvulkan-instanceanddevicefunctionality">30.1. Instance and Device Functionality</a></li>
<li><a href="chap30.html#extendingvulkan-coreversions">30.2. Core Versions</a></li>
<li><a href="chap30.html#extendingvulkan-layers">30.3. Layers</a></li>
<li><a href="chap30.html#extendingvulkan-extensions">30.4. Extensions</a></li>
<li><a href="chap30.html#extendingvulkan-extensions-extensiondependencies">30.5. Extension Dependencies</a></li>
<li><a href="chap30.html#_compatibility_guarantees_informative">30.6. Compatibility Guarantees (Informative)</a></li>
</ul>
</li>
<li><a href="chap31.html#features">31. Features</a>
<ul class="sectlevel2">
<li><a href="chap31.html#features-requirements">31.1. Feature Requirements</a></li>
</ul>
</li>
<li><a href="chap32.html#limits">32. Limits</a>
<ul class="sectlevel2">
<li><a href="chap32.html#limits-minmax">32.1. Limit Requirements</a></li>
</ul>
</li>
<li><a href="chap33.html#formats">33. Formats</a>
<ul class="sectlevel2">
<li><a href="chap33.html#formats-definition">33.1. Format Definition</a></li>
<li><a href="chap33.html#formats-properties">33.2. Format Properties</a></li>
<li><a href="chap33.html#features-required-format-support">33.3. Required Format Support</a></li>
</ul>
</li>
<li><a href="chap34.html#capabilities">34. Additional Capabilities</a>
<ul class="sectlevel2">
<li><a href="chap34.html#capabilities-image">34.1. Additional Image Capabilities</a></li>
<li><a href="chap34.html#capabilities-buffer">34.2. Additional Buffer Capabilities</a></li>
<li><a href="chap34.html#capabilities-semaphore">34.3. Optional Semaphore Capabilities</a></li>
<li><a href="chap34.html#capabilities-fence">34.4. Optional Fence Capabilities</a></li>
</ul>
</li>
<li><a href="chap35.html#_debugging">35. Debugging</a></li>
<li><a href="chap36.html#spirvenv">Appendix A: Vulkan Environment for SPIR-V</a>
<ul class="sectlevel2">
<li><a href="chap36.html#_versions_and_formats">Versions and Formats</a></li>
<li><a href="chap36.html#spirvenv-capabilities">Capabilities</a></li>
<li><a href="chap36.html#spirvenv-module-validation">Validation Rules within a Module</a></li>
<li><a href="chap36.html#spirvenv-precision-operation">Precision and Operation of SPIR-V Instructions</a></li>
<li><a href="chap36.html#spirvenv-image-formats">Compatibility Between SPIR-V Image Formats And Vulkan Formats</a></li>
</ul>
</li>
<li><a href="chap37.html#memory-model">Appendix B: Memory Model</a>
<ul class="sectlevel2">
<li><a href="chap37.html#memory-model-agent">Agent</a></li>
<li><a href="chap37.html#memory-model-memory-location">Memory Location</a></li>
<li><a href="chap37.html#memory-model-allocation">Allocation</a></li>
<li><a href="chap37.html#memory-model-memory-operation">Memory Operation</a></li>
<li><a href="chap37.html#memory-model-references">Reference</a></li>
<li><a href="chap37.html#memory-model-program-order">Program-Order</a></li>
<li><a href="chap37.html#memory-model-scope">Scope</a></li>
<li><a href="chap37.html#memory-model-atomic-operation">Atomic Operation</a></li>
<li><a href="chap37.html#memory-model-scoped-modification-order">Scoped Modification Order</a></li>
<li><a href="chap37.html#memory-model-memory-semantics">Memory Semantics</a></li>
<li><a href="chap37.html#memory-model-release-sequence">Release Sequence</a></li>
<li><a href="chap37.html#memory-model-synchronizes-with">Synchronizes-With</a></li>
<li><a href="chap37.html#memory-model-system-synchronizes-with">System-Synchronizes-With</a></li>
<li><a href="chap37.html#memory-model-non-private">Private vs. Non-Private</a></li>
<li><a href="chap37.html#memory-model-inter-thread-happens-before">Inter-Thread-Happens-Before</a></li>
<li><a href="chap37.html#memory-model-happens-before">Happens-Before</a></li>
<li><a href="chap37.html#memory-model-availability-visibility">Availability and Visibility</a></li>
<li><a href="chap37.html#memory-model-vulkan-availability-visibility">Availability, Visibility, and Domain Operations</a></li>
<li><a href="chap37.html#memory-model-availability-visibility-semantics">Availability and Visibility Semantics</a></li>
<li><a href="chap37.html#memory-model-instruction-av-vis">Per-Instruction Availability and Visibility Semantics</a></li>
<li><a href="chap37.html#memory-model-location-ordered">Location-Ordered</a></li>
<li><a href="chap37.html#memory-model-access-data-race">Data Race</a></li>
<li><a href="chap37.html#memory-model-visible-to">Visible-To</a></li>
<li><a href="chap37.html#memory-model-acyclicity">Acyclicity</a></li>
<li><a href="chap37.html#memory-model-shader-io">Shader I/O</a></li>
<li><a href="chap37.html#memory-model-deallocation">Deallocation</a></li>
<li><a href="chap37.html#memory-model-informative-descriptions">Informative Descriptions</a></li>
<li><a href="chap37.html#memory-model-tessellation-output-ordering">Tessellation Output Ordering</a></li>
</ul>
</li>
<li><a href="chap38.html#_compressed_image_formats">Appendix C: Compressed Image Formats</a>
<ul class="sectlevel2">
<li><a href="chap38.html#appendix-compressedtex-bc">Block-Compressed Image Formats</a></li>
<li><a href="chap38.html#appendix-compressedtex-etc2">ETC Compressed Image Formats</a></li>
<li><a href="chap38.html#appendix-compressedtex-astc">ASTC Compressed Image Formats</a></li>
</ul>
</li>
<li><a href="chap39.html#versions">Appendix D: Core Revisions (Informative)</a>
<ul class="sectlevel2">
<li><a href="chap39.html#versions-1.1">Version 1.1</a></li>
</ul>
</li>
<li><a href="chap40.html#extensions">Appendix E: Layers &amp; Extensions (Informative)</a>
<ul class="sectlevel2">
<li><a href="chap40.html#extension-appendices-list">List of Current Extensions</a></li>
<li><a href="chap40.html#provisional-extension-appendices-list">List of Provisional Extensions</a></li>
<li><a href="chap40.html#deprecated-extension-appendices-list">List of Deprecated Extensions</a></li>
</ul>
</li>
<li><a href="chap41.html#boilerplate">Appendix F: API Boilerplate</a>
<ul class="sectlevel2">
<li><a href="chap41.html#boilerplate-headers">Vulkan Header Files</a></li>
<li><a href="chap41.html#boilerplate-wsi-header">Window System-Specific Header Control (Informative)</a></li>
</ul>
</li>
<li><a href="chap42.html#invariance">Appendix G: Invariance</a>
<ul class="sectlevel2">
<li><a href="chap42.html#_repeatability">Repeatability</a></li>
<li><a href="chap42.html#_multi_pass_algorithms">Multi-pass Algorithms</a></li>
<li><a href="chap42.html#_invariance_rules">Invariance Rules</a></li>
<li><a href="chap42.html#_tessellation_invariance">Tessellation Invariance</a></li>
</ul>
</li>
<li><a href="chap43.html#glossary">Glossary</a></li>
<li><a href="chap44.html#_common_abbreviations">Common Abbreviations</a></li>
<li><a href="chap45.html#_prefixes">Prefixes</a></li>
<li><a href="chap46.html#credits">Appendix H: Credits (Informative)</a>
<ul class="sectlevel2">
<li><a href="chap46.html#_working_group_contributors_to_vulkan_1_1_and_1_0">Working Group Contributors to Vulkan 1.1 and 1.0</a></li>
<li><a href="chap46.html#_working_group_contributors_to_vulkan_1_1">Working Group Contributors to Vulkan 1.1</a></li>
<li><a href="chap46.html#_working_group_contributors_to_vulkan_1_0">Working Group Contributors to Vulkan 1.0</a></li>
<li><a href="chap46.html#_other_credits">Other Credits</a></li>
</ul>
</li>
</ul>
</div>
<div class="searchbox"><label for="searchbox">Search: </label><input id="searchbox" type="text" disabled="disabled" value="Loading Search Data"><div id="resultsdiv"><ol id="results"></ol></div></div>
</div>
<div id="content"><div class="sect1">
<h2 id="synchronization">6. Synchronization and Cache Control</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Synchronization of access to resources is primarily the responsibility of
the application in Vulkan.
The order of execution of commands with respect to the host and other
commands on the device has few implicit guarantees, and needs to be
explicitly specified.
Memory caches and other optimizations are also explicitly managed, requiring
that the flow of data through the system is largely under application
control.</p>
</div>
<div class="paragraph">
<p>Whilst some implicit guarantees exist between commands, five explicit
synchronization mechanisms are exposed by Vulkan:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#synchronization-fences">Fences</a></dt>
<dd>
<p>Fences <strong class="purple">can</strong> be used to communicate to the host that execution of some
task on the device has completed.</p>
</dd>
<dt class="hdlist1"><a href="#synchronization-semaphores">Semaphores</a></dt>
<dd>
<p>Semaphores <strong class="purple">can</strong> be used to control resource access across multiple
queues.</p>
</dd>
<dt class="hdlist1"><a href="#synchronization-events">Events</a></dt>
<dd>
<p>Events provide a fine-grained synchronization primitive which <strong class="purple">can</strong> be
signaled either within a command buffer or by the host, and <strong class="purple">can</strong> be
waited upon within a command buffer or queried on the host.</p>
</dd>
<dt class="hdlist1"><a href="#synchronization-pipeline-barriers">Pipeline Barriers</a></dt>
<dd>
<p>Pipeline barriers also provide synchronization control within a command
buffer, but at a single point, rather than with separate signal and wait
operations.</p>
</dd>
<dt class="hdlist1"><a href="chap7.html#renderpass">Render Passes</a></dt>
<dd>
<p>Render passes provide a useful synchronization framework for most
rendering tasks, built upon the concepts in this chapter.
Many cases that would otherwise need an application to use other
synchronization primitives <strong class="purple">can</strong> be expressed more efficiently as part of
a render pass.</p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="synchronization-dependencies">6.1. Execution and Memory Dependencies</h3>
<div class="paragraph">
<p>An <em>operation</em> is an arbitrary amount of work to be executed on the host, a
device, or an external entity such as a presentation engine.
Synchronization commands introduce explicit <em>execution dependencies</em>, and
<em>memory dependencies</em> between two sets of operations defined by the
command’s two <em>synchronization scopes</em>.</p>
</div>
<div id="synchronization-dependencies-scopes" class="paragraph">
<p>The synchronization scopes define which other operations a synchronization
command is able to create execution dependencies with.
Any type of operation that is not in a synchronization command’s
synchronization scopes will not be included in the resulting dependency.
For example, for many synchronization commands, the synchronization scopes
<strong class="purple">can</strong> be limited to just operations executing in specific
<a href="#synchronization-pipeline-stages">pipeline stages</a>, which allows other
pipeline stages to be excluded from a dependency.
Other scoping options are possible, depending on the particular command.</p>
</div>
<div id="synchronization-dependencies-execution" class="paragraph">
<p>An <em>execution dependency</em> is a guarantee that for two sets of operations,
the first set <strong class="purple">must</strong> <em>happen-before</em> the second set.
If an operation happens-before another operation, then the first operation
<strong class="purple">must</strong> complete before the second operation is initiated.
More precisely:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Let <strong>A</strong> and <strong>B</strong> be separate sets of operations.</p>
</li>
<li>
<p>Let <strong>S</strong> be a synchronization command.</p>
</li>
<li>
<p>Let <strong>A<sub>S</sub></strong> and <strong>B<sub>S</sub></strong> be the synchronization scopes of <strong>S</strong>.</p>
</li>
<li>
<p>Let <strong>A'</strong> be the intersection of sets <strong>A</strong> and <strong>A<sub>S</sub></strong>.</p>
</li>
<li>
<p>Let <strong>B'</strong> be the intersection of sets <strong>B</strong> and <strong>B<sub>S</sub></strong>.</p>
</li>
<li>
<p>Submitting <strong>A</strong>, <strong>S</strong> and <strong>B</strong> for execution, in that order, will result in
execution dependency <strong>E</strong> between <strong>A'</strong> and <strong>B'</strong>.</p>
</li>
<li>
<p>Execution dependency <strong>E</strong> guarantees that <strong>A'</strong> happens-before <strong>B'</strong>.</p>
</li>
</ul>
</div>
<div id="synchronization-dependencies-chains" class="paragraph">
<p>An <em>execution dependency chain</em> is a sequence of execution dependencies that
form a happens-before relation between the first dependency’s <strong>A'</strong> and the
final dependency’s <strong>B'</strong>.
For each consecutive pair of execution dependencies, a chain exists if the
intersection of <strong>B<sub>S</sub></strong> in the first dependency and <strong>A<sub>S</sub></strong> in the second
dependency is not an empty set.
The formation of a single execution dependency from an execution dependency
chain can be described by substituting the following in the description of
execution dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Let <strong>S</strong> be a set of synchronization commands that generate an execution
dependency chain.</p>
</li>
<li>
<p>Let <strong>A<sub>S</sub></strong> be the first synchronization scope of the first command in
<strong>S</strong>.</p>
</li>
<li>
<p>Let <strong>B<sub>S</sub></strong> be the second synchronization scope of the last command in
<strong>S</strong>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>An execution dependency is inherently also multiple execution dependencies -
a dependency exists between each subset of <strong>A'</strong> and each subset of <strong>B'</strong>, and
the same is true for execution dependency chains.
For example, a synchronization command with multiple
<a href="#synchronization-pipeline-stages">pipeline stages</a> in its stage masks
effectively generates one dependency between each source stage and each
destination stage.
This can be useful to think about when considering how execution chains are
formed if they do not involve all parts of a synchronization command’s
dependency.
Similarly, any set of adjacent dependencies in an execution dependency chain
<strong class="purple">can</strong> be considered an execution dependency chain in its own right.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Execution dependencies alone are not sufficient to guarantee that values
resulting from writes in one set of operations <strong class="purple">can</strong> be read from another set
of operations.</p>
</div>
<div id="synchronization-dependencies-available-and-visible" class="paragraph">
<p>Three additional types of operation are used to control memory access.
<em>Availability operations</em> cause the values generated by specified memory
write accesses to become <em>available</em> to a memory domain for future access.
Any available value remains available until a subsequent write to the same
memory location occurs (whether it is made available or not) or the memory
is freed.
<em>Memory domain operations</em> cause writes that are available to a source
memory domain to become available to a destination memory domain (an example
of this is making writes available to the host domain available to the
device domain).
<em>Visibility operations</em> cause values available to a memory domain to become
<em>visible</em> to specified memory accesses.</p>
</div>
<div class="paragraph">
<p>Availability, visibility, memory domains, and memory domain operations are
formally defined in the <a href="chap37.html#memory-model-availability-visibility">Availability
and Visibility</a> section of the <a href="chap37.html#memory-model">Memory Model</a> chapter.
Which API operations perform each of these operations is defined in
<a href="chap37.html#memory-model-vulkan-availability-visibility">Availability, Visibility, and
Domain Operations</a>.</p>
</div>
<div id="synchronization-dependencies-memory" class="paragraph">
<p>A <em>memory dependency</em> is an execution dependency which includes availability
and visibility operations such that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first set of operations happens-before the availability operation.</p>
</li>
<li>
<p>The availability operation happens-before the visibility operation.</p>
</li>
<li>
<p>The visibility operation happens-before the second set of operations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once written values are made visible to a particular type of memory access,
they <strong class="purple">can</strong> be read or written by that type of memory access.
Most synchronization commands in Vulkan define a memory dependency.</p>
</div>
<div id="synchronization-dependencies-access-scopes" class="paragraph">
<p>The specific memory accesses that are made available and visible are defined
by the <em>access scopes</em> of a memory dependency.
Any type of access that is in a memory dependency’s first access scope and
occurs in <strong>A'</strong> is made available.
Any type of access that is in a memory dependency’s second access scope and
occurs in <strong>B'</strong> has any available writes made visible to it.
Any type of operation that is not in a synchronization command’s access
scopes will not be included in the resulting dependency.</p>
</div>
<div class="paragraph">
<p>A memory dependency enforces availability and visibility of memory accesses
and execution order between two sets of operations.
Adding to the description of <a href="#synchronization-dependencies-chains">execution dependency chains</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Let <strong>a</strong> be the set of memory accesses performed by <strong>A'</strong>.</p>
</li>
<li>
<p>Let <strong>b</strong> be the set of memory accesses performed by <strong>B'</strong>.</p>
</li>
<li>
<p>Let <strong>a<sub>S</sub></strong> be the first access scope of the first command in <strong>S</strong>.</p>
</li>
<li>
<p>Let <strong>b<sub>S</sub></strong> be the second access scope of the last command in <strong>S</strong>.</p>
</li>
<li>
<p>Let <strong>a'</strong> be the intersection of sets <strong>a</strong> and <strong>a<sub>S</sub></strong>.</p>
</li>
<li>
<p>Let <strong>b'</strong> be the intersection of sets <strong>b</strong> and <strong>b<sub>S</sub></strong>.</p>
</li>
<li>
<p>Submitting <strong>A</strong>, <strong>S</strong> and <strong>B</strong> for execution, in that order, will result in
a memory dependency <strong>m</strong> between <strong>A'</strong> and <strong>B'</strong>.</p>
</li>
<li>
<p>Memory dependency <strong>m</strong> guarantees that:</p>
<div class="ulist">
<ul>
<li>
<p>Memory writes in <strong>a'</strong> are made available.</p>
</li>
<li>
<p>Available memory writes, including those from <strong>a'</strong>, are made visible to
<strong>b'</strong>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Execution and memory dependencies are used to solve data hazards, i.e. to
ensure that read and write operations occur in a well-defined order.
Write-after-read hazards can be solved with just an execution dependency,
but read-after-write and write-after-write hazards need appropriate memory
dependencies to be included between them.
If an application does not include dependencies to solve these hazards, the
results and execution orders of memory accesses are undefined.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="synchronization-image-layout-transitions">6.1.1. Image Layout Transitions</h4>
<div class="paragraph">
<p>Image subresources <strong class="purple">can</strong> be transitioned from one <a href="chap11.html#resources-image-layouts">layout</a> to another as part of a <a href="#synchronization-dependencies-memory">memory dependency</a> (e.g. by using an
<a href="#synchronization-image-memory-barriers">image memory barrier</a>).
When a layout transition is specified in a memory dependency, it
happens-after the availability operations in the memory dependency, and
happens-before the visibility operations.
Image layout transitions <strong class="purple">may</strong> perform read and write accesses on all memory
bound to the image subresource range, so applications <strong class="purple">must</strong> ensure that all
memory writes have been made
<a href="#synchronization-dependencies-available-and-visible">available</a> before a
layout transition is executed.
Available memory is automatically made visible to a layout transition, and
writes performed by a layout transition are automatically made available.</p>
</div>
<div class="paragraph">
<p>Layout transitions always apply to a particular image subresource range, and
specify both an old layout and new layout.
If the old layout does not match the new layout, a transition occurs.
The old layout <strong class="purple">must</strong> match the current layout of the image subresource
range, with one exception.
The old layout <strong class="purple">can</strong> always be specified as <code>VK_IMAGE_LAYOUT_UNDEFINED</code>,
though doing so invalidates the contents of the image subresource range.</p>
</div>
<div class="paragraph">
<p>As image layout transitions <strong class="purple">may</strong> perform read and write accesses on the
memory bound to the image, if the image subresource affected by the layout
transition is bound to peer memory for any device in the current device mask
then the memory heap the bound memory comes from <strong class="purple">must</strong> support the
<code>VK_PEER_MEMORY_FEATURE_GENERIC_SRC_BIT</code> and
<code>VK_PEER_MEMORY_FEATURE_GENERIC_DST_BIT</code> capabilities as returned by
<a href="chap10.html#vkGetDeviceGroupPeerMemoryFeatures">vkGetDeviceGroupPeerMemoryFeatures</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Setting the old layout to <code>VK_IMAGE_LAYOUT_UNDEFINED</code> implies that the
contents of the image subresource need not be preserved.
Implementations <strong class="purple">may</strong> use this information to avoid performing expensive data
transition operations.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Applications <strong class="purple">must</strong> ensure that layout transitions happen-after all
operations accessing the image with the old layout, and happen-before any
operations that will access the image with the new layout.
Layout transitions are potentially read/write operations, so not defining
appropriate memory dependencies to guarantee this will result in a data
race.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Image layout transitions interact with <a href="chap11.html#resources-memory-aliasing">memory
aliasing</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="synchronization-pipeline-stages">6.1.2. Pipeline Stages</h4>
<div class="paragraph">
<p>The work performed by an <a href="chap2.html#fundamentals-queueoperation-command-types">action
or synchronization command</a> consists of multiple operations, which are
performed as a sequence of logically independent steps known as <em>pipeline
stages</em>.
The exact pipeline stages executed depend on the particular command that is
used, and current command buffer state when the command was recorded.
<a href="chap19.html#drawing">Drawing commands</a>, <a href="chap27.html#dispatch">dispatching commands</a>,
<a href="chap18.html#copies">copy commands</a>, <a href="chap17.html#clears">clear commands</a>, and <a href="#synchronization">synchronization commands</a> all execute in different sets of
<a href="#synchronization-pipeline-stages-types">pipeline stages</a>.
<a href="#synchronization">Synchronization commands</a> do not execute in a defined
pipeline, but do execute <code>VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT</code> and
<code>VK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BIT</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Operations performed by synchronization commands (e.g.
<a href="#synchronization-dependencies-available-and-visible">availability and
visibility operations</a>) are not executed by a defined pipeline stage.
However other commands can still synchronize with them via the
<code>VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT</code> and
<code>VK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BIT</code> pipeline stages.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Execution of operations across pipeline stages <strong class="purple">must</strong> adhere to
<a href="#synchronization-implicit">implicit ordering guarantees</a>, particularly
including <a href="#synchronization-pipeline-stages-order">pipeline stage order</a>.
Otherwise, execution across pipeline stages <strong class="purple">may</strong> overlap or execute out of
order with regards to other stages, unless otherwise enforced by an
execution dependency.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Several of the synchronization commands include pipeline stage parameters,
restricting the <a href="#synchronization-dependencies-scopes">synchronization
scopes</a> for that command to just those stages.
This allows fine grained control over the exact execution dependencies and
accesses performed by action commands.
Implementations <strong class="purple">should</strong> use these pipeline stages to avoid unnecessary
stalls or cache flushing.</p>
</div>
<div class="paragraph">
<p>Bits which can be set, specifying pipeline stages, are:</p>
</div>
<div id="VkPipelineStageFlagBits" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">enum</span> VkPipelineStageFlagBits {
    VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT = <span class="hex">0x00000001</span>,
    VK_PIPELINE_STAGE_DRAW_INDIRECT_BIT = <span class="hex">0x00000002</span>,
    VK_PIPELINE_STAGE_VERTEX_INPUT_BIT = <span class="hex">0x00000004</span>,
    VK_PIPELINE_STAGE_VERTEX_SHADER_BIT = <span class="hex">0x00000008</span>,
    VK_PIPELINE_STAGE_TESSELLATION_CONTROL_SHADER_BIT = <span class="hex">0x00000010</span>,
    VK_PIPELINE_STAGE_TESSELLATION_EVALUATION_SHADER_BIT = <span class="hex">0x00000020</span>,
    VK_PIPELINE_STAGE_GEOMETRY_SHADER_BIT = <span class="hex">0x00000040</span>,
    VK_PIPELINE_STAGE_FRAGMENT_SHADER_BIT = <span class="hex">0x00000080</span>,
    VK_PIPELINE_STAGE_EARLY_FRAGMENT_TESTS_BIT = <span class="hex">0x00000100</span>,
    VK_PIPELINE_STAGE_LATE_FRAGMENT_TESTS_BIT = <span class="hex">0x00000200</span>,
    VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT = <span class="hex">0x00000400</span>,
    VK_PIPELINE_STAGE_COMPUTE_SHADER_BIT = <span class="hex">0x00000800</span>,
    VK_PIPELINE_STAGE_TRANSFER_BIT = <span class="hex">0x00001000</span>,
    VK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BIT = <span class="hex">0x00002000</span>,
    VK_PIPELINE_STAGE_HOST_BIT = <span class="hex">0x00004000</span>,
    VK_PIPELINE_STAGE_ALL_GRAPHICS_BIT = <span class="hex">0x00008000</span>,
    VK_PIPELINE_STAGE_ALL_COMMANDS_BIT = <span class="hex">0x00010000</span>,
    VK_PIPELINE_STAGE_FLAG_BITS_MAX_ENUM = <span class="hex">0x7FFFFFFF</span>
} VkPipelineStageFlagBits;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT</code> specifies the stage of the
pipeline where any commands are initially received by the queue.</p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_DRAW_INDIRECT_BIT</code> specifies the stage of the
pipeline where Draw/DispatchIndirect data structures are consumed.</p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_VERTEX_INPUT_BIT</code> specifies the stage of the
pipeline where vertex and index buffers are consumed.</p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_VERTEX_SHADER_BIT</code> specifies the vertex shader
stage.</p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_TESSELLATION_CONTROL_SHADER_BIT</code> specifies the
tessellation control shader stage.</p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_TESSELLATION_EVALUATION_SHADER_BIT</code> specifies the
tessellation evaluation shader stage.</p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_GEOMETRY_SHADER_BIT</code> specifies the geometry
shader stage.</p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_FRAGMENT_SHADER_BIT</code> specifies the fragment
shader stage.</p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_EARLY_FRAGMENT_TESTS_BIT</code> specifies the stage of
the pipeline where early fragment tests (depth and stencil tests before
fragment shading) are performed.
This stage also includes <a href="chap7.html#renderpass-load-store-ops">subpass load
operations</a> for framebuffer attachments with a depth/stencil format.</p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_LATE_FRAGMENT_TESTS_BIT</code> specifies the stage of
the pipeline where late fragment tests (depth and stencil tests after
fragment shading) are performed.
This stage also includes <a href="chap7.html#renderpass-load-store-ops">subpass store
operations</a> for framebuffer attachments with a depth/stencil format.</p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT</code> specifies the stage
of the pipeline after blending where the final color values are output
from the pipeline.
This stage also includes <a href="chap7.html#renderpass-load-store-ops">subpass load and
store operations</a> and multisample resolve operations for framebuffer
attachments with a color
or depth/stencil
format.</p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_COMPUTE_SHADER_BIT</code> specifies the execution of a
compute shader.</p>
</li>
<li>
<p><a id="synchronization-pipeline-stages-transfer"></a>
<code>VK_PIPELINE_STAGE_TRANSFER_BIT</code> specifies the execution of copy
commands.
This includes the operations resulting from all <a href="chap18.html#copies">copy
commands</a>, <a href="chap17.html#clears">clear commands</a> (with the exception of
<a href="chap17.html#vkCmdClearAttachments">vkCmdClearAttachments</a>), and <a href="chap16.html#vkCmdCopyQueryPoolResults">vkCmdCopyQueryPoolResults</a>.</p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BIT</code> specifies the final stage in
the pipeline where operations generated by all commands complete
execution.</p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_HOST_BIT</code> specifies a pseudo-stage indicating
execution on the host of reads/writes of device memory.
This stage is not invoked by any commands recorded in a command buffer.</p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_ALL_GRAPHICS_BIT</code> specifies the execution of all
graphics pipeline stages, and is equivalent to the logical OR of:</p>
<div class="ulist">
<ul>
<li>
<p><code>VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_DRAW_INDIRECT_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_VERTEX_INPUT_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_VERTEX_SHADER_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_TESSELLATION_CONTROL_SHADER_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_TESSELLATION_EVALUATION_SHADER_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_GEOMETRY_SHADER_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_FRAGMENT_SHADER_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_EARLY_FRAGMENT_TESTS_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_LATE_FRAGMENT_TESTS_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BIT</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_ALL_COMMANDS_BIT</code> is equivalent to the logical OR
of every other pipeline stage flag that is supported on the queue it is
used with.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>An execution dependency with only <code>VK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BIT</code>
in the destination stage mask will only prevent that stage from executing in
subsequently submitted commands.
As this stage does not perform any actual execution, this is not observable
- in effect, it does not delay processing of subsequent commands.
Similarly an execution dependency with only
<code>VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT</code> in the source stage mask will
effectively not wait for any prior commands to complete.</p>
</div>
<div class="paragraph">
<p>When defining a memory dependency, using only
<code>VK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BIT</code> or
<code>VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT</code> would never make any accesses
available and/or visible because these stages do not access memory.</p>
</div>
<div class="paragraph">
<p><code>VK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BIT</code> and
<code>VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT</code> are useful for accomplishing layout
transitions and queue ownership operations when the required execution
dependency is satisfied by other means - for example, semaphore operations
between queues.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkPipelineStageFlags" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> VkFlags VkPipelineStageFlags;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkPipelineStageFlags</code> is a bitmask type for setting a mask of zero or
more <a href="#VkPipelineStageFlagBits">VkPipelineStageFlagBits</a>.</p>
</div>
</div>
</div>
<div id="synchronization-pipeline-stages-masks" class="paragraph">
<p>If a synchronization command includes a source stage mask, its first
<a href="#synchronization-dependencies-scopes">synchronization scope</a> only includes
execution of the pipeline stages specified in that mask, and its first
<a href="#synchronization-dependencies-access-scopes">access scope</a> only includes
memory access performed by pipeline stages specified in that mask.
If a synchronization command includes a destination stage mask, its second
<a href="#synchronization-dependencies-scopes">synchronization scope</a> only includes
execution of the pipeline stages specified in that mask, and its second
<a href="#synchronization-dependencies-access-scopes">access scope</a> only includes
memory access performed by pipeline stages specified in that mask.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Including a particular pipeline stage in the first
<a href="#synchronization-dependencies-scopes">synchronization scope</a> of a command
implicitly includes <a href="#synchronization-pipeline-stages-order">logically
earlier</a> pipeline stages in the synchronization scope.
Similarly, the second <a href="#synchronization-dependencies-scopes">synchronization
scope</a> includes <a href="#synchronization-pipeline-stages-order">logically later</a>
pipeline stages.</p>
</div>
<div class="paragraph">
<p>However, note that <a href="#synchronization-dependencies-access-scopes">access
scopes</a> are not affected in this way - only the precise stages specified
are considered part of each access scope.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Certain pipeline stages are only available on queues that support a
particular set of operations.
The following table lists, for each pipeline stage flag, which queue
capability flag <strong class="purple">must</strong> be supported by the queue.
When multiple flags are enumerated in the second column of the table, it
means that the pipeline stage is supported on the queue if it supports any
of the listed capability flags.
For further details on queue capabilities see
<a href="chap4.html#devsandqueues-physical-device-enumeration">Physical Device Enumeration</a>
and <a href="chap4.html#devsandqueues-queues">Queues</a>.</p>
</div>
<table id="synchronization-pipeline-stages-supported" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Supported pipeline stage flags</caption>
<colgroup>
<col style="width: 60%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pipeline stage flag</th>
<th class="tableblock halign-left valign-top">Required queue capability flag</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_DRAW_INDIRECT_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_QUEUE_GRAPHICS_BIT</code> or <code>VK_QUEUE_COMPUTE_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_VERTEX_INPUT_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_QUEUE_GRAPHICS_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_VERTEX_SHADER_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_QUEUE_GRAPHICS_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_TESSELLATION_CONTROL_SHADER_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_QUEUE_GRAPHICS_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_TESSELLATION_EVALUATION_SHADER_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_QUEUE_GRAPHICS_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_GEOMETRY_SHADER_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_QUEUE_GRAPHICS_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_FRAGMENT_SHADER_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_QUEUE_GRAPHICS_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_EARLY_FRAGMENT_TESTS_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_QUEUE_GRAPHICS_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_LATE_FRAGMENT_TESTS_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_QUEUE_GRAPHICS_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_QUEUE_GRAPHICS_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_COMPUTE_SHADER_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_QUEUE_COMPUTE_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_TRANSFER_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_QUEUE_GRAPHICS_BIT</code>, <code>VK_QUEUE_COMPUTE_BIT</code> or <code>VK_QUEUE_TRANSFER_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_HOST_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_ALL_GRAPHICS_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_QUEUE_GRAPHICS_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_ALL_COMMANDS_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None required</p></td>
</tr>
</tbody>
</table>
<div id="synchronization-pipeline-stages-order" class="paragraph">
<p>Pipeline stages that execute as a result of a command logically complete
execution in a specific order, such that completion of a logically later
pipeline stage <strong class="purple">must</strong> not happen-before completion of a logically earlier
stage.
This means that including any stage in the source stage mask for a
particular synchronization command also implies that any logically earlier
stages are included in <strong>A<sub>S</sub></strong> for that command.</p>
</div>
<div class="paragraph">
<p>Similarly, initiation of a logically earlier pipeline stage <strong class="purple">must</strong> not
happen-after initiation of a logically later pipeline stage.
Including any given stage in the destination stage mask for a particular
synchronization command also implies that any logically later stages are
included in <strong>B<sub>S</sub></strong> for that command.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Implementations <strong class="purple">may</strong> not support synchronization at every pipeline stage for
every synchronization operation.
If a pipeline stage that an implementation does not support synchronization
for appears in a source stage mask, it <strong class="purple">may</strong> substitute any logically later
stage in its place for the first synchronization scope.
If a pipeline stage that an implementation does not support synchronization
for appears in a destination stage mask, it <strong class="purple">may</strong> substitute any logically
earlier stage in its place for the second synchronization scope.</p>
</div>
<div class="paragraph">
<p>For example, if an implementation is unable to signal an event immediately
after vertex shader execution is complete, it <strong class="purple">may</strong> instead signal the event
after color attachment output has completed.</p>
</div>
<div class="paragraph">
<p>If an implementation makes such a substitution, it <strong class="purple">must</strong> not affect the
semantics of execution or memory dependencies or image and buffer memory
barriers.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="synchronization-pipeline-stages-types" class="paragraph">
<p>The order and set of pipeline stages executed by a given command is
determined by the command’s pipeline type, as described below:</p>
</div>
<div class="paragraph">
<p>For the graphics pipeline, the following stages occur in this order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_DRAW_INDIRECT_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_VERTEX_INPUT_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_VERTEX_SHADER_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_TESSELLATION_CONTROL_SHADER_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_TESSELLATION_EVALUATION_SHADER_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_GEOMETRY_SHADER_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_EARLY_FRAGMENT_TESTS_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_FRAGMENT_SHADER_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_LATE_FRAGMENT_TESTS_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BIT</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the compute pipeline, the following stages occur in this order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_DRAW_INDIRECT_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_COMPUTE_SHADER_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BIT</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the transfer pipeline, the following stages occur in this order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_TRANSFER_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BIT</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For host operations, only one pipeline stage occurs, so no order is
guaranteed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_PIPELINE_STAGE_HOST_BIT</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="synchronization-access-types">6.1.3. Access Types</h4>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Memory in Vulkan <strong class="purple">can</strong> be accessed from within shader invocations and via
some fixed-function stages of the pipeline.
The <em>access type</em> is a function of the <a href="chap13.html#descriptorsets">descriptor type</a>
used, or how a fixed-function stage accesses memory.
Each access type corresponds to a bit flag in <a href="#VkAccessFlagBits">VkAccessFlagBits</a>.</p>
</div>
<div id="synchronization-access-masks" class="paragraph">
<p>Some synchronization commands take sets of access types as parameters to
define the <a href="#synchronization-dependencies-access-scopes">access scopes</a> of
a memory dependency.
If a synchronization command includes a source access mask, its first
<a href="#synchronization-dependencies-access-scopes">access scope</a> only includes
accesses via the access types specified in that mask.
Similarly, if a synchronization command includes a destination access mask,
its second <a href="#synchronization-dependencies-access-scopes">access scope</a> only
includes accesses via the access types specified in that mask.</p>
</div>
<div class="paragraph">
<p>Access types that <strong class="purple">can</strong> be set in an access mask include:</p>
</div>
<div id="VkAccessFlagBits" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">enum</span> VkAccessFlagBits {
    VK_ACCESS_INDIRECT_COMMAND_READ_BIT = <span class="hex">0x00000001</span>,
    VK_ACCESS_INDEX_READ_BIT = <span class="hex">0x00000002</span>,
    VK_ACCESS_VERTEX_ATTRIBUTE_READ_BIT = <span class="hex">0x00000004</span>,
    VK_ACCESS_UNIFORM_READ_BIT = <span class="hex">0x00000008</span>,
    VK_ACCESS_INPUT_ATTACHMENT_READ_BIT = <span class="hex">0x00000010</span>,
    VK_ACCESS_SHADER_READ_BIT = <span class="hex">0x00000020</span>,
    VK_ACCESS_SHADER_WRITE_BIT = <span class="hex">0x00000040</span>,
    VK_ACCESS_COLOR_ATTACHMENT_READ_BIT = <span class="hex">0x00000080</span>,
    VK_ACCESS_COLOR_ATTACHMENT_WRITE_BIT = <span class="hex">0x00000100</span>,
    VK_ACCESS_DEPTH_STENCIL_ATTACHMENT_READ_BIT = <span class="hex">0x00000200</span>,
    VK_ACCESS_DEPTH_STENCIL_ATTACHMENT_WRITE_BIT = <span class="hex">0x00000400</span>,
    VK_ACCESS_TRANSFER_READ_BIT = <span class="hex">0x00000800</span>,
    VK_ACCESS_TRANSFER_WRITE_BIT = <span class="hex">0x00001000</span>,
    VK_ACCESS_HOST_READ_BIT = <span class="hex">0x00002000</span>,
    VK_ACCESS_HOST_WRITE_BIT = <span class="hex">0x00004000</span>,
    VK_ACCESS_MEMORY_READ_BIT = <span class="hex">0x00008000</span>,
    VK_ACCESS_MEMORY_WRITE_BIT = <span class="hex">0x00010000</span>,
    VK_ACCESS_FLAG_BITS_MAX_ENUM = <span class="hex">0x7FFFFFFF</span>
} VkAccessFlagBits;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_ACCESS_INDIRECT_COMMAND_READ_BIT</code> specifies read access to
indirect command data read as part of an indirect drawing or dispatch
command.</p>
</li>
<li>
<p><code>VK_ACCESS_INDEX_READ_BIT</code> specifies read access to an index buffer
as part of an indexed drawing command, bound by
<a href="chap19.html#vkCmdBindIndexBuffer">vkCmdBindIndexBuffer</a>.</p>
</li>
<li>
<p><code>VK_ACCESS_VERTEX_ATTRIBUTE_READ_BIT</code> specifies read access to a
vertex buffer as part of a drawing command, bound by
<a href="chap20.html#vkCmdBindVertexBuffers">vkCmdBindVertexBuffers</a>.</p>
</li>
<li>
<p><code>VK_ACCESS_UNIFORM_READ_BIT</code> specifies read access to a
<a href="chap13.html#descriptorsets-uniformbuffer">uniform buffer</a>.</p>
</li>
<li>
<p><code>VK_ACCESS_INPUT_ATTACHMENT_READ_BIT</code> specifies read access to an
<a href="chap7.html#renderpass">input attachment</a> within a render pass during fragment
shading.</p>
</li>
<li>
<p><code>VK_ACCESS_SHADER_READ_BIT</code> specifies read access to a
<a href="chap13.html#descriptorsets-storagebuffer">storage buffer</a>,
<a href="chap13.html#descriptorsets-uniformtexelbuffer">uniform texel buffer</a>,
<a href="chap13.html#descriptorsets-storagetexelbuffer">storage texel buffer</a>,
<a href="chap13.html#descriptorsets-sampledimage">sampled image</a>, or
<a href="chap13.html#descriptorsets-storageimage">storage image</a>.</p>
</li>
<li>
<p><code>VK_ACCESS_SHADER_WRITE_BIT</code> specifies write access to a
<a href="chap13.html#descriptorsets-storagebuffer">storage buffer</a>,
<a href="chap13.html#descriptorsets-storagetexelbuffer">storage texel buffer</a>, or
<a href="chap13.html#descriptorsets-storageimage">storage image</a>.</p>
</li>
<li>
<p><code>VK_ACCESS_COLOR_ATTACHMENT_READ_BIT</code> specifies read access to a
<a href="chap7.html#renderpass">color attachment</a>, such as via <a href="chap26.html#framebuffer-blending">blending</a>, <a href="chap26.html#framebuffer-logicop">logic operations</a>, or via certain
<a href="chap7.html#renderpass-load-store-ops">subpass load operations</a>.</p>
</li>
<li>
<p><code>VK_ACCESS_COLOR_ATTACHMENT_WRITE_BIT</code> specifies write access to a
<a href="chap7.html#renderpass">color, resolve, or depth/stencil resolve attachment</a>
during a <a href="chap7.html#renderpass">render pass</a> or via certain
<a href="chap7.html#renderpass-load-store-ops">subpass load and store operations</a>.</p>
</li>
<li>
<p><code>VK_ACCESS_DEPTH_STENCIL_ATTACHMENT_READ_BIT</code> specifies read access
to a <a href="chap7.html#renderpass">depth/stencil attachment</a>, via <a href="chap25.html#fragops-ds-state">depth or stencil operations</a> or via certain
<a href="chap7.html#renderpass-load-store-ops">subpass load operations</a>.</p>
</li>
<li>
<p><code>VK_ACCESS_DEPTH_STENCIL_ATTACHMENT_WRITE_BIT</code> specifies write
access to a <a href="chap7.html#renderpass">depth/stencil attachment</a>, via
<a href="chap25.html#fragops-ds-state">depth or stencil operations</a> or via certain
<a href="chap7.html#renderpass-load-store-ops">subpass load and store operations</a>.</p>
</li>
<li>
<p><code>VK_ACCESS_TRANSFER_READ_BIT</code> specifies read access to an image or
buffer in a <a href="chap18.html#copies">copy</a> operation.</p>
</li>
<li>
<p><code>VK_ACCESS_TRANSFER_WRITE_BIT</code> specifies write access to an image or
buffer in a <a href="chap17.html#clears">clear</a> or <a href="chap18.html#copies">copy</a> operation.</p>
</li>
<li>
<p><code>VK_ACCESS_HOST_READ_BIT</code> specifies read access by a host operation.
Accesses of this type are not performed through a resource, but directly
on memory.</p>
</li>
<li>
<p><code>VK_ACCESS_HOST_WRITE_BIT</code> specifies write access by a host
operation.
Accesses of this type are not performed through a resource, but directly
on memory.</p>
</li>
<li>
<p><code>VK_ACCESS_MEMORY_READ_BIT</code> specifies read access via non-specific
entities.
These entities include the Vulkan device and host, but <strong class="purple">may</strong> also include
entities external to the Vulkan device or otherwise not part of the core
Vulkan pipeline.
When included in a destination access mask, makes all available writes
visible to all future read accesses on entities known to the Vulkan
device.</p>
</li>
<li>
<p><code>VK_ACCESS_MEMORY_WRITE_BIT</code> specifies write access via non-specific
entities.
These entities include the Vulkan device and host, but <strong class="purple">may</strong> also include
entities external to the Vulkan device or otherwise not part of the core
Vulkan pipeline.
When included in a source access mask, all writes that are performed by
entities known to the Vulkan device are made available.
When included in a destination access mask, makes all available writes
visible to all future write accesses on entities known to the Vulkan
device.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Certain access types are only performed by a subset of pipeline stages.
Any synchronization command that takes both stage masks and access masks
uses both to define the <a href="#synchronization-dependencies-access-scopes">access
scopes</a> - only the specified access types performed by the specified stages
are included in the access scope.
An application <strong class="purple">must</strong> not specify an access flag in a synchronization command
if it does not include a pipeline stage in the corresponding stage mask that
is able to perform accesses of that type.
The following table lists, for each access flag, which pipeline stages <strong class="purple">can</strong>
perform that type of access.</p>
</div>
<table id="synchronization-access-types-supported" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Supported access types</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Access flag</th>
<th class="tableblock halign-left valign-top">Supported pipeline stages</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_ACCESS_INDIRECT_COMMAND_READ_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_DRAW_INDIRECT_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_ACCESS_INDEX_READ_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_VERTEX_INPUT_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_ACCESS_VERTEX_ATTRIBUTE_READ_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_VERTEX_INPUT_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_ACCESS_UNIFORM_READ_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_VERTEX_SHADER_BIT</code>, <code>VK_PIPELINE_STAGE_TESSELLATION_CONTROL_SHADER_BIT</code>, <code>VK_PIPELINE_STAGE_TESSELLATION_EVALUATION_SHADER_BIT</code>, <code>VK_PIPELINE_STAGE_GEOMETRY_SHADER_BIT</code>, <code>VK_PIPELINE_STAGE_FRAGMENT_SHADER_BIT</code>, or <code>VK_PIPELINE_STAGE_COMPUTE_SHADER_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_ACCESS_SHADER_READ_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_VERTEX_SHADER_BIT</code>, <code>VK_PIPELINE_STAGE_TESSELLATION_CONTROL_SHADER_BIT</code>, <code>VK_PIPELINE_STAGE_TESSELLATION_EVALUATION_SHADER_BIT</code>, <code>VK_PIPELINE_STAGE_GEOMETRY_SHADER_BIT</code>, <code>VK_PIPELINE_STAGE_FRAGMENT_SHADER_BIT</code>, or <code>VK_PIPELINE_STAGE_COMPUTE_SHADER_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_ACCESS_SHADER_WRITE_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_VERTEX_SHADER_BIT</code>, <code>VK_PIPELINE_STAGE_TESSELLATION_CONTROL_SHADER_BIT</code>, <code>VK_PIPELINE_STAGE_TESSELLATION_EVALUATION_SHADER_BIT</code>, <code>VK_PIPELINE_STAGE_GEOMETRY_SHADER_BIT</code>, <code>VK_PIPELINE_STAGE_FRAGMENT_SHADER_BIT</code>, or <code>VK_PIPELINE_STAGE_COMPUTE_SHADER_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_ACCESS_INPUT_ATTACHMENT_READ_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_FRAGMENT_SHADER_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_ACCESS_COLOR_ATTACHMENT_READ_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_ACCESS_COLOR_ATTACHMENT_WRITE_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_ACCESS_DEPTH_STENCIL_ATTACHMENT_READ_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_EARLY_FRAGMENT_TESTS_BIT</code>, or <code>VK_PIPELINE_STAGE_LATE_FRAGMENT_TESTS_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_ACCESS_DEPTH_STENCIL_ATTACHMENT_WRITE_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_EARLY_FRAGMENT_TESTS_BIT</code>, or <code>VK_PIPELINE_STAGE_LATE_FRAGMENT_TESTS_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_ACCESS_TRANSFER_READ_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_TRANSFER_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_ACCESS_TRANSFER_WRITE_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_TRANSFER_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_ACCESS_HOST_READ_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_HOST_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_ACCESS_HOST_WRITE_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PIPELINE_STAGE_HOST_BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_ACCESS_MEMORY_READ_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_ACCESS_MEMORY_WRITE_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
<div id="synchronization-host-access-types" class="paragraph">
<p>If a memory object does not have the
<code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code> property, then
<a href="chap10.html#vkFlushMappedMemoryRanges">vkFlushMappedMemoryRanges</a> <strong class="purple">must</strong> be called in order to guarantee that
writes to the memory object from the host are made available to the host
domain, where they <strong class="purple">can</strong> be further made available to the device domain via a
domain operation.
Similarly, <a href="chap10.html#vkInvalidateMappedMemoryRanges">vkInvalidateMappedMemoryRanges</a> <strong class="purple">must</strong> be called to guarantee
that writes which are available to the host domain are made visible to host
operations.</p>
</div>
<div class="paragraph">
<p>If the memory object does have the
<code>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT</code> property flag, writes to the
memory object from the host are automatically made available to the host
domain.
Similarly, writes made available to the host domain are automatically made
visible to the host.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>The <a href="chap5.html#vkQueueSubmit">vkQueueSubmit</a> command <a href="#synchronization-submission-host-writes">automatically performs a domain operation from host to device</a> for all
writes performed before the command executes, so in most cases an explicit
memory barrier is not needed for this case.
In the few circumstances where a submit does not occur between the host
write and the device read access, writes <strong class="purple">can</strong> be made available by using an
explicit memory barrier.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkAccessFlags" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> VkFlags VkAccessFlags;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkAccessFlags</code> is a bitmask type for setting a mask of zero or more
<a href="#VkAccessFlagBits">VkAccessFlagBits</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="synchronization-framebuffer-regions">6.1.4. Framebuffer Region Dependencies</h4>
<div class="paragraph">
<p><a href="#synchronization-pipeline-stages">Pipeline stages</a> that operate on, or
with respect to, the framebuffer are collectively the <em>framebuffer-space</em>
pipeline stages.
These stages are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_PIPELINE_STAGE_FRAGMENT_SHADER_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_EARLY_FRAGMENT_TESTS_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_LATE_FRAGMENT_TESTS_BIT</code></p>
</li>
<li>
<p><code>VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For these pipeline stages, an execution or memory dependency from the first
set of operations to the second set <strong class="purple">can</strong> either be a single
<em>framebuffer-global</em> dependency, or split into multiple <em>framebuffer-local</em>
dependencies.
A dependency with non-framebuffer-space pipeline stages is neither
framebuffer-global nor framebuffer-local.</p>
</div>
<div class="paragraph">
<p>A <em>framebuffer region</em> is a set of sample (x, y, layer, sample) coordinates
that is a subset of the entire framebuffer.</p>
</div>
<div class="paragraph">
<p>Both <a href="#synchronization-dependencies-scopes">synchronization scopes</a> of a
framebuffer-local dependency include only the operations performed within
corresponding framebuffer regions (as defined below).
No ordering guarantees are made between different framebuffer regions for a
framebuffer-local dependency.</p>
</div>
<div class="paragraph">
<p>Both <a href="#synchronization-dependencies-scopes">synchronization scopes</a> of a
framebuffer-global dependency include operations on all framebuffer-regions.</p>
</div>
<div class="paragraph">
<p>If the first synchronization scope includes operations on pixels/fragments
with N samples and the second synchronization scope includes operations on
pixels/fragments with M samples, where N does not equal M, then a
framebuffer region containing all samples at a given (x, y, layer)
coordinate in the first synchronization scope corresponds to a region
containing all samples at the same coordinate in the second synchronization
scope.
In other words, it is a pixel granularity dependency.
If N equals M, then a framebuffer region containing a single (x, y, layer,
sample) coordinate in the first synchronization scope corresponds to a
region containing the same sample at the same coordinate in the second
synchronization scope.
In other words, it is a sample granularity dependency.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Since fragment invocations are not specified to run in any particular
groupings, the size of a framebuffer region is implementation-dependent, not
known to the application, and <strong class="purple">must</strong> be assumed to be no larger than
specified above.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Practically, the pixel vs sample granularity dependency means that if an
input attachment has a different number of samples than the pipeline’s
<code>rasterizationSamples</code>, then a fragment <strong class="purple">can</strong> access any sample in the
input attachment’s pixel even if it only uses framebuffer-local
dependencies.
If the input attachment has the same number of samples, then the fragment
<strong class="purple">can</strong> only access the covered samples in its input <code>SampleMask</code> (i.e. the
fragment operations happen-after a framebuffer-local dependency for each
sample the fragment covers).
To access samples that are not covered, a framebuffer-global dependency is
required.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If a synchronization command includes a <code>dependencyFlags</code> parameter, and
specifies the <code>VK_DEPENDENCY_BY_REGION_BIT</code> flag, then it defines
framebuffer-local dependencies for the framebuffer-space pipeline stages in
that synchronization command, for all framebuffer regions.
If no <code>dependencyFlags</code> parameter is included, or the
<code>VK_DEPENDENCY_BY_REGION_BIT</code> flag is not specified, then a
framebuffer-global dependency is specified for those stages.
The <code>VK_DEPENDENCY_BY_REGION_BIT</code> flag does not affect the dependencies
between non-framebuffer-space pipeline stages, nor does it affect the
dependencies between framebuffer-space and non-framebuffer-space pipeline
stages.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Framebuffer-local dependencies are more optimal for most architectures;
particularly tile-based architectures - which can keep framebuffer-regions
entirely in on-chip registers and thus avoid external bandwidth across such
a dependency.
Including a framebuffer-global dependency in your rendering will usually
force all implementations to flush data to memory, or to a higher level
cache, breaking any potential locality optimizations.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="synchronization-view-local-dependencies">6.1.5. View-Local Dependencies</h4>
<div class="paragraph">
<p>In a render pass instance that has <a href="chap7.html#renderpass-multiview">multiview</a>
enabled, dependencies <strong class="purple">can</strong> be either view-local or view-global.</p>
</div>
<div class="paragraph">
<p>A view-local dependency only includes operations from a single
<a href="chap7.html#renderpass-multiview-view-local">source view</a> from the source subpass in
the first synchronization scope, and only includes operations from a single
<a href="chap7.html#renderpass-multiview-view-local">destination view</a> from the destination
subpass in the second synchronization scope.
A view-global dependency includes all views in the view mask of the source
and destination subpasses in the corresponding synchronization scopes.</p>
</div>
<div class="paragraph">
<p>If a synchronization command includes a <code>dependencyFlags</code> parameter and
specifies the <code>VK_DEPENDENCY_VIEW_LOCAL_BIT</code> flag, then it defines
view-local dependencies for that synchronization command, for all views.
If no <code>dependencyFlags</code> parameter is included or the
<code>VK_DEPENDENCY_VIEW_LOCAL_BIT</code> flag is not specified, then a view-global
dependency is specified.</p>
</div>
</div>
<div class="sect3">
<h4 id="synchronization-device-local-dependencies">6.1.6. Device-Local Dependencies</h4>
<div class="paragraph">
<p>Dependencies <strong class="purple">can</strong> be either device-local or non-device-local.
A device-local dependency acts as multiple separate dependencies, one for
each physical device that executes the synchronization command, where each
dependency only includes operations from that physical device in both
synchronization scopes.
A non-device-local dependency is a single dependency where both
synchronization scopes include operations from all physical devices that
participate in the synchronization command.
For subpass dependencies, all physical devices in the
<a href="chap7.html#VkDeviceGroupRenderPassBeginInfo">VkDeviceGroupRenderPassBeginInfo</a>::<code>deviceMask</code> participate in the
dependency, and for pipeline barriers all physical devices that are set in
the command buffer’s current device mask participate in the dependency.</p>
</div>
<div class="paragraph">
<p>If a synchronization command includes a <code>dependencyFlags</code> parameter and
specifies the <code>VK_DEPENDENCY_DEVICE_GROUP_BIT</code> flag, then it defines a
non-device-local dependency for that synchronization command.
If no <code>dependencyFlags</code> parameter is included or the
<code>VK_DEPENDENCY_DEVICE_GROUP_BIT</code> flag is not specified, then it defines
device-local dependencies for that synchronization command, for all
participating physical devices.</p>
</div>
<div class="paragraph">
<p>Semaphore and event dependencies are device-local and only execute on the
one physical device that performs the dependency.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="synchronization-implicit">6.2. Implicit Synchronization Guarantees</h3>
<div class="paragraph">
<p>A small number of implicit ordering guarantees are provided by Vulkan,
ensuring that the order in which commands are submitted is meaningful, and
avoiding unnecessary complexity in common operations.</p>
</div>
<div id="synchronization-submission-order" class="paragraph">
<p><em>Submission order</em> is a fundamental ordering in Vulkan, giving meaning to
the order in which <a href="chap2.html#fundamentals-queueoperation-command-types">action and
synchronization commands</a> are recorded and submitted to a single queue.
Explicit and implicit ordering guarantees between commands in Vulkan all
work on the premise that this ordering is meaningful.
This order does not itself define any execution or memory dependencies;
synchronization commands and other orderings within the API use this
ordering to define their scopes.</p>
</div>
<div class="paragraph">
<p>Submission order for any given set of commands is based on the order in
which they were recorded to command buffers and then submitted.
This order is determined as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The initial order is determined by the order in which
<a href="chap5.html#vkQueueSubmit">vkQueueSubmit</a> commands are executed on the host, for a single
queue, from first to last.</p>
</li>
<li>
<p>The order in which <a href="chap5.html#VkSubmitInfo">VkSubmitInfo</a> structures are specified in the
<code>pSubmits</code> parameter of <a href="chap5.html#vkQueueSubmit">vkQueueSubmit</a>, from lowest index to
highest.</p>
</li>
<li>
<p>The order in which command buffers are specified in the
<code>pCommandBuffers</code> member of <a href="chap5.html#VkSubmitInfo">VkSubmitInfo</a>, from lowest index to
highest.</p>
</li>
<li>
<p>The order in which commands were recorded to a command buffer on the
host, from first to last:</p>
<div class="ulist">
<ul>
<li>
<p>For commands recorded outside a render pass, this includes all other
commands recorded outside a render pass, including
<a href="chap7.html#vkCmdBeginRenderPass">vkCmdBeginRenderPass</a> and <a href="chap7.html#vkCmdEndRenderPass">vkCmdEndRenderPass</a> commands; it
does not directly include commands inside a render pass.</p>
</li>
<li>
<p>For commands recorded inside a render pass, this includes all other
commands recorded inside the same subpass, including the
<a href="chap7.html#vkCmdBeginRenderPass">vkCmdBeginRenderPass</a> and <a href="chap7.html#vkCmdEndRenderPass">vkCmdEndRenderPass</a> commands that
delimit the same render pass instance; it does not include commands
recorded to other subpasses.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="chap2.html#fundamentals-queueoperation-command-types">Action and synchronization
commands</a> recorded to a command buffer execute the
<code>VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT</code> pipeline stage in
<a href="#synchronization-submission-order">submission order</a> - forming an implicit
execution dependency between this stage in each command.</p>
</div>
<div class="paragraph">
<p><a href="chap2.html#fundamentals-queueoperation-command-types">State commands</a> do not execute
any operations on the device, instead they set the state of the command
buffer when they execute on the host, in the order that they are recorded.
<a href="chap2.html#fundamentals-queueoperation-command-types">Action commands</a> consume the
current state of the command buffer when they are recorded, and will execute
state changes on the device as required to match the recorded state.</p>
</div>
<div class="paragraph">
<p><a href="chap16.html#queries-order">Query commands</a>, <a href="chap19.html#drawing-primitive-order">the order of
primitives passing through the graphics pipeline</a> and
<a href="#synchronization-image-barrier-layout-transition-order">image layout
transitions as part of an image memory barrier</a> provide additional
guarantees based on submission order.</p>
</div>
<div class="paragraph">
<p>Execution of <a href="#synchronization-pipeline-stages-order">pipeline stages</a>
within a given command also has a loose ordering, dependent only on a single
command.</p>
</div>
</div>
<div class="sect2">
<h3 id="synchronization-fences">6.3. Fences</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Fences are a synchronization primitive that <strong class="purple">can</strong> be used to insert a
dependency from a queue to the host.
Fences have two states - signaled and unsignaled.
A fence <strong class="purple">can</strong> be signaled as part of the execution of a
<a href="chap4.html#devsandqueues-submission">queue submission</a> command.
Fences <strong class="purple">can</strong> be unsignaled on the host with <a href="#vkResetFences">vkResetFences</a>.
Fences <strong class="purple">can</strong> be waited on by the host with the <a href="#vkWaitForFences">vkWaitForFences</a> command,
and the current state <strong class="purple">can</strong> be queried with <a href="#vkGetFenceStatus">vkGetFenceStatus</a>.</p>
</div>
<div id="synchronization-fences-payloads" class="paragraph">
<p>As with most objects in Vulkan, fences are an interface to internal data
which is typically opaque to applications.
This internal data is referred to as a fence’s <em>payload</em>.</p>
</div>
<div class="paragraph">
<p>However, in order to enable communication with agents outside of the current
device, it is necessary to be able to export that payload to a commonly
understood format, and subsequently import from that format as well.</p>
</div>
<div class="paragraph">
<p>The internal data of a fence <strong class="purple">may</strong> include a reference to any resources and
pending work associated with signal or unsignal operations performed on that
fence object.
Mechanisms to import and export that internal data to and from fences are
provided <a href="#VkExportFenceCreateInfo">below</a>.
These mechanisms indirectly enable applications to share fence state between
two or more fences and other synchronization primitives across process and
API boundaries.</p>
</div>
<div class="paragraph">
<p>Fences are represented by <code>VkFence</code> handles:</p>
</div>
<div id="VkFence" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VK_DEFINE_NON_DISPATCHABLE_HANDLE(VkFence)</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To create a fence, call:</p>
</div>
<div id="vkCreateFence" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VkResult vkCreateFence(
    VkDevice                                    device,
    <span class="directive">const</span> VkFenceCreateInfo*                    pCreateInfo,
    <span class="directive">const</span> VkAllocationCallbacks*                pAllocator,
    VkFence*                                    pFence);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that creates the fence.</p>
</li>
<li>
<p><code>pCreateInfo</code> is a pointer to an instance of the
<code>VkFenceCreateInfo</code> structure which contains information about how
the fence is to be created.</p>
</li>
<li>
<p><code>pAllocator</code> controls host memory allocation as described in the
<a href="chap10.html#memory-allocation">Memory Allocation</a> chapter.</p>
</li>
<li>
<p><code>pFence</code> points to a handle in which the resulting fence object is
returned.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCreateFence-device-parameter"></a> <code>device</code> <strong class="purple">must</strong> be a valid <code>VkDevice</code> handle</p>
</li>
<li>
<p><a id="VUID-vkCreateFence-pCreateInfo-parameter"></a> <code>pCreateInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <code>VkFenceCreateInfo</code> structure</p>
</li>
<li>
<p><a id="VUID-vkCreateFence-pAllocator-parameter"></a> If <code>pAllocator</code> is not <code>NULL</code>, <code>pAllocator</code> <strong class="purple">must</strong> be a valid pointer to a valid <code>VkAllocationCallbacks</code> structure</p>
</li>
<li>
<p><a id="VUID-vkCreateFence-pFence-parameter"></a> <code>pFence</code> <strong class="purple">must</strong> be a valid pointer to a <code>VkFence</code> handle</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap2.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap2.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkFenceCreateInfo</code> structure is defined as:</p>
</div>
<div id="VkFenceCreateInfo" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">struct</span> VkFenceCreateInfo {
    VkStructureType       sType;
    <span class="directive">const</span> <span class="directive">void</span>*           pNext;
    VkFenceCreateFlags    flags;
} VkFenceCreateInfo;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is the type of this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to an extension-specific structure.</p>
</li>
<li>
<p><code>flags</code> is a bitmask of <a href="#VkFenceCreateFlagBits">VkFenceCreateFlagBits</a> specifying the
initial state and behavior of the fence.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkFenceCreateInfo-sType-sType"></a> <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_FENCE_CREATE_INFO</code></p>
</li>
<li>
<p><a id="VUID-VkFenceCreateInfo-pNext-pNext"></a> Each <code>pNext</code> member of any structure (including this one) in the <code>pNext</code> chain <strong class="purple">must</strong> be either <code>NULL</code> or a pointer to a valid instance of <a href="#VkExportFenceCreateInfo">VkExportFenceCreateInfo</a> or <a href="#VkExportFenceWin32HandleInfoKHR">VkExportFenceWin32HandleInfoKHR</a></p>
</li>
<li>
<p><a id="VUID-VkFenceCreateInfo-sType-unique"></a> Each <code>sType</code> member in the <code>pNext</code> chain <strong class="purple">must</strong> be unique</p>
</li>
<li>
<p><a id="VUID-VkFenceCreateInfo-flags-parameter"></a> <code>flags</code> <strong class="purple">must</strong> be a valid combination of <a href="#VkFenceCreateFlagBits">VkFenceCreateFlagBits</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkFenceCreateFlagBits" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">enum</span> VkFenceCreateFlagBits {
    VK_FENCE_CREATE_SIGNALED_BIT = <span class="hex">0x00000001</span>,
    VK_FENCE_CREATE_FLAG_BITS_MAX_ENUM = <span class="hex">0x7FFFFFFF</span>
} VkFenceCreateFlagBits;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_FENCE_CREATE_SIGNALED_BIT</code> specifies that the fence object is
created in the signaled state.
Otherwise, it is created in the unsignaled state.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkFenceCreateFlags" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> VkFlags VkFenceCreateFlags;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkFenceCreateFlags</code> is a bitmask type for setting a mask of zero or
more <a href="#VkFenceCreateFlagBits">VkFenceCreateFlagBits</a>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To create a fence whose payload <strong class="purple">can</strong> be exported to external handles, add
the <a href="#VkExportFenceCreateInfo">VkExportFenceCreateInfo</a> structure to the <code>pNext</code> chain of the
<a href="#VkFenceCreateInfo">VkFenceCreateInfo</a> structure.
The <code>VkExportFenceCreateInfo</code> structure is defined as:</p>
</div>
<div id="VkExportFenceCreateInfo" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">struct</span> VkExportFenceCreateInfo {
    VkStructureType                   sType;
    <span class="directive">const</span> <span class="directive">void</span>*                       pNext;
    VkExternalFenceHandleTypeFlags    handleTypes;
} VkExportFenceCreateInfo;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkExportFenceCreateInfoKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> VkExportFenceCreateInfo VkExportFenceCreateInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is the type of this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to an extension-specific structure.</p>
</li>
<li>
<p><code>handleTypes</code> is a bitmask of
<a href="chap34.html#VkExternalFenceHandleTypeFlagBits">VkExternalFenceHandleTypeFlagBits</a> specifying one or more fence
handle types the application <strong class="purple">can</strong> export from the resulting fence.
The application <strong class="purple">can</strong> request multiple handle types for the same fence.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportFenceCreateInfo-handleTypes-01446"></a>
The bits in <code>handleTypes</code> must be supported and compatible, as
reported by <a href="chap34.html#VkExternalFenceProperties">VkExternalFenceProperties</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportFenceCreateInfo-sType-sType"></a> <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_EXPORT_FENCE_CREATE_INFO</code></p>
</li>
<li>
<p><a id="VUID-VkExportFenceCreateInfo-handleTypes-parameter"></a> <code>handleTypes</code> <strong class="purple">must</strong> be a valid combination of <a href="chap34.html#VkExternalFenceHandleTypeFlagBits">VkExternalFenceHandleTypeFlagBits</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To specify additional attributes of NT handles exported from a fence, add
the <a href="#VkExportFenceWin32HandleInfoKHR">VkExportFenceWin32HandleInfoKHR</a> structure to the <code>pNext</code> chain
of the <a href="#VkFenceCreateInfo">VkFenceCreateInfo</a> structure.
The <code>VkExportFenceWin32HandleInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkExportFenceWin32HandleInfoKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">struct</span> VkExportFenceWin32HandleInfoKHR {
    VkStructureType               sType;
    <span class="directive">const</span> <span class="directive">void</span>*                   pNext;
    <span class="directive">const</span> SECURITY_ATTRIBUTES*    pAttributes;
    DWORD                         dwAccess;
    LPCWSTR                       name;
} VkExportFenceWin32HandleInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is the type of this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to an extension-specific structure.</p>
</li>
<li>
<p><code>pAttributes</code> is a pointer to a Windows <code>SECURITY_ATTRIBUTES</code>
structure specifying security attributes of the handle.</p>
</li>
<li>
<p><code>dwAccess</code> is a <code>DWORD</code> specifying access rights of the handle.</p>
</li>
<li>
<p><code>name</code> is a NULL-terminated UTF-16 string to associate with the
underlying synchronization primitive referenced by NT handles exported
from the created fence.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If this structure is not present, or if <code>pAttributes</code> is set to <code>NULL</code>,
default security descriptor values will be used, and child processes created
by the application will not inherit the handle, as described in the MSDN
documentation for “Synchronization Object Security and Access Rights”<sup>1</sup>.
Further, if the structure is not present, the access rights will be</p>
</div>
<div class="paragraph">
<p><code>DXGI_SHARED_RESOURCE_READ</code> | <code>DXGI_SHARED_RESOURCE_WRITE</code></p>
</div>
<div class="paragraph">
<p>for handles of the following types:</p>
</div>
<div class="paragraph">
<p><code>VK_EXTERNAL_FENCE_HANDLE_TYPE_OPAQUE_WIN32_BIT</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">1</dt>
<dd>
<p><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms686670.aspx" class="bare">https://msdn.microsoft.com/en-us/library/windows/desktop/ms686670.aspx</a></p>
</dd>
</dl>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportFenceWin32HandleInfoKHR-handleTypes-01447"></a>
If <a href="#VkExportFenceCreateInfo">VkExportFenceCreateInfo</a>::<code>handleTypes</code> does not include
<code>VK_EXTERNAL_FENCE_HANDLE_TYPE_OPAQUE_WIN32_BIT</code>,
<code>VkExportFenceWin32HandleInfoKHR</code> <strong class="purple">must</strong> not be in the <code>pNext</code>
chain of <a href="#VkFenceCreateInfo">VkFenceCreateInfo</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportFenceWin32HandleInfoKHR-sType-sType"></a> <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_EXPORT_FENCE_WIN32_HANDLE_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkExportFenceWin32HandleInfoKHR-pAttributes-parameter"></a> If <code>pAttributes</code> is not <code>NULL</code>, <code>pAttributes</code> <strong class="purple">must</strong> be a valid pointer to a valid <code>SECURITY_ATTRIBUTES</code> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To export a Windows handle representing the state of a fence, call:</p>
</div>
<div id="vkGetFenceWin32HandleKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VkResult vkGetFenceWin32HandleKHR(
    VkDevice                                    device,
    <span class="directive">const</span> VkFenceGetWin32HandleInfoKHR*         pGetWin32HandleInfo,
    HANDLE*                                     pHandle);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that created the fence being
exported.</p>
</li>
<li>
<p><code>pGetWin32HandleInfo</code> is a pointer to an instance of the
<a href="#VkFenceGetWin32HandleInfoKHR">VkFenceGetWin32HandleInfoKHR</a> structure containing parameters of
the export operation.</p>
</li>
<li>
<p><code>pHandle</code> will return the Windows handle representing the fence
state.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For handle types defined as NT handles, the handles returned by
<code>vkGetFenceWin32HandleKHR</code> are owned by the application.
To avoid leaking resources, the application <strong class="purple">must</strong> release ownership of them
using the <code>CloseHandle</code> system call when they are no longer needed.</p>
</div>
<div class="paragraph">
<p>Exporting a Windows handle from a fence <strong class="purple">may</strong> have side effects depending on
the transference of the specified handle type, as described in
<a href="#synchronization-fences-importing">Importing Fence Payloads</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetFenceWin32HandleKHR-device-parameter"></a> <code>device</code> <strong class="purple">must</strong> be a valid <code>VkDevice</code> handle</p>
</li>
<li>
<p><a id="VUID-vkGetFenceWin32HandleKHR-pGetWin32HandleInfo-parameter"></a> <code>pGetWin32HandleInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <code>VkFenceGetWin32HandleInfoKHR</code> structure</p>
</li>
<li>
<p><a id="VUID-vkGetFenceWin32HandleKHR-pHandle-parameter"></a> <code>pHandle</code> <strong class="purple">must</strong> be a valid pointer to a <code>HANDLE</code> value</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap2.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap2.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_TOO_MANY_OBJECTS</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkFenceGetWin32HandleInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkFenceGetWin32HandleInfoKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">struct</span> VkFenceGetWin32HandleInfoKHR {
    VkStructureType                      sType;
    <span class="directive">const</span> <span class="directive">void</span>*                          pNext;
    VkFence                              fence;
    VkExternalFenceHandleTypeFlagBits    handleType;
} VkFenceGetWin32HandleInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is the type of this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to an extension-specific structure.</p>
</li>
<li>
<p><code>fence</code> is the fence from which state will be exported.</p>
</li>
<li>
<p><code>handleType</code> is the type of handle requested.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The properties of the handle returned depend on the value of
<code>handleType</code>.
See <a href="chap34.html#VkExternalFenceHandleTypeFlagBits">VkExternalFenceHandleTypeFlagBits</a> for a description of the
properties of the defined external fence handle types.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkFenceGetWin32HandleInfoKHR-handleType-01448"></a>
<code>handleType</code> <strong class="purple">must</strong> have been included in
<a href="#VkExportFenceCreateInfo">VkExportFenceCreateInfo</a>::<code>handleTypes</code> when the <code>fence</code>’s
current payload was created.</p>
</li>
<li>
<p><a id="VUID-VkFenceGetWin32HandleInfoKHR-handleType-01449"></a>
If <code>handleType</code> is defined as an NT handle,
<a href="#vkGetFenceWin32HandleKHR">vkGetFenceWin32HandleKHR</a> <strong class="purple">must</strong> be called no more than once for
each valid unique combination of <code>fence</code> and <code>handleType</code>.</p>
</li>
<li>
<p><a id="VUID-VkFenceGetWin32HandleInfoKHR-fence-01450"></a>
<code>fence</code> <strong class="purple">must</strong> not currently have its payload replaced by an imported
payload as described below in
<a href="#synchronization-fences-importing">Importing Fence Payloads</a> unless
that imported payload’s handle type was included in
<a href="chap34.html#VkExternalFenceProperties">VkExternalFenceProperties</a>::<code>exportFromImportedHandleTypes</code> for
<code>handleType</code>.</p>
</li>
<li>
<p><a id="VUID-VkFenceGetWin32HandleInfoKHR-handleType-01451"></a>
If <code>handleType</code> refers to a handle type with copy payload
transference semantics, <code>fence</code> <strong class="purple">must</strong> be signaled, or have an
associated <a href="#synchronization-fences-signaling">fence signal operation</a>
pending execution.</p>
</li>
<li>
<p><a id="VUID-VkFenceGetWin32HandleInfoKHR-handleType-01452"></a>
<code>handleType</code> <strong class="purple">must</strong> be defined as an NT handle or a global share
handle.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkFenceGetWin32HandleInfoKHR-sType-sType"></a> <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_FENCE_GET_WIN32_HANDLE_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkFenceGetWin32HandleInfoKHR-pNext-pNext"></a> <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkFenceGetWin32HandleInfoKHR-fence-parameter"></a> <code>fence</code> <strong class="purple">must</strong> be a valid <code>VkFence</code> handle</p>
</li>
<li>
<p><a id="VUID-VkFenceGetWin32HandleInfoKHR-handleType-parameter"></a> <code>handleType</code> <strong class="purple">must</strong> be a valid <a href="chap34.html#VkExternalFenceHandleTypeFlagBits">VkExternalFenceHandleTypeFlagBits</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To export a POSIX file descriptor representing the payload of a fence, call:</p>
</div>
<div id="vkGetFenceFdKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VkResult vkGetFenceFdKHR(
    VkDevice                                    device,
    <span class="directive">const</span> VkFenceGetFdInfoKHR*                  pGetFdInfo,
    <span class="predefined-type">int</span>*                                        pFd);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that created the fence being
exported.</p>
</li>
<li>
<p><code>pGetFdInfo</code> is a pointer to an instance of the
<a href="#VkFenceGetFdInfoKHR">VkFenceGetFdInfoKHR</a> structure containing parameters of the export
operation.</p>
</li>
<li>
<p><code>pFd</code> will return the file descriptor representing the fence
payload.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each call to <code>vkGetFenceFdKHR</code> <strong class="purple">must</strong> create a new file descriptor and
transfer ownership of it to the application.
To avoid leaking resources, the application <strong class="purple">must</strong> release ownership of the
file descriptor when it is no longer needed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Ownership can be released in many ways.
For example, the application can call <code>close</code>() on the file descriptor,
or transfer ownership back to Vulkan by using the file descriptor to import
a fence payload.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If <code>pGetFdInfo</code>-&gt;<code>handleType</code> is
<code>VK_EXTERNAL_FENCE_HANDLE_TYPE_SYNC_FD_BIT</code> and the fence is signaled at
the time <code>vkGetFenceFdKHR</code> is called, <code>pFd</code> <strong class="purple">may</strong> return the value
<code>-1</code> instead of a valid file descriptor.</p>
</div>
<div class="paragraph">
<p>Where supported by the operating system, the implementation <strong class="purple">must</strong> set the
file descriptor to be closed automatically when an <code>execve</code> system call
is made.</p>
</div>
<div class="paragraph">
<p>Exporting a file descriptor from a fence <strong class="purple">may</strong> have side effects depending on
the transference of the specified handle type, as described in
<a href="#synchronization-fences-importing">Importing Fence State</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetFenceFdKHR-device-parameter"></a> <code>device</code> <strong class="purple">must</strong> be a valid <code>VkDevice</code> handle</p>
</li>
<li>
<p><a id="VUID-vkGetFenceFdKHR-pGetFdInfo-parameter"></a> <code>pGetFdInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <code>VkFenceGetFdInfoKHR</code> structure</p>
</li>
<li>
<p><a id="VUID-vkGetFenceFdKHR-pFd-parameter"></a> <code>pFd</code> <strong class="purple">must</strong> be a valid pointer to an <code>int</code> value</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap2.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap2.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_TOO_MANY_OBJECTS</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkFenceGetFdInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkFenceGetFdInfoKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">struct</span> VkFenceGetFdInfoKHR {
    VkStructureType                      sType;
    <span class="directive">const</span> <span class="directive">void</span>*                          pNext;
    VkFence                              fence;
    VkExternalFenceHandleTypeFlagBits    handleType;
} VkFenceGetFdInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is the type of this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to an extension-specific structure.</p>
</li>
<li>
<p><code>fence</code> is the fence from which state will be exported.</p>
</li>
<li>
<p><code>handleType</code> is the type of handle requested.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The properties of the file descriptor returned depend on the value of
<code>handleType</code>.
See <a href="chap34.html#VkExternalFenceHandleTypeFlagBits">VkExternalFenceHandleTypeFlagBits</a> for a description of the
properties of the defined external fence handle types.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkFenceGetFdInfoKHR-handleType-01453"></a>
<code>handleType</code> <strong class="purple">must</strong> have been included in
<a href="#VkExportFenceCreateInfo">VkExportFenceCreateInfo</a>::<code>handleTypes</code> when <code>fence</code>’s
current payload was created.</p>
</li>
<li>
<p><a id="VUID-VkFenceGetFdInfoKHR-handleType-01454"></a>
If <code>handleType</code> refers to a handle type with copy payload
transference semantics, <code>fence</code> <strong class="purple">must</strong> be signaled, or have an
associated <a href="#synchronization-fences-signaling">fence signal operation</a>
pending execution.</p>
</li>
<li>
<p><a id="VUID-VkFenceGetFdInfoKHR-fence-01455"></a>
<code>fence</code> <strong class="purple">must</strong> not currently have its payload replaced by an imported
payload as described below in
<a href="#synchronization-fences-importing">Importing Fence Payloads</a> unless
that imported payload’s handle type was included in
<a href="chap34.html#VkExternalFenceProperties">VkExternalFenceProperties</a>::<code>exportFromImportedHandleTypes</code> for
<code>handleType</code>.</p>
</li>
<li>
<p><a id="VUID-VkFenceGetFdInfoKHR-handleType-01456"></a>
<code>handleType</code> <strong class="purple">must</strong> be defined as a POSIX file descriptor handle.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkFenceGetFdInfoKHR-sType-sType"></a> <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_FENCE_GET_FD_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkFenceGetFdInfoKHR-pNext-pNext"></a> <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkFenceGetFdInfoKHR-fence-parameter"></a> <code>fence</code> <strong class="purple">must</strong> be a valid <code>VkFence</code> handle</p>
</li>
<li>
<p><a id="VUID-VkFenceGetFdInfoKHR-handleType-parameter"></a> <code>handleType</code> <strong class="purple">must</strong> be a valid <a href="chap34.html#VkExternalFenceHandleTypeFlagBits">VkExternalFenceHandleTypeFlagBits</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To destroy a fence, call:</p>
</div>
<div id="vkDestroyFence" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="directive">void</span> vkDestroyFence(
    VkDevice                                    device,
    VkFence                                     fence,
    <span class="directive">const</span> VkAllocationCallbacks*                pAllocator);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that destroys the fence.</p>
</li>
<li>
<p><code>fence</code> is the handle of the fence to destroy.</p>
</li>
<li>
<p><code>pAllocator</code> controls host memory allocation as described in the
<a href="chap10.html#memory-allocation">Memory Allocation</a> chapter.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkDestroyFence-fence-01120"></a>
All <a href="chap4.html#devsandqueues-submission">queue submission</a> commands that refer
to <code>fence</code> <strong class="purple">must</strong> have completed execution</p>
</li>
<li>
<p><a id="VUID-vkDestroyFence-fence-01121"></a>
If <code>VkAllocationCallbacks</code> were provided when <code>fence</code> was
created, a compatible set of callbacks <strong class="purple">must</strong> be provided here</p>
</li>
<li>
<p><a id="VUID-vkDestroyFence-fence-01122"></a>
If no <code>VkAllocationCallbacks</code> were provided when <code>fence</code> was
created, <code>pAllocator</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkDestroyFence-device-parameter"></a> <code>device</code> <strong class="purple">must</strong> be a valid <code>VkDevice</code> handle</p>
</li>
<li>
<p><a id="VUID-vkDestroyFence-fence-parameter"></a> If <code>fence</code> is not <a href="chap41.html#VK_NULL_HANDLE">VK_NULL_HANDLE</a>, <code>fence</code> <strong class="purple">must</strong> be a valid <code>VkFence</code> handle</p>
</li>
<li>
<p><a id="VUID-vkDestroyFence-pAllocator-parameter"></a> If <code>pAllocator</code> is not <code>NULL</code>, <code>pAllocator</code> <strong class="purple">must</strong> be a valid pointer to a valid <code>VkAllocationCallbacks</code> structure</p>
</li>
<li>
<p><a id="VUID-vkDestroyFence-fence-parent"></a> If <code>fence</code> is a valid handle, it <strong class="purple">must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>fence</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To query the status of a fence from the host, call:</p>
</div>
<div id="vkGetFenceStatus" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VkResult vkGetFenceStatus(
    VkDevice                                    device,
    VkFence                                     fence);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the fence.</p>
</li>
<li>
<p><code>fence</code> is the handle of the fence to query.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Upon success, <code>vkGetFenceStatus</code> returns the status of the fence object,
with the following return codes:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 5. Fence Object Status Codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Status</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_SUCCESS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fence specified by <code>fence</code> is signaled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_NOT_READY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fence specified by <code>fence</code> is unsignaled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_ERROR_DEVICE_LOST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The device has been lost.  See <a href="chap4.html#devsandqueues-lost-device">Lost Device</a>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If a <a href="chap4.html#devsandqueues-submission">queue submission</a> command is pending
execution, then the value returned by this command <strong class="purple">may</strong> immediately be out
of date.</p>
</div>
<div class="paragraph">
<p>If the device has been lost (see <a href="chap4.html#devsandqueues-lost-device">Lost Device</a>),
<code>vkGetFenceStatus</code> <strong class="purple">may</strong> return any of the above status codes.
If the device has been lost and <code>vkGetFenceStatus</code> is called repeatedly,
it will eventually return either <code>VK_SUCCESS</code> or
<code>VK_ERROR_DEVICE_LOST</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetFenceStatus-device-parameter"></a> <code>device</code> <strong class="purple">must</strong> be a valid <code>VkDevice</code> handle</p>
</li>
<li>
<p><a id="VUID-vkGetFenceStatus-fence-parameter"></a> <code>fence</code> <strong class="purple">must</strong> be a valid <code>VkFence</code> handle</p>
</li>
<li>
<p><a id="VUID-vkGetFenceStatus-fence-parent"></a> <code>fence</code> <strong class="purple">must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap2.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
<li>
<p><code>VK_NOT_READY</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap2.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_DEVICE_LOST</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div id="synchronization-fences-unsignaling" class="openblock">
<div class="content">
<div class="paragraph">
<p>To set the state of fences to unsignaled from the host, call:</p>
</div>
<div id="vkResetFences" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VkResult vkResetFences(
    VkDevice                                    device,
    uint32_t                                    fenceCount,
    <span class="directive">const</span> VkFence*                              pFences);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the fences.</p>
</li>
<li>
<p><code>fenceCount</code> is the number of fences to reset.</p>
</li>
<li>
<p><code>pFences</code> is a pointer to an array of fence handles to reset.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If any member of <code>pFences</code> currently has its
<a href="#synchronization-fences-importing">payload imported</a> with temporary
permanence, that fence’s prior permanent payload is first restored.
The remaining operations described therefore operate on the restored
payload.</p>
</div>
<div class="paragraph">
<p>When <a href="#vkResetFences">vkResetFences</a> is executed on the host, it defines a <em>fence
unsignal operation</em> for each fence, which resets the fence to the unsignaled
state.</p>
</div>
<div class="paragraph">
<p>If any member of <code>pFences</code> is already in the unsignaled state when
<a href="#vkResetFences">vkResetFences</a> is executed, then <a href="#vkResetFences">vkResetFences</a> has no effect on
that fence.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkResetFences-pFences-01123"></a>
Each element of <code>pFences</code> <strong class="purple">must</strong> not be currently associated with any
queue command that has not yet completed execution on that queue</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkResetFences-device-parameter"></a> <code>device</code> <strong class="purple">must</strong> be a valid <code>VkDevice</code> handle</p>
</li>
<li>
<p><a id="VUID-vkResetFences-pFences-parameter"></a> <code>pFences</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>fenceCount</code> valid <code>VkFence</code> handles</p>
</li>
<li>
<p><a id="VUID-vkResetFences-fenceCount-arraylength"></a> <code>fenceCount</code> <strong class="purple">must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkResetFences-pFences-parent"></a> Each element of <code>pFences</code> <strong class="purple">must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to each member of <code>pFences</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap2.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap2.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div id="synchronization-fences-signaling" class="paragraph">
<p>When a fence is submitted to a queue as part of a
<a href="chap4.html#devsandqueues-submission">queue submission</a> command, it defines a memory
dependency on the batches that were submitted as part of that command, and
defines a <em>fence signal operation</em> which sets the fence to the signaled
state.</p>
</div>
<div class="paragraph">
<p>The first <a href="#synchronization-dependencies-scopes">synchronization scope</a>
includes every batch submitted in the same <a href="chap4.html#devsandqueues-submission">queue
submission</a> command.
Fence signal operations that are defined by <a href="chap5.html#vkQueueSubmit">vkQueueSubmit</a> additionally
include in the first synchronization scope all commands that occur earlier
in <a href="#synchronization-submission-order">submission order</a>.</p>
</div>
<div class="paragraph">
<p>The second <a href="#synchronization-dependencies-scopes">synchronization scope</a>
only includes the fence signal operation.</p>
</div>
<div class="paragraph">
<p>The first <a href="#synchronization-dependencies-access-scopes">access scope</a>
includes all memory access performed by the device.</p>
</div>
<div class="paragraph">
<p>The second <a href="#synchronization-dependencies-access-scopes">access scope</a> is
empty.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To wait for one or more fences to enter the signaled state on the host,
call:</p>
</div>
<div id="vkWaitForFences" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VkResult vkWaitForFences(
    VkDevice                                    device,
    uint32_t                                    fenceCount,
    <span class="directive">const</span> VkFence*                              pFences,
    VkBool32                                    waitAll,
    uint64_t                                    timeout);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the fences.</p>
</li>
<li>
<p><code>fenceCount</code> is the number of fences to wait on.</p>
</li>
<li>
<p><code>pFences</code> is a pointer to an array of <code>fenceCount</code> fence
handles.</p>
</li>
<li>
<p><code>waitAll</code> is the condition that <strong class="purple">must</strong> be satisfied to successfully
unblock the wait.
If <code>waitAll</code> is <code>VK_TRUE</code>, then the condition is that all fences
in <code>pFences</code> are signaled.
Otherwise, the condition is that at least one fence in <code>pFences</code> is
signaled.</p>
</li>
<li>
<p><code>timeout</code> is the timeout period in units of nanoseconds.
<code>timeout</code> is adjusted to the closest value allowed by the
implementation-dependent timeout accuracy, which <strong class="purple">may</strong> be substantially
longer than one nanosecond, and <strong class="purple">may</strong> be longer than the requested
period.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the condition is satisfied when <code>vkWaitForFences</code> is called, then
<code>vkWaitForFences</code> returns immediately.
If the condition is not satisfied at the time <code>vkWaitForFences</code> is
called, then <code>vkWaitForFences</code> will block and wait up to <code>timeout</code>
nanoseconds for the condition to become satisfied.</p>
</div>
<div class="paragraph">
<p>If <code>timeout</code> is zero, then <code>vkWaitForFences</code> does not wait, but
simply returns the current state of the fences.
<code>VK_TIMEOUT</code> will be returned in this case if the condition is not
satisfied, even though no actual wait was performed.</p>
</div>
<div class="paragraph">
<p>If the specified timeout period expires before the condition is satisfied,
<code>vkWaitForFences</code> returns <code>VK_TIMEOUT</code>.
If the condition is satisfied before <code>timeout</code> nanoseconds has expired,
<code>vkWaitForFences</code> returns <code>VK_SUCCESS</code>.</p>
</div>
<div class="paragraph">
<p>If device loss occurs (see <a href="chap4.html#devsandqueues-lost-device">Lost Device</a>) before
the timeout has expired, <code>vkWaitForFences</code> <strong class="purple">must</strong> return in finite time
with either <code>VK_SUCCESS</code> or <code>VK_ERROR_DEVICE_LOST</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>While we guarantee that <code>vkWaitForFences</code> <strong class="purple">must</strong> return in finite time,
no guarantees are made that it returns immediately upon device loss.
However, the client can reasonably expect that the delay will be on the
order of seconds and that calling <code>vkWaitForFences</code> will not result in a
permanently (or seemingly permanently) dead process.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkWaitForFences-device-parameter"></a> <code>device</code> <strong class="purple">must</strong> be a valid <code>VkDevice</code> handle</p>
</li>
<li>
<p><a id="VUID-vkWaitForFences-pFences-parameter"></a> <code>pFences</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>fenceCount</code> valid <code>VkFence</code> handles</p>
</li>
<li>
<p><a id="VUID-vkWaitForFences-fenceCount-arraylength"></a> <code>fenceCount</code> <strong class="purple">must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkWaitForFences-pFences-parent"></a> Each element of <code>pFences</code> <strong class="purple">must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap2.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
<li>
<p><code>VK_TIMEOUT</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap2.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_DEVICE_LOST</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div id="synchronization-fences-waiting" class="paragraph">
<p>An execution dependency is defined by waiting for a fence to become
signaled, either via <a href="#vkWaitForFences">vkWaitForFences</a> or by polling on
<a href="#vkGetFenceStatus">vkGetFenceStatus</a>.</p>
</div>
<div class="paragraph">
<p>The first <a href="#synchronization-dependencies-scopes">synchronization scope</a>
includes only the fence signal operation.</p>
</div>
<div class="paragraph">
<p>The second <a href="#synchronization-dependencies-scopes">synchronization scope</a>
includes the host operations of <a href="#vkWaitForFences">vkWaitForFences</a> or
<a href="#vkGetFenceStatus">vkGetFenceStatus</a> indicating that the fence has become signaled.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Signaling a fence and waiting on the host does not guarantee that the
results of memory accesses will be visible to the host, as the access scope
of a memory dependency defined by a fence only includes device access.
A <a href="#synchronization-memory-barriers">memory barrier</a> or other memory
dependency <strong class="purple">must</strong> be used to guarantee this.
See the description of <a href="#synchronization-host-access-types">host access
types</a> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="synchronization-fences-importing">6.3.1. Importing Fence Payloads</h4>
<div class="paragraph">
<p>Applications <strong class="purple">can</strong> import a fence payload into an existing fence using an
external fence handle.
The effects of the import operation will be either temporary or permanent,
as specified by the application.
If the import is temporary, the fence will be <em>restored</em> to its permanent
state the next time that fence is passed to <a href="#vkResetFences">vkResetFences</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Restoring a fence to its prior permanent payload is a distinct operation
from resetting a fence payload.
See <a href="#vkResetFences">vkResetFences</a> for more detail.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Performing a subsequent temporary import on a fence before resetting it has
no effect on this requirement; the next unsignal of the fence <strong class="purple">must</strong> still
restore its last permanent state.
A permanent payload import behaves as if the target fence was destroyed, and
a new fence was created with the same handle but the imported payload.
Because importing a fence payload temporarily or permanently detaches the
existing payload from a fence, similar usage restrictions to those applied
to <code>vkDestroyFence</code> are applied to any command that imports a fence
payload.
Which of these import types is used is referred to as the import operation’s
<em>permanence</em>.
Each handle type supports either one or both types of permanence.</p>
</div>
<div class="paragraph">
<p>The implementation <strong class="purple">must</strong> perform the import operation by either referencing
or copying the payload referred to by the specified external fence handle,
depending on the handle’s type.
The import method used is referred to as the handle type’s <em>transference</em>.
When using handle types with reference transference, importing a payload to
a fence adds the fence to the set of all fences sharing that payload.
This set includes the fence from which the payload was exported.
Fence signaling, waiting, and resetting operations performed on any fence in
the set <strong class="purple">must</strong> behave as if the set were a single fence.
Importing a payload using handle types with copy transference creates a
duplicate copy of the payload at the time of import, but makes no further
reference to it.
Fence signaling, waiting, and resetting operations performed on the target
of copy imports <strong class="purple">must</strong> not affect any other fence or payload.</p>
</div>
<div class="paragraph">
<p>Export operations have the same transference as the specified handle type’s
import operations.
Additionally, exporting a fence payload to a handle with copy transference
has the same side effects on the source fence’s payload as executing a fence
reset operation.
If the fence was using a temporarily imported payload, the fence’s prior
permanent payload will be restored.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>The
tables
<a href="#synchronization-fence-handletypes-win32">Handle Types Supported by
VkImportFenceWin32HandleInfoKHR</a>
and
<a href="#synchronization-fence-handletypes-fd">Handle Types Supported by
VkImportFenceFdInfoKHR</a>
define
the permanence and transference of each handle type.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="chap2.html#fundamentals-threadingbehavior">External synchronization</a> allows
implementations to modify an object’s internal state, i.e. payload, without
internal synchronization.
However, for fences sharing a payload across processes, satisfying the
external synchronization requirements of <code>VkFence</code> parameters as if all
fences in the set were the same object is sometimes infeasible.
Satisfying valid usage constraints on the state of a fence would similarly
require impractical coordination or levels of trust between processes.
Therefore, these constraints only apply to a specific fence handle, not to
its payload.
For distinct fence objects which share a payload:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If multiple commands which queue a signal operation, or which unsignal a
fence, are called concurrently, behavior will be as if the commands were
called in an arbitrary sequential order.</p>
</li>
<li>
<p>If a queue submission command is called with a fence that is sharing a
payload, and the payload is already associated with another queue
command that has not yet completed execution, either one or both of the
commands will cause the fence to become signaled when they complete
execution.</p>
</li>
<li>
<p>If a fence payload is reset while it is associated with a queue command
that has not yet completed execution, the payload will become
unsignaled, but <strong class="purple">may</strong> become signaled again when the command completes
execution.</p>
</li>
<li>
<p>In the preceding cases, any of the devices associated with the fences
sharing the payload <strong class="purple">may</strong> be lost, or any of the queue submission or
fence reset commands <strong class="purple">may</strong> return <code>VK_ERROR_INITIALIZATION_FAILED</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other than these non-deterministic results, behavior is well defined.
In particular:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The implementation <strong class="purple">must</strong> not crash or enter an internally inconsistent
state where future valid Vulkan commands might cause undefined results,</p>
</li>
<li>
<p>Timeouts on future wait commands on fences sharing the payload <strong class="purple">must</strong> be
effective.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>These rules allow processes to synchronize access to shared memory without
trusting each other.
However, such processes must still be cautious not to use the shared fence
for more than synchronizing access to the shared memory.
For example, a process should not use a fence with shared payload to tell
when commands it submitted to a queue have completed and objects used by
those commands may be destroyed, since the other process can accidentally or
maliciously cause the fence to signal before the commands actually complete.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When a fence is using an imported payload, its
<a href="#VkExportFenceCreateInfo">VkExportFenceCreateInfo</a>::<code>handleTypes</code> value is that specified
when creating the fence from which the payload was exported, rather than
that specified when creating the fence.
Additionally, <a href="chap34.html#VkExternalFenceProperties">VkExternalFenceProperties</a>::exportFromImportedHandleTypes
restricts which handle types <strong class="purple">can</strong> be exported from such a fence based on the
specific handle type used to import the current payload.
Passing a fence to <a href="chap29.html#vkAcquireNextImageKHR">vkAcquireNextImageKHR</a> is equivalent to temporarily
importing a fence payload to that fence.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Because the exportable handle types of an imported fence correspond to its
current imported payload, and <a href="chap29.html#vkAcquireNextImageKHR">vkAcquireNextImageKHR</a> behaves the same
as a temporary import operation for which the source fence is opaque to the
application, applications have no way of determining whether any external
handle types <strong class="purple">can</strong> be exported from a fence in this state.
Therefore, applications <strong class="purple">must</strong> not attempt to export handles from fences
using a temporarily imported payload from <a href="chap29.html#vkAcquireNextImageKHR">vkAcquireNextImageKHR</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When importing a fence payload, it is the responsibility of the application
to ensure the external handles meet all valid usage requirements.
However, implementations <strong class="purple">must</strong> perform sufficient validation of external
handles to ensure that the operation results in a valid fence which will not
cause program termination, device loss, queue stalls, host thread stalls, or
corruption of other resources when used as allowed according to its import
parameters.
If the external handle provided does not meet these requirements, the
implementation <strong class="purple">must</strong> fail the fence payload import operation with the error
code <code>VK_ERROR_INVALID_EXTERNAL_HANDLE</code>.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To import a fence payload from a Windows handle, call:</p>
</div>
<div id="vkImportFenceWin32HandleKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VkResult vkImportFenceWin32HandleKHR(
    VkDevice                                    device,
    <span class="directive">const</span> VkImportFenceWin32HandleInfoKHR*      pImportFenceWin32HandleInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that created the fence.</p>
</li>
<li>
<p><code>pImportFenceWin32HandleInfo</code> points to a
<a href="#VkImportFenceWin32HandleInfoKHR">VkImportFenceWin32HandleInfoKHR</a> structure specifying the fence and
import parameters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Importing a fence payload from Windows handles does not transfer ownership
of the handle to the Vulkan implementation.
For handle types defined as NT handles, the application <strong class="purple">must</strong> release
ownership using the <code>CloseHandle</code> system call when the handle is no
longer needed.</p>
</div>
<div class="paragraph">
<p>Applications <strong class="purple">can</strong> import the same fence payload into multiple instances of
Vulkan, into the same instance from which it was exported, and multiple
times into a given Vulkan instance.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkImportFenceWin32HandleKHR-device-parameter"></a> <code>device</code> <strong class="purple">must</strong> be a valid <code>VkDevice</code> handle</p>
</li>
<li>
<p><a id="VUID-vkImportFenceWin32HandleKHR-pImportFenceWin32HandleInfo-parameter"></a> <code>pImportFenceWin32HandleInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <code>VkImportFenceWin32HandleInfoKHR</code> structure</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap2.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap2.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_INVALID_EXTERNAL_HANDLE</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkImportFenceWin32HandleInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkImportFenceWin32HandleInfoKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">struct</span> VkImportFenceWin32HandleInfoKHR {
    VkStructureType                      sType;
    <span class="directive">const</span> <span class="directive">void</span>*                          pNext;
    VkFence                              fence;
    VkFenceImportFlags                   flags;
    VkExternalFenceHandleTypeFlagBits    handleType;
    HANDLE                               handle;
    LPCWSTR                              name;
} VkImportFenceWin32HandleInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is the type of this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to an extension-specific structure.</p>
</li>
<li>
<p><code>fence</code> is the fence into which the state will be imported.</p>
</li>
<li>
<p><code>flags</code> is a bitmask of <a href="#VkFenceImportFlagBits">VkFenceImportFlagBits</a> specifying
additional parameters for the fence payload import operation.</p>
</li>
<li>
<p><code>handleType</code> specifies the type of <code>handle</code>.</p>
</li>
<li>
<p><code>handle</code> is the external handle to import, or <code>NULL</code>.</p>
</li>
<li>
<p><code>name</code> is the NULL-terminated UTF-16 string naming the underlying
synchronization primitive to import, or <code>NULL</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The handle types supported by <code>handleType</code> are:</p>
</div>
<table id="synchronization-fence-handletypes-win32" class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 6. Handle Types Supported by <a href="#VkImportFenceWin32HandleInfoKHR">VkImportFenceWin32HandleInfoKHR</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Handle Type</th>
<th class="tableblock halign-left valign-top">Transference</th>
<th class="tableblock halign-left valign-top">Permanence Supported</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_EXTERNAL_FENCE_HANDLE_TYPE_OPAQUE_WIN32_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reference</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temporary,Permanent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_EXTERNAL_FENCE_HANDLE_TYPE_OPAQUE_WIN32_KMT_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reference</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temporary,Permanent</p></td>
</tr>
</tbody>
</table>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportFenceWin32HandleInfoKHR-handleType-01457"></a>
<code>handleType</code> <strong class="purple">must</strong> be a value included in the
<a href="#synchronization-fence-handletypes-win32">Handle Types Supported by
VkImportFenceWin32HandleInfoKHR</a> table.</p>
</li>
<li>
<p><a id="VUID-VkImportFenceWin32HandleInfoKHR-handleType-01459"></a>
If <code>handleType</code> is not
<code>VK_EXTERNAL_FENCE_HANDLE_TYPE_OPAQUE_WIN32_BIT</code>, <code>name</code> <strong class="purple">must</strong>
be <code>NULL</code>.</p>
</li>
<li>
<p><a id="VUID-VkImportFenceWin32HandleInfoKHR-handleType-01460"></a>
If <code>handleType</code> is not <code>0</code> and <code>handle</code> is <code>NULL</code>, <code>name</code>
<strong class="purple">must</strong> name a valid synchronization primitive of the type specified by
<code>handleType</code>.</p>
</li>
<li>
<p><a id="VUID-VkImportFenceWin32HandleInfoKHR-handleType-01461"></a>
If <code>handleType</code> is not <code>0</code> and <code>name</code> is <code>NULL</code>, <code>handle</code>
<strong class="purple">must</strong> be a valid handle of the type specified by <code>handleType</code>.</p>
</li>
<li>
<p><a id="VUID-VkImportFenceWin32HandleInfoKHR-handle-01462"></a>
If <code>handle</code> is not <code>NULL</code>, <code>name</code> must be <code>NULL</code>.</p>
</li>
<li>
<p><a id="VUID-VkImportFenceWin32HandleInfoKHR-handle-01539"></a>
If <code>handle</code> is not <code>NULL</code>, it <strong class="purple">must</strong> obey any requirements listed for
<code>handleType</code> in <a href="chap34.html#external-fence-handle-types-compatibility">external
fence handle types compatibility</a>.</p>
</li>
<li>
<p><a id="VUID-VkImportFenceWin32HandleInfoKHR-name-01540"></a>
If <code>name</code> is not <code>NULL</code>, it <strong class="purple">must</strong> obey any requirements listed for
<code>handleType</code> in <a href="chap34.html#external-fence-handle-types-compatibility">external
fence handle types compatibility</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportFenceWin32HandleInfoKHR-sType-sType"></a> <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_IMPORT_FENCE_WIN32_HANDLE_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkImportFenceWin32HandleInfoKHR-pNext-pNext"></a> <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkImportFenceWin32HandleInfoKHR-fence-parameter"></a> <code>fence</code> <strong class="purple">must</strong> be a valid <code>VkFence</code> handle</p>
</li>
<li>
<p><a id="VUID-VkImportFenceWin32HandleInfoKHR-flags-parameter"></a> <code>flags</code> <strong class="purple">must</strong> be a valid combination of <a href="#VkFenceImportFlagBits">VkFenceImportFlagBits</a> values</p>
</li>
<li>
<p><a id="VUID-VkImportFenceWin32HandleInfoKHR-handleType-parameter"></a> If <code>handleType</code> is not <code>0</code>, <code>handleType</code> <strong class="purple">must</strong> be a valid <a href="chap34.html#VkExternalFenceHandleTypeFlagBits">VkExternalFenceHandleTypeFlagBits</a> value</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>fence</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To import a fence payload from a POSIX file descriptor, call:</p>
</div>
<div id="vkImportFenceFdKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VkResult vkImportFenceFdKHR(
    VkDevice                                    device,
    <span class="directive">const</span> VkImportFenceFdInfoKHR*               pImportFenceFdInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that created the fence.</p>
</li>
<li>
<p><code>pImportFenceFdInfo</code> points to a <a href="#VkImportFenceFdInfoKHR">VkImportFenceFdInfoKHR</a>
structure specifying the fence and import parameters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Importing a fence payload from a file descriptor transfers ownership of the
file descriptor from the application to the Vulkan implementation.
The application <strong class="purple">must</strong> not perform any operations on the file descriptor
after a successful import.</p>
</div>
<div class="paragraph">
<p>Applications <strong class="purple">can</strong> import the same fence payload into multiple instances of
Vulkan, into the same instance from which it was exported, and multiple
times into a given Vulkan instance.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkImportFenceFdKHR-fence-01463"></a>
<code>fence</code> <strong class="purple">must</strong> not be associated with any queue command that has not
yet completed execution on that queue</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkImportFenceFdKHR-device-parameter"></a> <code>device</code> <strong class="purple">must</strong> be a valid <code>VkDevice</code> handle</p>
</li>
<li>
<p><a id="VUID-vkImportFenceFdKHR-pImportFenceFdInfo-parameter"></a> <code>pImportFenceFdInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <code>VkImportFenceFdInfoKHR</code> structure</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap2.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap2.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_INVALID_EXTERNAL_HANDLE</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkImportFenceFdInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkImportFenceFdInfoKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">struct</span> VkImportFenceFdInfoKHR {
    VkStructureType                      sType;
    <span class="directive">const</span> <span class="directive">void</span>*                          pNext;
    VkFence                              fence;
    VkFenceImportFlags                   flags;
    VkExternalFenceHandleTypeFlagBits    handleType;
    <span class="predefined-type">int</span>                                  fd;
} VkImportFenceFdInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is the type of this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to an extension-specific structure.</p>
</li>
<li>
<p><code>fence</code> is the fence into which the payload will be imported.</p>
</li>
<li>
<p><code>flags</code> is a bitmask of <a href="#VkFenceImportFlagBits">VkFenceImportFlagBits</a> specifying
additional parameters for the fence payload import operation.</p>
</li>
<li>
<p><code>handleType</code> specifies the type of <code>fd</code>.</p>
</li>
<li>
<p><code>fd</code> is the external handle to import.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The handle types supported by <code>handleType</code> are:</p>
</div>
<table id="synchronization-fence-handletypes-fd" class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 7. Handle Types Supported by <a href="#VkImportFenceFdInfoKHR">VkImportFenceFdInfoKHR</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Handle Type</th>
<th class="tableblock halign-left valign-top">Transference</th>
<th class="tableblock halign-left valign-top">Permanence Supported</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_EXTERNAL_FENCE_HANDLE_TYPE_OPAQUE_FD_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reference</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temporary,Permanent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_EXTERNAL_FENCE_HANDLE_TYPE_SYNC_FD_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temporary</p></td>
</tr>
</tbody>
</table>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportFenceFdInfoKHR-handleType-01464"></a>
<code>handleType</code> <strong class="purple">must</strong> be a value included in the
<a href="#synchronization-fence-handletypes-fd">Handle Types Supported by
VkImportFenceFdInfoKHR</a> table.</p>
</li>
<li>
<p><a id="VUID-VkImportFenceFdInfoKHR-fd-01541"></a>
<code>fd</code> <strong class="purple">must</strong> obey any requirements listed for <code>handleType</code> in
<a href="chap34.html#external-fence-handle-types-compatibility">external fence handle types
compatibility</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>If <code>handleType</code> is <code>VK_EXTERNAL_FENCE_HANDLE_TYPE_SYNC_FD_BIT</code>, the
special value <code>-1</code> for <code>fd</code> is treated like a valid sync file descriptor
referring to an object that has already signaled.
The import operation will succeed and the <code>VkFence</code> will have a
temporarily imported payload as if a valid file descriptor had been
provided.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>This special behavior for importing an invalid sync file descriptor allows
easier interoperability with other system APIs which use the convention that
an invalid sync file descriptor represents work that has already completed
and does not need to be waited for.
It is consistent with the option for implementations to return a <code>-1</code> file
descriptor when exporting a <code>VK_EXTERNAL_FENCE_HANDLE_TYPE_SYNC_FD_BIT</code>
from a <code>VkFence</code> which is signaled.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportFenceFdInfoKHR-sType-sType"></a> <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_IMPORT_FENCE_FD_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkImportFenceFdInfoKHR-pNext-pNext"></a> <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkImportFenceFdInfoKHR-fence-parameter"></a> <code>fence</code> <strong class="purple">must</strong> be a valid <code>VkFence</code> handle</p>
</li>
<li>
<p><a id="VUID-VkImportFenceFdInfoKHR-flags-parameter"></a> <code>flags</code> <strong class="purple">must</strong> be a valid combination of <a href="#VkFenceImportFlagBits">VkFenceImportFlagBits</a> values</p>
</li>
<li>
<p><a id="VUID-VkImportFenceFdInfoKHR-handleType-parameter"></a> <code>handleType</code> <strong class="purple">must</strong> be a valid <a href="chap34.html#VkExternalFenceHandleTypeFlagBits">VkExternalFenceHandleTypeFlagBits</a> value</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>fence</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Bits which <strong class="purple">can</strong> be set in
<a href="#VkImportFenceWin32HandleInfoKHR">VkImportFenceWin32HandleInfoKHR</a>::<code>flags</code>
and
<a href="#VkImportFenceFdInfoKHR">VkImportFenceFdInfoKHR</a>::<code>flags</code>
specifying additional parameters of a fence import operation are:</p>
</div>
<div id="VkFenceImportFlagBits" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">enum</span> VkFenceImportFlagBits {
    VK_FENCE_IMPORT_TEMPORARY_BIT = <span class="hex">0x00000001</span>,
    VK_FENCE_IMPORT_TEMPORARY_BIT_KHR = VK_FENCE_IMPORT_TEMPORARY_BIT,
    VK_FENCE_IMPORT_FLAG_BITS_MAX_ENUM = <span class="hex">0x7FFFFFFF</span>
} VkFenceImportFlagBits;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkFenceImportFlagBitsKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> VkFenceImportFlagBits VkFenceImportFlagBitsKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_FENCE_IMPORT_TEMPORARY_BIT</code> specifies that the fence payload
will be imported only temporarily, as described in
<a href="#synchronization-fences-importing">Importing Fence Payloads</a>,
regardless of the permanence of <code>handleType</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkFenceImportFlags" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> VkFlags VkFenceImportFlags;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkFenceImportFlagsKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> VkFenceImportFlags VkFenceImportFlagsKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkFenceImportFlags</code> is a bitmask type for setting a mask of zero or
more <a href="#VkFenceImportFlagBits">VkFenceImportFlagBits</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="synchronization-semaphores">6.4. Semaphores</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Semaphores are a synchronization primitive that <strong class="purple">can</strong> be used to insert a
dependency between batches submitted to queues.
Semaphores have two states - signaled and unsignaled.
The state of a semaphore <strong class="purple">can</strong> be signaled after execution of a batch of
commands is completed.
A batch <strong class="purple">can</strong> wait for a semaphore to become signaled before it begins
execution, and the semaphore is also unsignaled before the batch begins
execution.</p>
</div>
<div id="synchronization-semaphores-payloads" class="paragraph">
<p>As with most objects in Vulkan, semaphores are an interface to internal data
which is typically opaque to applications.
This internal data is referred to as a semaphore’s <em>payload</em>.</p>
</div>
<div class="paragraph">
<p>However, in order to enable communication with agents outside of the current
device, it is necessary to be able to export that payload to a commonly
understood format, and subsequently import from that format as well.</p>
</div>
<div class="paragraph">
<p>The internal data of a semaphore <strong class="purple">may</strong> include a reference to any resources
and pending work associated with signal or unsignal operations performed on
that semaphore object.
Mechanisms to import and export that internal data to and from semaphores
are provided <a href="#VkExportSemaphoreCreateInfo">below</a>.
These mechanisms indirectly enable applications to share semaphore state
between two or more semaphores and other synchronization primitives across
process and API boundaries.</p>
</div>
<div class="paragraph">
<p>Semaphores are represented by <code>VkSemaphore</code> handles:</p>
</div>
<div id="VkSemaphore" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VK_DEFINE_NON_DISPATCHABLE_HANDLE(VkSemaphore)</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To create a semaphore, call:</p>
</div>
<div id="vkCreateSemaphore" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VkResult vkCreateSemaphore(
    VkDevice                                    device,
    <span class="directive">const</span> VkSemaphoreCreateInfo*                pCreateInfo,
    <span class="directive">const</span> VkAllocationCallbacks*                pAllocator,
    VkSemaphore*                                pSemaphore);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that creates the semaphore.</p>
</li>
<li>
<p><code>pCreateInfo</code> is a pointer to an instance of the
<code>VkSemaphoreCreateInfo</code> structure which contains information about
how the semaphore is to be created.</p>
</li>
<li>
<p><code>pAllocator</code> controls host memory allocation as described in the
<a href="chap10.html#memory-allocation">Memory Allocation</a> chapter.</p>
</li>
<li>
<p><code>pSemaphore</code> points to a handle in which the resulting semaphore
object is returned.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When created, the semaphore is in the unsignaled state.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCreateSemaphore-device-parameter"></a> <code>device</code> <strong class="purple">must</strong> be a valid <code>VkDevice</code> handle</p>
</li>
<li>
<p><a id="VUID-vkCreateSemaphore-pCreateInfo-parameter"></a> <code>pCreateInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <code>VkSemaphoreCreateInfo</code> structure</p>
</li>
<li>
<p><a id="VUID-vkCreateSemaphore-pAllocator-parameter"></a> If <code>pAllocator</code> is not <code>NULL</code>, <code>pAllocator</code> <strong class="purple">must</strong> be a valid pointer to a valid <code>VkAllocationCallbacks</code> structure</p>
</li>
<li>
<p><a id="VUID-vkCreateSemaphore-pSemaphore-parameter"></a> <code>pSemaphore</code> <strong class="purple">must</strong> be a valid pointer to a <code>VkSemaphore</code> handle</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap2.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap2.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkSemaphoreCreateInfo</code> structure is defined as:</p>
</div>
<div id="VkSemaphoreCreateInfo" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">struct</span> VkSemaphoreCreateInfo {
    VkStructureType           sType;
    <span class="directive">const</span> <span class="directive">void</span>*               pNext;
    VkSemaphoreCreateFlags    flags;
} VkSemaphoreCreateInfo;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is the type of this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to an extension-specific structure.</p>
</li>
<li>
<p><code>flags</code> is reserved for future use.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkSemaphoreCreateInfo-sType-sType"></a> <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_SEMAPHORE_CREATE_INFO</code></p>
</li>
<li>
<p><a id="VUID-VkSemaphoreCreateInfo-pNext-pNext"></a> Each <code>pNext</code> member of any structure (including this one) in the <code>pNext</code> chain <strong class="purple">must</strong> be either <code>NULL</code> or a pointer to a valid instance of <a href="#VkExportSemaphoreCreateInfo">VkExportSemaphoreCreateInfo</a> or <a href="#VkExportSemaphoreWin32HandleInfoKHR">VkExportSemaphoreWin32HandleInfoKHR</a></p>
</li>
<li>
<p><a id="VUID-VkSemaphoreCreateInfo-sType-unique"></a> Each <code>sType</code> member in the <code>pNext</code> chain <strong class="purple">must</strong> be unique</p>
</li>
<li>
<p><a id="VUID-VkSemaphoreCreateInfo-flags-zerobitmask"></a> <code>flags</code> <strong class="purple">must</strong> be <code>0</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkSemaphoreCreateFlags" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> VkFlags VkSemaphoreCreateFlags;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkSemaphoreCreateFlags</code> is a bitmask type for setting a mask, but is
currently reserved for future use.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To create a semaphore whose payload <strong class="purple">can</strong> be exported to external handles,
add the <a href="#VkExportSemaphoreCreateInfo">VkExportSemaphoreCreateInfo</a> structure to the <code>pNext</code> chain
of the <a href="#VkSemaphoreCreateInfo">VkSemaphoreCreateInfo</a> structure.
The <code>VkExportSemaphoreCreateInfo</code> structure is defined as:</p>
</div>
<div id="VkExportSemaphoreCreateInfo" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">struct</span> VkExportSemaphoreCreateInfo {
    VkStructureType                       sType;
    <span class="directive">const</span> <span class="directive">void</span>*                           pNext;
    VkExternalSemaphoreHandleTypeFlags    handleTypes;
} VkExportSemaphoreCreateInfo;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkExportSemaphoreCreateInfoKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> VkExportSemaphoreCreateInfo VkExportSemaphoreCreateInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is the type of this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to an extension-specific structure.</p>
</li>
<li>
<p><code>handleTypes</code> is a bitmask of
<a href="chap34.html#VkExternalSemaphoreHandleTypeFlagBits">VkExternalSemaphoreHandleTypeFlagBits</a> specifying one or more
semaphore handle types the application <strong class="purple">can</strong> export from the resulting
semaphore.
The application <strong class="purple">can</strong> request multiple handle types for the same
semaphore.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportSemaphoreCreateInfo-handleTypes-01124"></a>
The bits in <code>handleTypes</code> <strong class="purple">must</strong> be supported and compatible, as
reported by <a href="chap34.html#VkExternalSemaphoreProperties">VkExternalSemaphoreProperties</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportSemaphoreCreateInfo-sType-sType"></a> <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_EXPORT_SEMAPHORE_CREATE_INFO</code></p>
</li>
<li>
<p><a id="VUID-VkExportSemaphoreCreateInfo-handleTypes-parameter"></a> <code>handleTypes</code> <strong class="purple">must</strong> be a valid combination of <a href="chap34.html#VkExternalSemaphoreHandleTypeFlagBits">VkExternalSemaphoreHandleTypeFlagBits</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To specify additional attributes of NT handles exported from a semaphore,
add the <code>VkExportSemaphoreWin32HandleInfoKHR</code> structure to the
<code>pNext</code> chain of the <a href="#VkSemaphoreCreateInfo">VkSemaphoreCreateInfo</a> structure.
The <code>VkExportSemaphoreWin32HandleInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkExportSemaphoreWin32HandleInfoKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">struct</span> VkExportSemaphoreWin32HandleInfoKHR {
    VkStructureType               sType;
    <span class="directive">const</span> <span class="directive">void</span>*                   pNext;
    <span class="directive">const</span> SECURITY_ATTRIBUTES*    pAttributes;
    DWORD                         dwAccess;
    LPCWSTR                       name;
} VkExportSemaphoreWin32HandleInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is the type of this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to an extension-specific structure.</p>
</li>
<li>
<p><code>pAttributes</code> is a pointer to a Windows <code>SECURITY_ATTRIBUTES</code>
structure specifying security attributes of the handle.</p>
</li>
<li>
<p><code>dwAccess</code> is a <code>DWORD</code> specifying access rights of the handle.</p>
</li>
<li>
<p><code>name</code> is a NULL-terminated UTF-16 string to associate with the
underlying synchronization primitive referenced by NT handles exported
from the created semaphore.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If this structure is not present, or if <code>pAttributes</code> is set to <code>NULL</code>,
default security descriptor values will be used, and child processes created
by the application will not inherit the handle, as described in the MSDN
documentation for “Synchronization Object Security and Access Rights”<sup>1</sup>.
Further, if the structure is not present, the access rights will be</p>
</div>
<div class="paragraph">
<p><code>DXGI_SHARED_RESOURCE_READ</code> | <code>DXGI_SHARED_RESOURCE_WRITE</code></p>
</div>
<div class="paragraph">
<p>for handles of the following types:</p>
</div>
<div class="paragraph">
<p><code>VK_EXTERNAL_SEMAPHORE_HANDLE_TYPE_OPAQUE_WIN32_BIT</code></p>
</div>
<div class="paragraph">
<p>And</p>
</div>
<div class="paragraph">
<p><code>GENERIC_ALL</code></p>
</div>
<div class="paragraph">
<p>for handles of the following types:</p>
</div>
<div class="paragraph">
<p><code>VK_EXTERNAL_SEMAPHORE_HANDLE_TYPE_D3D12_FENCE_BIT</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">1</dt>
<dd>
<p><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms686670.aspx" class="bare">https://msdn.microsoft.com/en-us/library/windows/desktop/ms686670.aspx</a></p>
</dd>
</dl>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportSemaphoreWin32HandleInfoKHR-handleTypes-01125"></a>
If <a href="#VkExportSemaphoreCreateInfo">VkExportSemaphoreCreateInfo</a>::<code>handleTypes</code> does not include
<code>VK_EXTERNAL_SEMAPHORE_HANDLE_TYPE_OPAQUE_WIN32_BIT</code> or
<code>VK_EXTERNAL_SEMAPHORE_HANDLE_TYPE_D3D12_FENCE_BIT</code>,
<code>VkExportSemaphoreWin32HandleInfoKHR</code> <strong class="purple">must</strong> not be in the
<code>pNext</code> chain of <a href="#VkSemaphoreCreateInfo">VkSemaphoreCreateInfo</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkExportSemaphoreWin32HandleInfoKHR-sType-sType"></a> <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_EXPORT_SEMAPHORE_WIN32_HANDLE_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkExportSemaphoreWin32HandleInfoKHR-pAttributes-parameter"></a> If <code>pAttributes</code> is not <code>NULL</code>, <code>pAttributes</code> <strong class="purple">must</strong> be a valid pointer to a valid <code>SECURITY_ATTRIBUTES</code> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To export a Windows handle representing the payload of a semaphore, call:</p>
</div>
<div id="vkGetSemaphoreWin32HandleKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VkResult vkGetSemaphoreWin32HandleKHR(
    VkDevice                                    device,
    <span class="directive">const</span> VkSemaphoreGetWin32HandleInfoKHR*     pGetWin32HandleInfo,
    HANDLE*                                     pHandle);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that created the semaphore being
exported.</p>
</li>
<li>
<p><code>pGetWin32HandleInfo</code> is a pointer to an instance of the
<a href="#VkSemaphoreGetWin32HandleInfoKHR">VkSemaphoreGetWin32HandleInfoKHR</a> structure containing parameters
of the export operation.</p>
</li>
<li>
<p><code>pHandle</code> will return the Windows handle representing the semaphore
state.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For handle types defined as NT handles, the handles returned by
<code>vkGetSemaphoreWin32HandleKHR</code> are owned by the application.
To avoid leaking resources, the application <strong class="purple">must</strong> release ownership of them
using the <code>CloseHandle</code> system call when they are no longer needed.</p>
</div>
<div class="paragraph">
<p>Exporting a Windows handle from a semaphore <strong class="purple">may</strong> have side effects depending
on the transference of the specified handle type, as described in
<a href="#synchronization-semaphores-importing">Importing Semaphore Payloads</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetSemaphoreWin32HandleKHR-device-parameter"></a> <code>device</code> <strong class="purple">must</strong> be a valid <code>VkDevice</code> handle</p>
</li>
<li>
<p><a id="VUID-vkGetSemaphoreWin32HandleKHR-pGetWin32HandleInfo-parameter"></a> <code>pGetWin32HandleInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <code>VkSemaphoreGetWin32HandleInfoKHR</code> structure</p>
</li>
<li>
<p><a id="VUID-vkGetSemaphoreWin32HandleKHR-pHandle-parameter"></a> <code>pHandle</code> <strong class="purple">must</strong> be a valid pointer to a <code>HANDLE</code> value</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap2.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap2.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_TOO_MANY_OBJECTS</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkSemaphoreGetWin32HandleInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkSemaphoreGetWin32HandleInfoKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">struct</span> VkSemaphoreGetWin32HandleInfoKHR {
    VkStructureType                          sType;
    <span class="directive">const</span> <span class="directive">void</span>*                              pNext;
    VkSemaphore                              semaphore;
    VkExternalSemaphoreHandleTypeFlagBits    handleType;
} VkSemaphoreGetWin32HandleInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is the type of this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to an extension-specific structure.</p>
</li>
<li>
<p><code>semaphore</code> is the semaphore from which state will be exported.</p>
</li>
<li>
<p><code>handleType</code> is the type of handle requested.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The properties of the handle returned depend on the value of
<code>handleType</code>.
See <a href="chap34.html#VkExternalSemaphoreHandleTypeFlagBits">VkExternalSemaphoreHandleTypeFlagBits</a> for a description of the
properties of the defined external semaphore handle types.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkSemaphoreGetWin32HandleInfoKHR-handleType-01126"></a>
<code>handleType</code> <strong class="purple">must</strong> have been included in
<a href="#VkExportSemaphoreCreateInfo">VkExportSemaphoreCreateInfo</a>::<code>handleTypes</code> when the
<code>semaphore</code>’s current payload was created.</p>
</li>
<li>
<p><a id="VUID-VkSemaphoreGetWin32HandleInfoKHR-handleType-01127"></a>
If <code>handleType</code> is defined as an NT handle,
<a href="#vkGetSemaphoreWin32HandleKHR">vkGetSemaphoreWin32HandleKHR</a> <strong class="purple">must</strong> be called no more than once for
each valid unique combination of <code>semaphore</code> and <code>handleType</code>.</p>
</li>
<li>
<p><a id="VUID-VkSemaphoreGetWin32HandleInfoKHR-semaphore-01128"></a>
<code>semaphore</code> <strong class="purple">must</strong> not currently have its payload replaced by an
imported payload as described below in
<a href="#synchronization-semaphores-importing">Importing Semaphore Payloads</a>
unless that imported payload’s handle type was included in
<a href="chap34.html#VkExternalSemaphoreProperties">VkExternalSemaphoreProperties</a>::<code>exportFromImportedHandleTypes</code>
for <code>handleType</code>.</p>
</li>
<li>
<p><a id="VUID-VkSemaphoreGetWin32HandleInfoKHR-handleType-01129"></a>
If <code>handleType</code> refers to a handle type with copy payload
transference semantics, as defined below in
<a href="#synchronization-semaphores-importing">Importing Semaphore Payloads</a>,
there <strong class="purple">must</strong> be no queue waiting on <code>semaphore</code>.</p>
</li>
<li>
<p><a id="VUID-VkSemaphoreGetWin32HandleInfoKHR-handleType-01130"></a>
If <code>handleType</code> refers to a handle type with copy payload
transference semantics, <code>semaphore</code> <strong class="purple">must</strong> be signaled, or have an
associated <a href="#synchronization-semaphores-signaling">semaphore signal
operation</a> pending execution.</p>
</li>
<li>
<p><a id="VUID-VkSemaphoreGetWin32HandleInfoKHR-handleType-01131"></a>
<code>handleType</code> <strong class="purple">must</strong> be defined as an NT handle or a global share
handle.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkSemaphoreGetWin32HandleInfoKHR-sType-sType"></a> <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_SEMAPHORE_GET_WIN32_HANDLE_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkSemaphoreGetWin32HandleInfoKHR-pNext-pNext"></a> <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkSemaphoreGetWin32HandleInfoKHR-semaphore-parameter"></a> <code>semaphore</code> <strong class="purple">must</strong> be a valid <code>VkSemaphore</code> handle</p>
</li>
<li>
<p><a id="VUID-VkSemaphoreGetWin32HandleInfoKHR-handleType-parameter"></a> <code>handleType</code> <strong class="purple">must</strong> be a valid <a href="chap34.html#VkExternalSemaphoreHandleTypeFlagBits">VkExternalSemaphoreHandleTypeFlagBits</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To export a POSIX file descriptor representing the payload of a semaphore,
call:</p>
</div>
<div id="vkGetSemaphoreFdKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VkResult vkGetSemaphoreFdKHR(
    VkDevice                                    device,
    <span class="directive">const</span> VkSemaphoreGetFdInfoKHR*              pGetFdInfo,
    <span class="predefined-type">int</span>*                                        pFd);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that created the semaphore being
exported.</p>
</li>
<li>
<p><code>pGetFdInfo</code> is a pointer to an instance of the
<a href="#VkSemaphoreGetFdInfoKHR">VkSemaphoreGetFdInfoKHR</a> structure containing parameters of the
export operation.</p>
</li>
<li>
<p><code>pFd</code> will return the file descriptor representing the semaphore
payload.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each call to <code>vkGetSemaphoreFdKHR</code> <strong class="purple">must</strong> create a new file descriptor
and transfer ownership of it to the application.
To avoid leaking resources, the application <strong class="purple">must</strong> release ownership of the
file descriptor when it is no longer needed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Ownership can be released in many ways.
For example, the application can call <code>close</code>() on the file descriptor,
or transfer ownership back to Vulkan by using the file descriptor to import
a semaphore payload.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Where supported by the operating system, the implementation <strong class="purple">must</strong> set the
file descriptor to be closed automatically when an <code>execve</code> system call
is made.</p>
</div>
<div class="paragraph">
<p>Exporting a file descriptor from a semaphore <strong class="purple">may</strong> have side effects
depending on the transference of the specified handle type, as described in
<a href="#synchronization-semaphores-importing">Importing Semaphore State</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetSemaphoreFdKHR-device-parameter"></a> <code>device</code> <strong class="purple">must</strong> be a valid <code>VkDevice</code> handle</p>
</li>
<li>
<p><a id="VUID-vkGetSemaphoreFdKHR-pGetFdInfo-parameter"></a> <code>pGetFdInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <code>VkSemaphoreGetFdInfoKHR</code> structure</p>
</li>
<li>
<p><a id="VUID-vkGetSemaphoreFdKHR-pFd-parameter"></a> <code>pFd</code> <strong class="purple">must</strong> be a valid pointer to an <code>int</code> value</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap2.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap2.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_TOO_MANY_OBJECTS</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkSemaphoreGetFdInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkSemaphoreGetFdInfoKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">struct</span> VkSemaphoreGetFdInfoKHR {
    VkStructureType                          sType;
    <span class="directive">const</span> <span class="directive">void</span>*                              pNext;
    VkSemaphore                              semaphore;
    VkExternalSemaphoreHandleTypeFlagBits    handleType;
} VkSemaphoreGetFdInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is the type of this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to an extension-specific structure.</p>
</li>
<li>
<p><code>semaphore</code> is the semaphore from which state will be exported.</p>
</li>
<li>
<p><code>handleType</code> is the type of handle requested.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The properties of the file descriptor returned depend on the value of
<code>handleType</code>.
See <a href="chap34.html#VkExternalSemaphoreHandleTypeFlagBits">VkExternalSemaphoreHandleTypeFlagBits</a> for a description of the
properties of the defined external semaphore handle types.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkSemaphoreGetFdInfoKHR-handleType-01132"></a>
<code>handleType</code> <strong class="purple">must</strong> have been included in
<a href="#VkExportSemaphoreCreateInfo">VkExportSemaphoreCreateInfo</a>::<code>handleTypes</code> when
<code>semaphore</code>’s current payload was created.</p>
</li>
<li>
<p><a id="VUID-VkSemaphoreGetFdInfoKHR-semaphore-01133"></a>
<code>semaphore</code> <strong class="purple">must</strong> not currently have its payload replaced by an
imported payload as described below in
<a href="#synchronization-semaphores-importing">Importing Semaphore Payloads</a>
unless that imported payload’s handle type was included in
<a href="chap34.html#VkExternalSemaphoreProperties">VkExternalSemaphoreProperties</a>::<code>exportFromImportedHandleTypes</code>
for <code>handleType</code>.</p>
</li>
<li>
<p><a id="VUID-VkSemaphoreGetFdInfoKHR-handleType-01134"></a>
If <code>handleType</code> refers to a handle type with copy payload
transference semantics, as defined below in
<a href="#synchronization-semaphores-importing">Importing Semaphore Payloads</a>,
there <strong class="purple">must</strong> be no queue waiting on <code>semaphore</code>.</p>
</li>
<li>
<p><a id="VUID-VkSemaphoreGetFdInfoKHR-handleType-01135"></a>
If <code>handleType</code> refers to a handle type with copy payload
transference semantics, <code>semaphore</code> <strong class="purple">must</strong> be signaled, or have an
associated <a href="#synchronization-semaphores-signaling">semaphore signal
operation</a> pending execution.</p>
</li>
<li>
<p><a id="VUID-VkSemaphoreGetFdInfoKHR-handleType-01136"></a>
<code>handleType</code> <strong class="purple">must</strong> be defined as a POSIX file descriptor handle.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkSemaphoreGetFdInfoKHR-sType-sType"></a> <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_SEMAPHORE_GET_FD_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkSemaphoreGetFdInfoKHR-pNext-pNext"></a> <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkSemaphoreGetFdInfoKHR-semaphore-parameter"></a> <code>semaphore</code> <strong class="purple">must</strong> be a valid <code>VkSemaphore</code> handle</p>
</li>
<li>
<p><a id="VUID-VkSemaphoreGetFdInfoKHR-handleType-parameter"></a> <code>handleType</code> <strong class="purple">must</strong> be a valid <a href="chap34.html#VkExternalSemaphoreHandleTypeFlagBits">VkExternalSemaphoreHandleTypeFlagBits</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To destroy a semaphore, call:</p>
</div>
<div id="vkDestroySemaphore" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="directive">void</span> vkDestroySemaphore(
    VkDevice                                    device,
    VkSemaphore                                 semaphore,
    <span class="directive">const</span> VkAllocationCallbacks*                pAllocator);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that destroys the semaphore.</p>
</li>
<li>
<p><code>semaphore</code> is the handle of the semaphore to destroy.</p>
</li>
<li>
<p><code>pAllocator</code> controls host memory allocation as described in the
<a href="chap10.html#memory-allocation">Memory Allocation</a> chapter.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkDestroySemaphore-semaphore-01137"></a>
All submitted batches that refer to <code>semaphore</code> <strong class="purple">must</strong> have completed
execution</p>
</li>
<li>
<p><a id="VUID-vkDestroySemaphore-semaphore-01138"></a>
If <code>VkAllocationCallbacks</code> were provided when <code>semaphore</code> was
created, a compatible set of callbacks <strong class="purple">must</strong> be provided here</p>
</li>
<li>
<p><a id="VUID-vkDestroySemaphore-semaphore-01139"></a>
If no <code>VkAllocationCallbacks</code> were provided when <code>semaphore</code> was
created, <code>pAllocator</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkDestroySemaphore-device-parameter"></a> <code>device</code> <strong class="purple">must</strong> be a valid <code>VkDevice</code> handle</p>
</li>
<li>
<p><a id="VUID-vkDestroySemaphore-semaphore-parameter"></a> If <code>semaphore</code> is not <a href="chap41.html#VK_NULL_HANDLE">VK_NULL_HANDLE</a>, <code>semaphore</code> <strong class="purple">must</strong> be a valid <code>VkSemaphore</code> handle</p>
</li>
<li>
<p><a id="VUID-vkDestroySemaphore-pAllocator-parameter"></a> If <code>pAllocator</code> is not <code>NULL</code>, <code>pAllocator</code> <strong class="purple">must</strong> be a valid pointer to a valid <code>VkAllocationCallbacks</code> structure</p>
</li>
<li>
<p><a id="VUID-vkDestroySemaphore-semaphore-parent"></a> If <code>semaphore</code> is a valid handle, it <strong class="purple">must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>semaphore</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="synchronization-semaphores-signaling">6.4.1. Semaphore Signaling</h4>
<div class="paragraph">
<p>When a batch is submitted to a queue via a <a href="chap4.html#devsandqueues-submission">queue
submission</a>, and it includes semaphores to be signaled, it defines a memory
dependency on the batch, and defines <em>semaphore signal operations</em> which set
the semaphores to the signaled state.</p>
</div>
<div class="paragraph">
<p>The first <a href="#synchronization-dependencies-scopes">synchronization scope</a>
includes every command submitted in the same batch.
Semaphore signal operations that are defined by <a href="chap5.html#vkQueueSubmit">vkQueueSubmit</a>
additionally include all commands that occur earlier in
<a href="#synchronization-submission-order">submission order</a>.</p>
</div>
<div class="paragraph">
<p>The second <a href="#synchronization-dependencies-scopes">synchronization scope</a>
includes only the semaphore signal operation.</p>
</div>
<div class="paragraph">
<p>The first <a href="#synchronization-dependencies-access-scopes">access scope</a>
includes all memory access performed by the device.</p>
</div>
<div class="paragraph">
<p>The second <a href="#synchronization-dependencies-access-scopes">access scope</a> is
empty.</p>
</div>
</div>
<div class="sect3">
<h4 id="synchronization-semaphores-waiting">6.4.2. Semaphore Waiting &amp; Unsignaling</h4>
<div class="paragraph">
<p>When a batch is submitted to a queue via a <a href="chap4.html#devsandqueues-submission">queue
submission</a>, and it includes semaphores to be waited on, it defines a
memory dependency between prior semaphore signal operations and the batch,
and defines <em>semaphore unsignal operations</em> which set the semaphores to the
unsignaled state.</p>
</div>
<div class="paragraph">
<p>The first synchronization scope includes all semaphore signal operations
that operate on semaphores waited on in the same batch, and that
happen-before the wait completes.</p>
</div>
<div class="paragraph">
<p>The second <a href="#synchronization-dependencies-scopes">synchronization scope</a>
includes every command submitted in the same batch.
In the case of <a href="chap5.html#vkQueueSubmit">vkQueueSubmit</a>, the second synchronization scope is
limited to operations on the pipeline stages determined by the
<a href="#synchronization-pipeline-stages-masks">destination stage mask</a> specified
by the corresponding element of <code>pWaitDstStageMask</code>.
Also, in the case of <a href="chap5.html#vkQueueSubmit">vkQueueSubmit</a>, the second synchronization scope
additionally includes all commands that occur later in
<a href="#synchronization-submission-order">submission order</a>.</p>
</div>
<div class="paragraph">
<p>The first <a href="#synchronization-dependencies-access-scopes">access scope</a> is
empty.</p>
</div>
<div class="paragraph">
<p>The second <a href="#synchronization-dependencies-access-scopes">access scope</a>
includes all memory access performed by the device.</p>
</div>
<div class="paragraph">
<p>The semaphore unsignal operation happens-after the first set of operations
in the execution dependency, and happens-before the second set of operations
in the execution dependency.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Unlike fences or events, the act of waiting for a semaphore also unsignals
that semaphore.
Applications <strong class="purple">must</strong> ensure that between two such wait operations, the
semaphore is signaled again, with execution dependencies used to ensure
these occur in order.
Semaphore waits and signals should thus occur in discrete 1:1 pairs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>A common scenario for using <code>pWaitDstStageMask</code> with values other than
<code>VK_PIPELINE_STAGE_ALL_COMMANDS_BIT</code> is when synchronizing a window
system presentation operation against subsequent command buffers which
render the next frame.
In this case, a presentation image <strong class="purple">must</strong> not be overwritten until the
presentation operation completes, but other pipeline stages <strong class="purple">can</strong> execute
without waiting.
A mask of <code>VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT</code> prevents
subsequent color attachment writes from executing until the semaphore
signals.
Some implementations <strong class="purple">may</strong> be able to execute transfer operations and/or
vertex processing work before the semaphore is signaled.</p>
</div>
<div class="paragraph">
<p>If an image layout transition needs to be performed on a presentable image
before it is used in a framebuffer, that <strong class="purple">can</strong> be performed as the first
operation submitted to the queue after acquiring the image, and <strong class="purple">should</strong> not
prevent other work from overlapping with the presentation operation.
For example, a <code>VkImageMemoryBarrier</code> could use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>srcStageMask</code> = <code>VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT</code></p>
</li>
<li>
<p><code>srcAccessMask</code> = 0</p>
</li>
<li>
<p><code>dstStageMask</code> = <code>VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT</code></p>
</li>
<li>
<p><code>dstAccessMask</code> = <code>VK_ACCESS_COLOR_ATTACHMENT_READ_BIT</code> |
<code>VK_ACCESS_COLOR_ATTACHMENT_WRITE_BIT</code>.</p>
</li>
<li>
<p><code>oldLayout</code> = <code>VK_IMAGE_LAYOUT_PRESENT_SRC_KHR</code></p>
</li>
<li>
<p><code>newLayout</code> = <code>VK_IMAGE_LAYOUT_COLOR_ATTACHMENT_OPTIMAL</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Alternatively, <code>oldLayout</code> <strong class="purple">can</strong> be <code>VK_IMAGE_LAYOUT_UNDEFINED</code>, if
the image’s contents need not be preserved.</p>
</div>
<div class="paragraph">
<p>This barrier accomplishes a dependency chain between previous presentation
operations and subsequent color attachment output operations, with the
layout transition performed in between, and does not introduce a dependency
between previous work and any vertex processing stages.
More precisely, the semaphore signals after the presentation operation
completes, the semaphore wait stalls the
<code>VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT</code> stage, and there is a
dependency from that same stage to itself with the layout transition
performed in between.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="synchronization-semaphores-waiting-state">6.4.3. Semaphore State Requirements For Wait Operations</h4>
<div class="paragraph">
<p>Before waiting on a semaphore, the application <strong class="purple">must</strong> ensure the semaphore is
in a valid state for a wait operation.
Specifically, when a <a href="#synchronization-semaphores-waiting">semaphore wait and
unsignal operation</a> is submitted to a queue:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The semaphore <strong class="purple">must</strong> be signaled, or have an associated
<a href="#synchronization-semaphores-signaling">semaphore signal operation</a> that
is pending execution.</p>
</li>
<li>
<p>There <strong class="purple">must</strong> be no other queue waiting on the same semaphore when the
operation executes.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="synchronization-semaphores-importing">6.4.4. Importing Semaphore Payloads</h4>
<div class="paragraph">
<p>Applications <strong class="purple">can</strong> import a semaphore payload into an existing semaphore
using an external semaphore handle.
The effects of the import operation will be either temporary or permanent,
as specified by the application.
If the import is temporary, the implementation <strong class="purple">must</strong> restore the semaphore
to its prior permanent state after submitting the next semaphore wait
operation.
Performing a subsequent temporary import on a semaphore before performing a
semaphore wait has no effect on this requirement; the next wait submitted on
the semaphore <strong class="purple">must</strong> still restore its last permanent state.
A permanent payload import behaves as if the target semaphore was destroyed,
and a new semaphore was created with the same handle but the imported
payload.
Because importing a semaphore payload temporarily or permanently detaches
the existing payload from a semaphore, similar usage restrictions to those
applied to <code>vkDestroySemaphore</code> are applied to any command that imports
a semaphore payload.
Which of these import types is used is referred to as the import operation’s
<em>permanence</em>.
Each handle type supports either one or both types of permanence.</p>
</div>
<div class="paragraph">
<p>The implementation <strong class="purple">must</strong> perform the import operation by either referencing
or copying the payload referred to by the specified external semaphore
handle, depending on the handle’s type.
The import method used is referred to as the handle type’s <em>transference</em>.
When using handle types with reference transference, importing a payload to
a semaphore adds the semaphore to the set of all semaphores sharing that
payload.
This set includes the semaphore from which the payload was exported.
Semaphore signaling and waiting operations performed on any semaphore in the
set <strong class="purple">must</strong> behave as if the set were a single semaphore.
Importing a payload using handle types with copy transference creates a
duplicate copy of the payload at the time of import, but makes no further
reference to it.
Semaphore signaling and waiting operations performed on the target of copy
imports <strong class="purple">must</strong> not affect any other semaphore or payload.</p>
</div>
<div class="paragraph">
<p>Export operations have the same transference as the specified handle type’s
import operations.
Additionally, exporting a semaphore payload to a handle with copy
transference has the same side effects on the source semaphore’s payload as
executing a semaphore wait operation.
If the semaphore was using a temporarily imported payload, the semaphore’s
prior permanent payload will be restored.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>The
tables
<a href="#synchronization-semaphore-handletypes-win32">Handle Types Supported by
VkImportSemaphoreWin32HandleInfoKHR</a>
and
<a href="#synchronization-semaphore-handletypes-fd">Handle Types Supported by
VkImportSemaphoreFdInfoKHR</a>
define
the permanence and transference of each handle type.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="chap2.html#fundamentals-threadingbehavior">External synchronization</a> allows
implementations to modify an object’s internal state, i.e. payload, without
internal synchronization.
However, for semaphores sharing a payload across processes, satisfying the
external synchronization requirements of <code>VkSemaphore</code> parameters as if
all semaphores in the set were the same object is sometimes infeasible.
Satisfying the <a href="#synchronization-semaphores-waiting-state">wait operation
state requirements</a> would similarly require impractical coordination or
levels of trust between processes.
Therefore, these constraints only apply to a specific semaphore handle, not
to its payload.
For distinct semaphore objects which share a payload, if the semaphores are
passed to separate queue submission commands concurrently, behavior will be
as if the commands were called in an arbitrary sequential order.
If the <a href="#synchronization-semaphores-waiting-state">wait operation state
requirements</a> are violated for the shared payload by a queue submission
command, or if a signal operation is queued for a shared payload that is
already signaled or has a pending signal operation, effects <strong class="purple">must</strong> be limited
to one or more of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Returning <code>VK_ERROR_INITIALIZATION_FAILED</code> from the command which
resulted in the violation.</p>
</li>
<li>
<p>Losing the logical device on which the violation occurred immediately or
at a future time, resulting in a <code>VK_ERROR_DEVICE_LOST</code> error from
subsequent commands, including the one causing the violation.</p>
</li>
<li>
<p>Continuing execution of the violating command or operation as if the
semaphore wait completed successfully after an implementation-dependent
timeout.
In this case, the state of the payload becomes undefined, and future
operations on semaphores sharing the payload will be subject to these
same rules.
The semaphore <strong class="purple">must</strong> be destroyed or have its payload replaced by an
import operation to again have a well-defined state.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>These rules allow processes to synchronize access to shared memory without
trusting each other.
However, such processes must still be cautious not to use the shared
semaphore for more than synchronizing access to the shared memory.
For example, a process should not use a shared semaphore as part of an
execution dependency chain that, when complete, leads to objects being
destroyed, if it does not trust other processes sharing the semaphore
payload.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When a semaphore is using an imported payload, its
<a href="#VkExportSemaphoreCreateInfo">VkExportSemaphoreCreateInfo</a>::<code>handleTypes</code> value is that specified
when creating the semaphore from which the payload was exported, rather than
that specified when creating the semaphore.
Additionally,
<a href="chap34.html#VkExternalSemaphoreProperties">VkExternalSemaphoreProperties</a>::exportFromImportedHandleTypes restricts
which handle types <strong class="purple">can</strong> be exported from such a semaphore based on the
specific handle type used to import the current payload.
Passing a semaphore to <a href="chap29.html#vkAcquireNextImageKHR">vkAcquireNextImageKHR</a> is equivalent to
temporarily importing a semaphore payload to that semaphore.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Because the exportable handle types of an imported semaphore correspond to
its current imported payload, and <a href="chap29.html#vkAcquireNextImageKHR">vkAcquireNextImageKHR</a> behaves the
same as a temporary import operation for which the source semaphore is
opaque to the application, applications have no way of determining whether
any external handle types <strong class="purple">can</strong> be exported from a semaphore in this state.
Therefore, applications <strong class="purple">must</strong> not attempt to export external handles from
semaphores using a temporarily imported payload from
<a href="chap29.html#vkAcquireNextImageKHR">vkAcquireNextImageKHR</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When importing a semaphore payload, it is the responsibility of the
application to ensure the external handles meet all valid usage
requirements.
However, implementations <strong class="purple">must</strong> perform sufficient validation of external
handles to ensure that the operation results in a valid semaphore which will
not cause program termination, device loss, queue stalls, or corruption of
other resources when used as allowed according to its import parameters, and
excepting those side effects allowed for violations of the
<a href="#synchronization-semaphores-waiting-state">valid semaphore state for wait
operations</a> rules.
If the external handle provided does not meet these requirements, the
implementation <strong class="purple">must</strong> fail the semaphore payload import operation with the
error code <code>VK_ERROR_INVALID_EXTERNAL_HANDLE</code>.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To import a semaphore payload from a Windows handle, call:</p>
</div>
<div id="vkImportSemaphoreWin32HandleKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VkResult vkImportSemaphoreWin32HandleKHR(
    VkDevice                                    device,
    <span class="directive">const</span> VkImportSemaphoreWin32HandleInfoKHR*  pImportSemaphoreWin32HandleInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that created the semaphore.</p>
</li>
<li>
<p><code>pImportSemaphoreWin32HandleInfo</code> points to a
<a href="#VkImportSemaphoreWin32HandleInfoKHR">VkImportSemaphoreWin32HandleInfoKHR</a> structure specifying the
semaphore and import parameters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Importing a semaphore payload from Windows handles does not transfer
ownership of the handle to the Vulkan implementation.
For handle types defined as NT handles, the application <strong class="purple">must</strong> release
ownership using the <code>CloseHandle</code> system call when the handle is no
longer needed.</p>
</div>
<div class="paragraph">
<p>Applications <strong class="purple">can</strong> import the same semaphore payload into multiple instances
of Vulkan, into the same instance from which it was exported, and multiple
times into a given Vulkan instance.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkImportSemaphoreWin32HandleKHR-device-parameter"></a> <code>device</code> <strong class="purple">must</strong> be a valid <code>VkDevice</code> handle</p>
</li>
<li>
<p><a id="VUID-vkImportSemaphoreWin32HandleKHR-pImportSemaphoreWin32HandleInfo-parameter"></a> <code>pImportSemaphoreWin32HandleInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <code>VkImportSemaphoreWin32HandleInfoKHR</code> structure</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap2.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap2.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_INVALID_EXTERNAL_HANDLE</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkImportSemaphoreWin32HandleInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkImportSemaphoreWin32HandleInfoKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">struct</span> VkImportSemaphoreWin32HandleInfoKHR {
    VkStructureType                          sType;
    <span class="directive">const</span> <span class="directive">void</span>*                              pNext;
    VkSemaphore                              semaphore;
    VkSemaphoreImportFlags                   flags;
    VkExternalSemaphoreHandleTypeFlagBits    handleType;
    HANDLE                                   handle;
    LPCWSTR                                  name;
} VkImportSemaphoreWin32HandleInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is the type of this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to an extension-specific structure.</p>
</li>
<li>
<p><code>semaphore</code> is the semaphore into which the payload will be
imported.</p>
</li>
<li>
<p><code>flags</code> is a bitmask of <a href="#VkSemaphoreImportFlagBits">VkSemaphoreImportFlagBits</a> specifying
additional parameters for the semaphore payload import operation.</p>
</li>
<li>
<p><code>handleType</code> specifies the type of <code>handle</code>.</p>
</li>
<li>
<p><code>handle</code> is the external handle to import, or <code>NULL</code>.</p>
</li>
<li>
<p><code>name</code> is a NULL-terminated UTF-16 string naming the underlying
synchronization primitive to import, or <code>NULL</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The handle types supported by <code>handleType</code> are:</p>
</div>
<table id="synchronization-semaphore-handletypes-win32" class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 8. Handle Types Supported by <a href="#VkImportSemaphoreWin32HandleInfoKHR">VkImportSemaphoreWin32HandleInfoKHR</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Handle Type</th>
<th class="tableblock halign-left valign-top">Transference</th>
<th class="tableblock halign-left valign-top">Permanence Supported</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_EXTERNAL_SEMAPHORE_HANDLE_TYPE_OPAQUE_WIN32_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reference</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temporary,Permanent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_EXTERNAL_SEMAPHORE_HANDLE_TYPE_OPAQUE_WIN32_KMT_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reference</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temporary,Permanent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_EXTERNAL_SEMAPHORE_HANDLE_TYPE_D3D12_FENCE_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reference</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temporary,Permanent</p></td>
</tr>
</tbody>
</table>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportSemaphoreWin32HandleInfoKHR-handleType-01140"></a>
<code>handleType</code> <strong class="purple">must</strong> be a value included in the
<a href="#synchronization-semaphore-handletypes-win32">Handle Types Supported by
VkImportSemaphoreWin32HandleInfoKHR</a> table.</p>
</li>
<li>
<p><a id="VUID-VkImportSemaphoreWin32HandleInfoKHR-handleType-01466"></a>
If <code>handleType</code> is not
<code>VK_EXTERNAL_SEMAPHORE_HANDLE_TYPE_OPAQUE_WIN32_BIT</code> or
<code>VK_EXTERNAL_SEMAPHORE_HANDLE_TYPE_D3D12_FENCE_BIT</code>, <code>name</code>
<strong class="purple">must</strong> be <code>NULL</code>.</p>
</li>
<li>
<p><a id="VUID-VkImportSemaphoreWin32HandleInfoKHR-handleType-01467"></a>
If <code>handleType</code> is not <code>0</code> and <code>handle</code> is <code>NULL</code>, <code>name</code>
<strong class="purple">must</strong> name a valid synchronization primitive of the type specified by
<code>handleType</code>.</p>
</li>
<li>
<p><a id="VUID-VkImportSemaphoreWin32HandleInfoKHR-handleType-01468"></a>
If <code>handleType</code> is not <code>0</code> and <code>name</code> is <code>NULL</code>, <code>handle</code>
<strong class="purple">must</strong> be a valid handle of the type specified by <code>handleType</code>.</p>
</li>
<li>
<p><a id="VUID-VkImportSemaphoreWin32HandleInfoKHR-handle-01469"></a>
If <code>handle</code> is not <code>NULL</code>, <code>name</code> must be <code>NULL</code>.</p>
</li>
<li>
<p><a id="VUID-VkImportSemaphoreWin32HandleInfoKHR-handle-01542"></a>
If <code>handle</code> is not <code>NULL</code>, it <strong class="purple">must</strong> obey any requirements listed for
<code>handleType</code> in
<a href="chap34.html#external-semaphore-handle-types-compatibility">external semaphore
handle types compatibility</a>.</p>
</li>
<li>
<p><a id="VUID-VkImportSemaphoreWin32HandleInfoKHR-name-01543"></a>
If <code>name</code> is not <code>NULL</code>, it <strong class="purple">must</strong> obey any requirements listed for
<code>handleType</code> in
<a href="chap34.html#external-semaphore-handle-types-compatibility">external semaphore
handle types compatibility</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportSemaphoreWin32HandleInfoKHR-sType-sType"></a> <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_IMPORT_SEMAPHORE_WIN32_HANDLE_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkImportSemaphoreWin32HandleInfoKHR-pNext-pNext"></a> <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkImportSemaphoreWin32HandleInfoKHR-semaphore-parameter"></a> <code>semaphore</code> <strong class="purple">must</strong> be a valid <code>VkSemaphore</code> handle</p>
</li>
<li>
<p><a id="VUID-VkImportSemaphoreWin32HandleInfoKHR-flags-parameter"></a> <code>flags</code> <strong class="purple">must</strong> be a valid combination of <a href="#VkSemaphoreImportFlagBits">VkSemaphoreImportFlagBits</a> values</p>
</li>
<li>
<p><a id="VUID-VkImportSemaphoreWin32HandleInfoKHR-handleType-parameter"></a> If <code>handleType</code> is not <code>0</code>, <code>handleType</code> <strong class="purple">must</strong> be a valid <a href="chap34.html#VkExternalSemaphoreHandleTypeFlagBits">VkExternalSemaphoreHandleTypeFlagBits</a> value</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>semaphore</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To import a semaphore payload from a POSIX file descriptor, call:</p>
</div>
<div id="vkImportSemaphoreFdKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VkResult vkImportSemaphoreFdKHR(
    VkDevice                                    device,
    <span class="directive">const</span> VkImportSemaphoreFdInfoKHR*           pImportSemaphoreFdInfo);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that created the semaphore.</p>
</li>
<li>
<p><code>pImportSemaphoreFdInfo</code> points to a
<a href="#VkImportSemaphoreFdInfoKHR">VkImportSemaphoreFdInfoKHR</a> structure specifying the semaphore and
import parameters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Importing a semaphore payload from a file descriptor transfers ownership of
the file descriptor from the application to the Vulkan implementation.
The application <strong class="purple">must</strong> not perform any operations on the file descriptor
after a successful import.</p>
</div>
<div class="paragraph">
<p>Applications <strong class="purple">can</strong> import the same semaphore payload into multiple instances
of Vulkan, into the same instance from which it was exported, and multiple
times into a given Vulkan instance.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkImportSemaphoreFdKHR-semaphore-01142"></a>
<code>semaphore</code> <strong class="purple">must</strong> not be associated with any queue command that has
not yet completed execution on that queue</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkImportSemaphoreFdKHR-device-parameter"></a> <code>device</code> <strong class="purple">must</strong> be a valid <code>VkDevice</code> handle</p>
</li>
<li>
<p><a id="VUID-vkImportSemaphoreFdKHR-pImportSemaphoreFdInfo-parameter"></a> <code>pImportSemaphoreFdInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <code>VkImportSemaphoreFdInfoKHR</code> structure</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap2.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap2.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_INVALID_EXTERNAL_HANDLE</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkImportSemaphoreFdInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkImportSemaphoreFdInfoKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">struct</span> VkImportSemaphoreFdInfoKHR {
    VkStructureType                          sType;
    <span class="directive">const</span> <span class="directive">void</span>*                              pNext;
    VkSemaphore                              semaphore;
    VkSemaphoreImportFlags                   flags;
    VkExternalSemaphoreHandleTypeFlagBits    handleType;
    <span class="predefined-type">int</span>                                      fd;
} VkImportSemaphoreFdInfoKHR;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is the type of this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to an extension-specific structure.</p>
</li>
<li>
<p><code>semaphore</code> is the semaphore into which the payload will be
imported.</p>
</li>
<li>
<p><code>flags</code> is a bitmask of <a href="#VkSemaphoreImportFlagBits">VkSemaphoreImportFlagBits</a> specifying
additional parameters for the semaphore payload import operation.</p>
</li>
<li>
<p><code>handleType</code> specifies the type of <code>fd</code>.</p>
</li>
<li>
<p><code>fd</code> is the external handle to import.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The handle types supported by <code>handleType</code> are:</p>
</div>
<table id="synchronization-semaphore-handletypes-fd" class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 9. Handle Types Supported by <a href="#VkImportSemaphoreFdInfoKHR">VkImportSemaphoreFdInfoKHR</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Handle Type</th>
<th class="tableblock halign-left valign-top">Transference</th>
<th class="tableblock halign-left valign-top">Permanence Supported</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_EXTERNAL_SEMAPHORE_HANDLE_TYPE_OPAQUE_FD_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reference</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temporary,Permanent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_EXTERNAL_SEMAPHORE_HANDLE_TYPE_SYNC_FD_BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temporary</p></td>
</tr>
</tbody>
</table>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportSemaphoreFdInfoKHR-handleType-01143"></a>
<code>handleType</code> <strong class="purple">must</strong> be a value included in the
<a href="#synchronization-semaphore-handletypes-fd">Handle Types Supported by
VkImportSemaphoreFdInfoKHR</a> table.</p>
</li>
<li>
<p><a id="VUID-VkImportSemaphoreFdInfoKHR-fd-01544"></a>
<code>fd</code> <strong class="purple">must</strong> obey any requirements listed for <code>handleType</code> in
<a href="chap34.html#external-semaphore-handle-types-compatibility">external semaphore
handle types compatibility</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImportSemaphoreFdInfoKHR-sType-sType"></a> <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_IMPORT_SEMAPHORE_FD_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkImportSemaphoreFdInfoKHR-pNext-pNext"></a> <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkImportSemaphoreFdInfoKHR-semaphore-parameter"></a> <code>semaphore</code> <strong class="purple">must</strong> be a valid <code>VkSemaphore</code> handle</p>
</li>
<li>
<p><a id="VUID-VkImportSemaphoreFdInfoKHR-flags-parameter"></a> <code>flags</code> <strong class="purple">must</strong> be a valid combination of <a href="#VkSemaphoreImportFlagBits">VkSemaphoreImportFlagBits</a> values</p>
</li>
<li>
<p><a id="VUID-VkImportSemaphoreFdInfoKHR-handleType-parameter"></a> <code>handleType</code> <strong class="purple">must</strong> be a valid <a href="chap34.html#VkExternalSemaphoreHandleTypeFlagBits">VkExternalSemaphoreHandleTypeFlagBits</a> value</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>semaphore</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Additional parameters of a semaphore import operation are specified by
<a href="#VkImportSemaphoreWin32HandleInfoKHR">VkImportSemaphoreWin32HandleInfoKHR</a>::<code>flags</code>
or
<a href="#VkImportSemaphoreFdInfoKHR">VkImportSemaphoreFdInfoKHR</a>::<code>flags</code>
.
Bits which can be set include:</p>
</div>
<div id="VkSemaphoreImportFlagBits" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">enum</span> VkSemaphoreImportFlagBits {
    VK_SEMAPHORE_IMPORT_TEMPORARY_BIT = <span class="hex">0x00000001</span>,
    VK_SEMAPHORE_IMPORT_TEMPORARY_BIT_KHR = VK_SEMAPHORE_IMPORT_TEMPORARY_BIT,
    VK_SEMAPHORE_IMPORT_FLAG_BITS_MAX_ENUM = <span class="hex">0x7FFFFFFF</span>
} VkSemaphoreImportFlagBits;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkSemaphoreImportFlagBitsKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> VkSemaphoreImportFlagBits VkSemaphoreImportFlagBitsKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p>These bits have the following meanings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_SEMAPHORE_IMPORT_TEMPORARY_BIT</code> specifies that the semaphore
payload will be imported only temporarily, as described in
<a href="#synchronization-semaphores-importing">Importing Semaphore Payloads</a>,
regardless of the permanence of <code>handleType</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkSemaphoreImportFlags" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> VkFlags VkSemaphoreImportFlags;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkSemaphoreImportFlagsKHR" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> VkSemaphoreImportFlags VkSemaphoreImportFlagsKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkSemaphoreImportFlags</code> is a bitmask type for setting a mask of zero or
more <a href="#VkSemaphoreImportFlagBits">VkSemaphoreImportFlagBits</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="synchronization-events">6.5. Events</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Events are a synchronization primitive that <strong class="purple">can</strong> be used to insert a
fine-grained dependency between commands submitted to the same queue, or
between the host and a queue.
Events <strong class="purple">must</strong> not be used to insert a dependency between commands submitted
to different queues.
Events have two states - signaled and unsignaled.
An application <strong class="purple">can</strong> signal an event, or unsignal it, on either the host or
the device.
A device <strong class="purple">can</strong> wait for an event to become signaled before executing further
operations.
No command exists to wait for an event to become signaled on the host, but
the current state of an event <strong class="purple">can</strong> be queried.</p>
</div>
<div class="paragraph">
<p>Events are represented by <code>VkEvent</code> handles:</p>
</div>
<div id="VkEvent" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VK_DEFINE_NON_DISPATCHABLE_HANDLE(VkEvent)</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To create an event, call:</p>
</div>
<div id="vkCreateEvent" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VkResult vkCreateEvent(
    VkDevice                                    device,
    <span class="directive">const</span> VkEventCreateInfo*                    pCreateInfo,
    <span class="directive">const</span> VkAllocationCallbacks*                pAllocator,
    VkEvent*                                    pEvent);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that creates the event.</p>
</li>
<li>
<p><code>pCreateInfo</code> is a pointer to an instance of the
<code>VkEventCreateInfo</code> structure which contains information about how
the event is to be created.</p>
</li>
<li>
<p><code>pAllocator</code> controls host memory allocation as described in the
<a href="chap10.html#memory-allocation">Memory Allocation</a> chapter.</p>
</li>
<li>
<p><code>pEvent</code> points to a handle in which the resulting event object is
returned.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When created, the event object is in the unsignaled state.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCreateEvent-device-parameter"></a> <code>device</code> <strong class="purple">must</strong> be a valid <code>VkDevice</code> handle</p>
</li>
<li>
<p><a id="VUID-vkCreateEvent-pCreateInfo-parameter"></a> <code>pCreateInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <code>VkEventCreateInfo</code> structure</p>
</li>
<li>
<p><a id="VUID-vkCreateEvent-pAllocator-parameter"></a> If <code>pAllocator</code> is not <code>NULL</code>, <code>pAllocator</code> <strong class="purple">must</strong> be a valid pointer to a valid <code>VkAllocationCallbacks</code> structure</p>
</li>
<li>
<p><a id="VUID-vkCreateEvent-pEvent-parameter"></a> <code>pEvent</code> <strong class="purple">must</strong> be a valid pointer to a <code>VkEvent</code> handle</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap2.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap2.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkEventCreateInfo</code> structure is defined as:</p>
</div>
<div id="VkEventCreateInfo" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">struct</span> VkEventCreateInfo {
    VkStructureType       sType;
    <span class="directive">const</span> <span class="directive">void</span>*           pNext;
    VkEventCreateFlags    flags;
} VkEventCreateInfo;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is the type of this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to an extension-specific structure.</p>
</li>
<li>
<p><code>flags</code> is reserved for future use.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkEventCreateInfo-sType-sType"></a> <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_EVENT_CREATE_INFO</code></p>
</li>
<li>
<p><a id="VUID-VkEventCreateInfo-pNext-pNext"></a> <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkEventCreateInfo-flags-zerobitmask"></a> <code>flags</code> <strong class="purple">must</strong> be <code>0</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkEventCreateFlags" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> VkFlags VkEventCreateFlags;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkEventCreateFlags</code> is a bitmask type for setting a mask, but is
currently reserved for future use.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To destroy an event, call:</p>
</div>
<div id="vkDestroyEvent" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="directive">void</span> vkDestroyEvent(
    VkDevice                                    device,
    VkEvent                                     event,
    <span class="directive">const</span> VkAllocationCallbacks*                pAllocator);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that destroys the event.</p>
</li>
<li>
<p><code>event</code> is the handle of the event to destroy.</p>
</li>
<li>
<p><code>pAllocator</code> controls host memory allocation as described in the
<a href="chap10.html#memory-allocation">Memory Allocation</a> chapter.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkDestroyEvent-event-01145"></a>
All submitted commands that refer to <code>event</code> <strong class="purple">must</strong> have completed
execution</p>
</li>
<li>
<p><a id="VUID-vkDestroyEvent-event-01146"></a>
If <code>VkAllocationCallbacks</code> were provided when <code>event</code> was
created, a compatible set of callbacks <strong class="purple">must</strong> be provided here</p>
</li>
<li>
<p><a id="VUID-vkDestroyEvent-event-01147"></a>
If no <code>VkAllocationCallbacks</code> were provided when <code>event</code> was
created, <code>pAllocator</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkDestroyEvent-device-parameter"></a> <code>device</code> <strong class="purple">must</strong> be a valid <code>VkDevice</code> handle</p>
</li>
<li>
<p><a id="VUID-vkDestroyEvent-event-parameter"></a> If <code>event</code> is not <a href="chap41.html#VK_NULL_HANDLE">VK_NULL_HANDLE</a>, <code>event</code> <strong class="purple">must</strong> be a valid <code>VkEvent</code> handle</p>
</li>
<li>
<p><a id="VUID-vkDestroyEvent-pAllocator-parameter"></a> If <code>pAllocator</code> is not <code>NULL</code>, <code>pAllocator</code> <strong class="purple">must</strong> be a valid pointer to a valid <code>VkAllocationCallbacks</code> structure</p>
</li>
<li>
<p><a id="VUID-vkDestroyEvent-event-parent"></a> If <code>event</code> is a valid handle, it <strong class="purple">must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>event</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To query the state of an event from the host, call:</p>
</div>
<div id="vkGetEventStatus" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VkResult vkGetEventStatus(
    VkDevice                                    device,
    VkEvent                                     event);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the event.</p>
</li>
<li>
<p><code>event</code> is the handle of the event to query.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Upon success, <code>vkGetEventStatus</code> returns the state of the event object
with the following return codes:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 10. Event Object Status Codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Status</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_EVENT_SET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The event specified by <code>event</code> is signaled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_EVENT_RESET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The event specified by <code>event</code> is unsignaled.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If a <code>vkCmdSetEvent</code> or <code>vkCmdResetEvent</code> command is in a command
buffer that is in the <a href="chap5.html#commandbuffers-lifecycle">pending state</a>, then the
value returned by this command <strong class="purple">may</strong> immediately be out of date.</p>
</div>
<div class="paragraph">
<p>The state of an event <strong class="purple">can</strong> be updated by the host.
The state of the event is immediately changed, and subsequent calls to
<code>vkGetEventStatus</code> will return the new state.
If an event is already in the requested state, then updating it to the same
state has no effect.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetEventStatus-device-parameter"></a> <code>device</code> <strong class="purple">must</strong> be a valid <code>VkDevice</code> handle</p>
</li>
<li>
<p><a id="VUID-vkGetEventStatus-event-parameter"></a> <code>event</code> <strong class="purple">must</strong> be a valid <code>VkEvent</code> handle</p>
</li>
<li>
<p><a id="VUID-vkGetEventStatus-event-parent"></a> <code>event</code> <strong class="purple">must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap2.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_EVENT_SET</code></p>
</li>
<li>
<p><code>VK_EVENT_RESET</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap2.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_DEVICE_LOST</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div id="synchronization-events-signaling-host" class="openblock">
<div class="content">
<div class="paragraph">
<p>To set the state of an event to signaled from the host, call:</p>
</div>
<div id="vkSetEvent" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VkResult vkSetEvent(
    VkDevice                                    device,
    VkEvent                                     event);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the event.</p>
</li>
<li>
<p><code>event</code> is the event to set.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When <a href="#vkSetEvent">vkSetEvent</a> is executed on the host, it defines an <em>event signal
operation</em> which sets the event to the signaled state.</p>
</div>
<div class="paragraph">
<p>If <code>event</code> is already in the signaled state when <a href="#vkSetEvent">vkSetEvent</a> is
executed, then <a href="#vkSetEvent">vkSetEvent</a> has no effect, and no event signal operation
occurs.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkSetEvent-device-parameter"></a> <code>device</code> <strong class="purple">must</strong> be a valid <code>VkDevice</code> handle</p>
</li>
<li>
<p><a id="VUID-vkSetEvent-event-parameter"></a> <code>event</code> <strong class="purple">must</strong> be a valid <code>VkEvent</code> handle</p>
</li>
<li>
<p><a id="VUID-vkSetEvent-event-parent"></a> <code>event</code> <strong class="purple">must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>event</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap2.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap2.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div id="synchronization-events-unsignaling-host" class="openblock">
<div class="content">
<div class="paragraph">
<p>To set the state of an event to unsignaled from the host, call:</p>
</div>
<div id="vkResetEvent" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VkResult vkResetEvent(
    VkDevice                                    device,
    VkEvent                                     event);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the event.</p>
</li>
<li>
<p><code>event</code> is the event to reset.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When <a href="#vkResetEvent">vkResetEvent</a> is executed on the host, it defines an <em>event
unsignal operation</em> which resets the event to the unsignaled state.</p>
</div>
<div class="paragraph">
<p>If <code>event</code> is already in the unsignaled state when <a href="#vkResetEvent">vkResetEvent</a> is
executed, then <a href="#vkResetEvent">vkResetEvent</a> has no effect, and no event unsignal
operation occurs.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkResetEvent-event-01148"></a>
<code>event</code> <strong class="purple">must</strong> not be waited on by a <code>vkCmdWaitEvents</code> command
that is currently executing</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkResetEvent-device-parameter"></a> <code>device</code> <strong class="purple">must</strong> be a valid <code>VkDevice</code> handle</p>
</li>
<li>
<p><a id="VUID-vkResetEvent-event-parameter"></a> <code>event</code> <strong class="purple">must</strong> be a valid <code>VkEvent</code> handle</p>
</li>
<li>
<p><a id="VUID-vkResetEvent-event-parent"></a> <code>event</code> <strong class="purple">must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>event</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap2.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap2.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The state of an event <strong class="purple">can</strong> also be updated on the device by commands
inserted in command buffers.</p>
</div>
<div id="synchronization-events-signaling-device" class="openblock">
<div class="content">
<div class="paragraph">
<p>To set the state of an event to signaled from a device, call:</p>
</div>
<div id="vkCmdSetEvent" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="directive">void</span> vkCmdSetEvent(
    VkCommandBuffer                             commandBuffer,
    VkEvent                                     event,
    VkPipelineStageFlags                        stageMask);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command is
recorded.</p>
</li>
<li>
<p><code>event</code> is the event that will be signaled.</p>
</li>
<li>
<p><code>stageMask</code> specifies the <a href="#synchronization-pipeline-stages">source
stage mask</a> used to determine when the <code>event</code> is signaled.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When <a href="#vkCmdSetEvent">vkCmdSetEvent</a> is submitted to a queue, it defines an execution
dependency on commands that were submitted before it, and defines an event
signal operation which sets the event to the signaled state.</p>
</div>
<div class="paragraph">
<p>The first <a href="#synchronization-dependencies-scopes">synchronization scope</a>
includes all commands that occur earlier in
<a href="#synchronization-submission-order">submission order</a>.
The synchronization scope is limited to operations on the pipeline stages
determined by the <a href="#synchronization-pipeline-stages-masks">source stage
mask</a> specified by <code>stageMask</code>.</p>
</div>
<div class="paragraph">
<p>The second <a href="#synchronization-dependencies-scopes">synchronization scope</a>
includes only the event signal operation.</p>
</div>
<div class="paragraph">
<p>If <code>event</code> is already in the signaled state when <a href="#vkCmdSetEvent">vkCmdSetEvent</a> is
executed on the device, then <a href="#vkCmdSetEvent">vkCmdSetEvent</a> has no effect, no event
signal operation occurs, and no execution dependency is generated.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdSetEvent-stageMask-01149"></a>
<code>stageMask</code> <strong class="purple">must</strong> not include <code>VK_PIPELINE_STAGE_HOST_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdSetEvent-stageMask-01150"></a>
If the <a href="chap31.html#features-geometryShader">geometry shaders</a> feature is not
enabled, <code>stageMask</code> <strong class="purple">must</strong> not contain
<code>VK_PIPELINE_STAGE_GEOMETRY_SHADER_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdSetEvent-stageMask-01151"></a>
If the <a href="chap31.html#features-tessellationShader">tessellation shaders</a> feature is
not enabled, <code>stageMask</code> <strong class="purple">must</strong> not contain
<code>VK_PIPELINE_STAGE_TESSELLATION_CONTROL_SHADER_BIT</code> or
<code>VK_PIPELINE_STAGE_TESSELLATION_EVALUATION_SHADER_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdSetEvent-commandBuffer-01152"></a>
<code>commandBuffer</code>’s current device mask <strong class="purple">must</strong> include exactly one
physical device.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdSetEvent-commandBuffer-parameter"></a> <code>commandBuffer</code> <strong class="purple">must</strong> be a valid <code>VkCommandBuffer</code> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdSetEvent-event-parameter"></a> <code>event</code> <strong class="purple">must</strong> be a valid <code>VkEvent</code> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdSetEvent-stageMask-parameter"></a> <code>stageMask</code> <strong class="purple">must</strong> be a valid combination of <a href="#VkPipelineStageFlagBits">VkPipelineStageFlagBits</a> values</p>
</li>
<li>
<p><a id="VUID-vkCmdSetEvent-stageMask-requiredbitmask"></a> <code>stageMask</code> <strong class="purple">must</strong> not be <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkCmdSetEvent-commandBuffer-recording"></a> <code>commandBuffer</code> <strong class="purple">must</strong> be in the <a href="chap5.html#commandbuffers-lifecycle">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdSetEvent-commandBuffer-cmdpool"></a> The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> support graphics, or compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdSetEvent-renderpass"></a> This command <strong class="purple">must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdSetEvent-commonparent"></a> Both of <code>commandBuffer</code>, and <code>event</code> <strong class="purple">must</strong> have been created, allocated, or retrieved from the same <code>VkDevice</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="chap5.html#VkCommandBufferLevel">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="chap7.html#vkCmdBeginRenderPass">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap4.html#VkQueueFlagBits">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="#synchronization-pipeline-stages-types">Pipeline Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Graphics<br>
Compute</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="synchronization-events-unsignaling-device" class="openblock">
<div class="content">
<div class="paragraph">
<p>To set the state of an event to unsignaled from a device, call:</p>
</div>
<div id="vkCmdResetEvent" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="directive">void</span> vkCmdResetEvent(
    VkCommandBuffer                             commandBuffer,
    VkEvent                                     event,
    VkPipelineStageFlags                        stageMask);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command is
recorded.</p>
</li>
<li>
<p><code>event</code> is the event that will be unsignaled.</p>
</li>
<li>
<p><code>stageMask</code> is a bitmask of <a href="#VkPipelineStageFlagBits">VkPipelineStageFlagBits</a> specifying
the <a href="#synchronization-pipeline-stages">source stage mask</a> used to
determine when the <code>event</code> is unsignaled.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When <a href="#vkCmdResetEvent">vkCmdResetEvent</a> is submitted to a queue, it defines an execution
dependency on commands that were submitted before it, and defines an event
unsignal operation which resets the event to the unsignaled state.</p>
</div>
<div class="paragraph">
<p>The first <a href="#synchronization-dependencies-scopes">synchronization scope</a>
includes all commands that occur earlier in
<a href="#synchronization-submission-order">submission order</a>.
The synchronization scope is limited to operations on the pipeline stages
determined by the <a href="#synchronization-pipeline-stages-masks">source stage
mask</a> specified by <code>stageMask</code>.</p>
</div>
<div class="paragraph">
<p>The second <a href="#synchronization-dependencies-scopes">synchronization scope</a>
includes only the event unsignal operation.</p>
</div>
<div class="paragraph">
<p>If <code>event</code> is already in the unsignaled state when <a href="#vkCmdResetEvent">vkCmdResetEvent</a>
is executed on the device, then <a href="#vkCmdResetEvent">vkCmdResetEvent</a> has no effect, no
event unsignal operation occurs, and no execution dependency is generated.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdResetEvent-stageMask-01153"></a>
<code>stageMask</code> <strong class="purple">must</strong> not include <code>VK_PIPELINE_STAGE_HOST_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdResetEvent-stageMask-01154"></a>
If the <a href="chap31.html#features-geometryShader">geometry shaders</a> feature is not
enabled, <code>stageMask</code> <strong class="purple">must</strong> not contain
<code>VK_PIPELINE_STAGE_GEOMETRY_SHADER_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdResetEvent-stageMask-01155"></a>
If the <a href="chap31.html#features-tessellationShader">tessellation shaders</a> feature is
not enabled, <code>stageMask</code> <strong class="purple">must</strong> not contain
<code>VK_PIPELINE_STAGE_TESSELLATION_CONTROL_SHADER_BIT</code> or
<code>VK_PIPELINE_STAGE_TESSELLATION_EVALUATION_SHADER_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdResetEvent-event-01156"></a>
When this command executes, <code>event</code> <strong class="purple">must</strong> not be waited on by a
<code>vkCmdWaitEvents</code> command that is currently executing</p>
</li>
<li>
<p><a id="VUID-vkCmdResetEvent-commandBuffer-01157"></a>
<code>commandBuffer</code>’s current device mask <strong class="purple">must</strong> include exactly one
physical device.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdResetEvent-commandBuffer-parameter"></a> <code>commandBuffer</code> <strong class="purple">must</strong> be a valid <code>VkCommandBuffer</code> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdResetEvent-event-parameter"></a> <code>event</code> <strong class="purple">must</strong> be a valid <code>VkEvent</code> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdResetEvent-stageMask-parameter"></a> <code>stageMask</code> <strong class="purple">must</strong> be a valid combination of <a href="#VkPipelineStageFlagBits">VkPipelineStageFlagBits</a> values</p>
</li>
<li>
<p><a id="VUID-vkCmdResetEvent-stageMask-requiredbitmask"></a> <code>stageMask</code> <strong class="purple">must</strong> not be <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkCmdResetEvent-commandBuffer-recording"></a> <code>commandBuffer</code> <strong class="purple">must</strong> be in the <a href="chap5.html#commandbuffers-lifecycle">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdResetEvent-commandBuffer-cmdpool"></a> The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> support graphics, or compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdResetEvent-renderpass"></a> This command <strong class="purple">must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdResetEvent-commonparent"></a> Both of <code>commandBuffer</code>, and <code>event</code> <strong class="purple">must</strong> have been created, allocated, or retrieved from the same <code>VkDevice</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="chap5.html#VkCommandBufferLevel">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="chap7.html#vkCmdBeginRenderPass">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap4.html#VkQueueFlagBits">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="#synchronization-pipeline-stages-types">Pipeline Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Graphics<br>
Compute</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To wait for one or more events to enter the signaled state on a device,
call:</p>
</div>
<div id="vkCmdWaitEvents" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="directive">void</span> vkCmdWaitEvents(
    VkCommandBuffer                             commandBuffer,
    uint32_t                                    eventCount,
    <span class="directive">const</span> VkEvent*                              pEvents,
    VkPipelineStageFlags                        srcStageMask,
    VkPipelineStageFlags                        dstStageMask,
    uint32_t                                    memoryBarrierCount,
    <span class="directive">const</span> VkMemoryBarrier*                      pMemoryBarriers,
    uint32_t                                    bufferMemoryBarrierCount,
    <span class="directive">const</span> VkBufferMemoryBarrier*                pBufferMemoryBarriers,
    uint32_t                                    imageMemoryBarrierCount,
    <span class="directive">const</span> VkImageMemoryBarrier*                 pImageMemoryBarriers);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command is
recorded.</p>
</li>
<li>
<p><code>eventCount</code> is the length of the <code>pEvents</code> array.</p>
</li>
<li>
<p><code>pEvents</code> is an array of event object handles to wait on.</p>
</li>
<li>
<p><code>srcStageMask</code> is a bitmask of <a href="#VkPipelineStageFlagBits">VkPipelineStageFlagBits</a>
specifying the <a href="#synchronization-pipeline-stages">source stage mask</a>.</p>
</li>
<li>
<p><code>dstStageMask</code> is a bitmask of <a href="#VkPipelineStageFlagBits">VkPipelineStageFlagBits</a>
specifying the <a href="#synchronization-pipeline-stages">destination stage
mask</a>.</p>
</li>
<li>
<p><code>memoryBarrierCount</code> is the length of the <code>pMemoryBarriers</code>
array.</p>
</li>
<li>
<p><code>pMemoryBarriers</code> is a pointer to an array of <a href="#VkMemoryBarrier">VkMemoryBarrier</a>
structures.</p>
</li>
<li>
<p><code>bufferMemoryBarrierCount</code> is the length of the
<code>pBufferMemoryBarriers</code> array.</p>
</li>
<li>
<p><code>pBufferMemoryBarriers</code> is a pointer to an array of
<a href="#VkBufferMemoryBarrier">VkBufferMemoryBarrier</a> structures.</p>
</li>
<li>
<p><code>imageMemoryBarrierCount</code> is the length of the
<code>pImageMemoryBarriers</code> array.</p>
</li>
<li>
<p><code>pImageMemoryBarriers</code> is a pointer to an array of
<a href="#VkImageMemoryBarrier">VkImageMemoryBarrier</a> structures.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When <code>vkCmdWaitEvents</code> is submitted to a queue, it defines a memory
dependency between prior event signal operations on the same queue or the
host, and subsequent commands.
<code>vkCmdWaitEvents</code> <strong class="purple">must</strong> not be used to wait on event signal operations
occurring on other queues.</p>
</div>
<div class="paragraph">
<p>The first synchronization scope only includes event signal operations that
operate on members of <code>pEvents</code>, and the operations that happened-before
the event signal operations.
Event signal operations performed by <a href="#vkCmdSetEvent">vkCmdSetEvent</a> that occur earlier
in <a href="#synchronization-submission-order">submission order</a> are included in the
first synchronization scope, if the <a href="#synchronization-pipeline-stages-order">logically latest</a> pipeline stage in their <code>stageMask</code> parameter is
<a href="#synchronization-pipeline-stages-order">logically earlier</a> than or equal
to the <a href="#synchronization-pipeline-stages-order">logically latest</a> pipeline
stage in <code>srcStageMask</code>.
Event signal operations performed by <a href="#vkSetEvent">vkSetEvent</a> are only included in
the first synchronization scope if <code>VK_PIPELINE_STAGE_HOST_BIT</code> is
included in <code>srcStageMask</code>.</p>
</div>
<div class="paragraph">
<p>The second <a href="#synchronization-dependencies-scopes">synchronization scope</a>
includes all commands that occur later in
<a href="#synchronization-submission-order">submission order</a>.
The second synchronization scope is limited to operations on the pipeline
stages determined by the <a href="#synchronization-pipeline-stages-masks">destination stage mask</a> specified by <code>dstStageMask</code>.</p>
</div>
<div class="paragraph">
<p>The first <a href="#synchronization-dependencies-access-scopes">access scope</a> is
limited to access in the pipeline stages determined by the
<a href="#synchronization-pipeline-stages-masks">source stage mask</a> specified by
<code>srcStageMask</code>.
Within that, the first access scope only includes the first access scopes
defined by elements of the <code>pMemoryBarriers</code>,
<code>pBufferMemoryBarriers</code> and <code>pImageMemoryBarriers</code> arrays, which
each define a set of <a href="#synchronization-memory-barriers">memory barriers</a>.
If no memory barriers are specified, then the first access scope includes no
accesses.</p>
</div>
<div class="paragraph">
<p>The second <a href="#synchronization-dependencies-access-scopes">access scope</a> is
limited to access in the pipeline stages determined by the
<a href="#synchronization-pipeline-stages-masks">destination stage mask</a> specified
by <code>dstStageMask</code>.
Within that, the second access scope only includes the second access scopes
defined by elements of the <code>pMemoryBarriers</code>,
<code>pBufferMemoryBarriers</code> and <code>pImageMemoryBarriers</code> arrays, which
each define a set of <a href="#synchronization-memory-barriers">memory barriers</a>.
If no memory barriers are specified, then the second access scope includes
no accesses.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p><a href="#vkCmdWaitEvents">vkCmdWaitEvents</a> is used with <a href="#vkCmdSetEvent">vkCmdSetEvent</a> to define a memory
dependency between two sets of action commands, roughly in the same way as
pipeline barriers, but split into two commands such that work between the
two <strong class="purple">may</strong> execute unhindered.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Applications <strong class="purple">should</strong> be careful to avoid race conditions when using events.
There is no direct ordering guarantee between a <a href="#vkCmdResetEvent">vkCmdResetEvent</a>
command and a <a href="#vkCmdWaitEvents">vkCmdWaitEvents</a> command submitted after it, so some
other execution dependency <strong class="purple">must</strong> be included between these commands (e.g. a
semaphore).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdWaitEvents-srcStageMask-01158"></a>
<code>srcStageMask</code> <strong class="purple">must</strong> be the bitwise OR of the <code>stageMask</code>
parameter used in previous calls to <code>vkCmdSetEvent</code> with any of the
members of <code>pEvents</code> and <code>VK_PIPELINE_STAGE_HOST_BIT</code> if any of
the members of <code>pEvents</code> was set using <code>vkSetEvent</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWaitEvents-srcStageMask-01159"></a>
If the <a href="chap31.html#features-geometryShader">geometry shaders</a> feature is not
enabled, <code>srcStageMask</code> <strong class="purple">must</strong> not contain
<code>VK_PIPELINE_STAGE_GEOMETRY_SHADER_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWaitEvents-dstStageMask-01160"></a>
If the <a href="chap31.html#features-geometryShader">geometry shaders</a> feature is not
enabled, <code>dstStageMask</code> <strong class="purple">must</strong> not contain
<code>VK_PIPELINE_STAGE_GEOMETRY_SHADER_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWaitEvents-srcStageMask-01161"></a>
If the <a href="chap31.html#features-tessellationShader">tessellation shaders</a> feature is
not enabled, <code>srcStageMask</code> <strong class="purple">must</strong> not contain
<code>VK_PIPELINE_STAGE_TESSELLATION_CONTROL_SHADER_BIT</code> or
<code>VK_PIPELINE_STAGE_TESSELLATION_EVALUATION_SHADER_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWaitEvents-dstStageMask-01162"></a>
If the <a href="chap31.html#features-tessellationShader">tessellation shaders</a> feature is
not enabled, <code>dstStageMask</code> <strong class="purple">must</strong> not contain
<code>VK_PIPELINE_STAGE_TESSELLATION_CONTROL_SHADER_BIT</code> or
<code>VK_PIPELINE_STAGE_TESSELLATION_EVALUATION_SHADER_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWaitEvents-pEvents-01163"></a>
If <code>pEvents</code> includes one or more events that will be signaled by
<code>vkSetEvent</code> after <code>commandBuffer</code> has been submitted to a
queue, then <code>vkCmdWaitEvents</code> <strong class="purple">must</strong> not be called inside a render
pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdWaitEvents-srcStageMask-01164"></a>
Any pipeline stage included in <code>srcStageMask</code> or <code>dstStageMask</code>
<strong class="purple">must</strong> be supported by the capabilities of the queue family specified by
the <code>queueFamilyIndex</code> member of the <a href="chap5.html#VkCommandPoolCreateInfo">VkCommandPoolCreateInfo</a>
structure that was used to create the <code>VkCommandPool</code> that
<code>commandBuffer</code> was allocated from, as specified in the
<a href="#synchronization-pipeline-stages-supported">table of supported pipeline
stages</a>.</p>
</li>
<li>
<p><a id="VUID-vkCmdWaitEvents-pMemoryBarriers-01165"></a>
Each element of <code>pMemoryBarriers</code>, <code>pBufferMemoryBarriers</code> or
<code>pImageMemoryBarriers</code> <strong class="purple">must</strong> not have any access flag included in
its <code>srcAccessMask</code> member if that bit is not supported by any of
the pipeline stages in <code>srcStageMask</code>, as specified in the
<a href="#synchronization-access-types-supported">table of supported access
types</a>.</p>
</li>
<li>
<p><a id="VUID-vkCmdWaitEvents-pMemoryBarriers-01166"></a>
Each element of <code>pMemoryBarriers</code>, <code>pBufferMemoryBarriers</code> or
<code>pImageMemoryBarriers</code> <strong class="purple">must</strong> not have any access flag included in
its <code>dstAccessMask</code> member if that bit is not supported by any of
the pipeline stages in <code>dstStageMask</code>, as specified in the
<a href="#synchronization-access-types-supported">table of supported access
types</a>.</p>
</li>
<li>
<p><a id="VUID-vkCmdWaitEvents-commandBuffer-01167"></a>
<code>commandBuffer</code>’s current device mask <strong class="purple">must</strong> include exactly one
physical device.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdWaitEvents-commandBuffer-parameter"></a> <code>commandBuffer</code> <strong class="purple">must</strong> be a valid <code>VkCommandBuffer</code> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdWaitEvents-pEvents-parameter"></a> <code>pEvents</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>eventCount</code> valid <code>VkEvent</code> handles</p>
</li>
<li>
<p><a id="VUID-vkCmdWaitEvents-srcStageMask-parameter"></a> <code>srcStageMask</code> <strong class="purple">must</strong> be a valid combination of <a href="#VkPipelineStageFlagBits">VkPipelineStageFlagBits</a> values</p>
</li>
<li>
<p><a id="VUID-vkCmdWaitEvents-srcStageMask-requiredbitmask"></a> <code>srcStageMask</code> <strong class="purple">must</strong> not be <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWaitEvents-dstStageMask-parameter"></a> <code>dstStageMask</code> <strong class="purple">must</strong> be a valid combination of <a href="#VkPipelineStageFlagBits">VkPipelineStageFlagBits</a> values</p>
</li>
<li>
<p><a id="VUID-vkCmdWaitEvents-dstStageMask-requiredbitmask"></a> <code>dstStageMask</code> <strong class="purple">must</strong> not be <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWaitEvents-pMemoryBarriers-parameter"></a> If <code>memoryBarrierCount</code> is not <code>0</code>, <code>pMemoryBarriers</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>memoryBarrierCount</code> valid <code>VkMemoryBarrier</code> structures</p>
</li>
<li>
<p><a id="VUID-vkCmdWaitEvents-pBufferMemoryBarriers-parameter"></a> If <code>bufferMemoryBarrierCount</code> is not <code>0</code>, <code>pBufferMemoryBarriers</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>bufferMemoryBarrierCount</code> valid <code>VkBufferMemoryBarrier</code> structures</p>
</li>
<li>
<p><a id="VUID-vkCmdWaitEvents-pImageMemoryBarriers-parameter"></a> If <code>imageMemoryBarrierCount</code> is not <code>0</code>, <code>pImageMemoryBarriers</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>imageMemoryBarrierCount</code> valid <code>VkImageMemoryBarrier</code> structures</p>
</li>
<li>
<p><a id="VUID-vkCmdWaitEvents-commandBuffer-recording"></a> <code>commandBuffer</code> <strong class="purple">must</strong> be in the <a href="chap5.html#commandbuffers-lifecycle">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdWaitEvents-commandBuffer-cmdpool"></a> The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> support graphics, or compute operations</p>
</li>
<li>
<p><a id="VUID-vkCmdWaitEvents-eventCount-arraylength"></a> <code>eventCount</code> <strong class="purple">must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWaitEvents-commonparent"></a> Both of <code>commandBuffer</code>, and the elements of <code>pEvents</code> <strong class="purple">must</strong> have been created, allocated, or retrieved from the same <code>VkDevice</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="chap5.html#VkCommandBufferLevel">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="chap7.html#vkCmdBeginRenderPass">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap4.html#VkQueueFlagBits">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="#synchronization-pipeline-stages-types">Pipeline Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Both</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Graphics<br>
Compute</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="synchronization-pipeline-barriers">6.6. Pipeline Barriers</h3>
<div class="paragraph">
<p><a href="#vkCmdPipelineBarrier">vkCmdPipelineBarrier</a> is a synchronization command that inserts a
dependency between commands submitted to the same queue, or between commands
in the same subpass.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To record a pipeline barrier, call:</p>
</div>
<div id="vkCmdPipelineBarrier" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="directive">void</span> vkCmdPipelineBarrier(
    VkCommandBuffer                             commandBuffer,
    VkPipelineStageFlags                        srcStageMask,
    VkPipelineStageFlags                        dstStageMask,
    VkDependencyFlags                           dependencyFlags,
    uint32_t                                    memoryBarrierCount,
    <span class="directive">const</span> VkMemoryBarrier*                      pMemoryBarriers,
    uint32_t                                    bufferMemoryBarrierCount,
    <span class="directive">const</span> VkBufferMemoryBarrier*                pBufferMemoryBarriers,
    uint32_t                                    imageMemoryBarrierCount,
    <span class="directive">const</span> VkImageMemoryBarrier*                 pImageMemoryBarriers);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command is
recorded.</p>
</li>
<li>
<p><code>srcStageMask</code> is a bitmask of <a href="#VkPipelineStageFlagBits">VkPipelineStageFlagBits</a>
specifying the <a href="#synchronization-pipeline-stages-masks">source stage
mask</a>.</p>
</li>
<li>
<p><code>dstStageMask</code> is a bitmask of <a href="#VkPipelineStageFlagBits">VkPipelineStageFlagBits</a>
specifying the <a href="#synchronization-pipeline-stages-masks">destination
stage mask</a>.</p>
</li>
<li>
<p><code>dependencyFlags</code> is a bitmask of <a href="#VkDependencyFlagBits">VkDependencyFlagBits</a>
specifying how execution and memory dependencies are formed.</p>
</li>
<li>
<p><code>memoryBarrierCount</code> is the length of the <code>pMemoryBarriers</code>
array.</p>
</li>
<li>
<p><code>pMemoryBarriers</code> is a pointer to an array of <a href="#VkMemoryBarrier">VkMemoryBarrier</a>
structures.</p>
</li>
<li>
<p><code>bufferMemoryBarrierCount</code> is the length of the
<code>pBufferMemoryBarriers</code> array.</p>
</li>
<li>
<p><code>pBufferMemoryBarriers</code> is a pointer to an array of
<a href="#VkBufferMemoryBarrier">VkBufferMemoryBarrier</a> structures.</p>
</li>
<li>
<p><code>imageMemoryBarrierCount</code> is the length of the
<code>pImageMemoryBarriers</code> array.</p>
</li>
<li>
<p><code>pImageMemoryBarriers</code> is a pointer to an array of
<a href="#VkImageMemoryBarrier">VkImageMemoryBarrier</a> structures.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When <a href="#vkCmdPipelineBarrier">vkCmdPipelineBarrier</a> is submitted to a queue, it defines a memory
dependency between commands that were submitted before it, and those
submitted after it.</p>
</div>
<div class="paragraph">
<p>If <a href="#vkCmdPipelineBarrier">vkCmdPipelineBarrier</a> was recorded outside a render pass instance,
the first <a href="#synchronization-dependencies-scopes">synchronization scope</a>
includes all commands that occur earlier in
<a href="#synchronization-submission-order">submission order</a>.
If <a href="#vkCmdPipelineBarrier">vkCmdPipelineBarrier</a> was recorded inside a render pass instance,
the first synchronization scope includes only commands that occur earlier in
<a href="#synchronization-submission-order">submission order</a> within the same
subpass.
In either case, the first synchronization scope is limited to operations on
the pipeline stages determined by the
<a href="#synchronization-pipeline-stages-masks">source stage mask</a> specified by
<code>srcStageMask</code>.</p>
</div>
<div class="paragraph">
<p>If <a href="#vkCmdPipelineBarrier">vkCmdPipelineBarrier</a> was recorded outside a render pass instance,
the second <a href="#synchronization-dependencies-scopes">synchronization scope</a>
includes all commands that occur later in
<a href="#synchronization-submission-order">submission order</a>.
If <a href="#vkCmdPipelineBarrier">vkCmdPipelineBarrier</a> was recorded inside a render pass instance,
the second synchronization scope includes only commands that occur later in
<a href="#synchronization-submission-order">submission order</a> within the same
subpass.
In either case, the second synchronization scope is limited to operations on
the pipeline stages determined by the
<a href="#synchronization-pipeline-stages-masks">destination stage mask</a> specified
by <code>dstStageMask</code>.</p>
</div>
<div class="paragraph">
<p>The first <a href="#synchronization-dependencies-access-scopes">access scope</a> is
limited to access in the pipeline stages determined by the
<a href="#synchronization-pipeline-stages-masks">source stage mask</a> specified by
<code>srcStageMask</code>.
Within that, the first access scope only includes the first access scopes
defined by elements of the <code>pMemoryBarriers</code>,
<code>pBufferMemoryBarriers</code> and <code>pImageMemoryBarriers</code> arrays, which
each define a set of <a href="#synchronization-memory-barriers">memory barriers</a>.
If no memory barriers are specified, then the first access scope includes no
accesses.</p>
</div>
<div class="paragraph">
<p>The second <a href="#synchronization-dependencies-access-scopes">access scope</a> is
limited to access in the pipeline stages determined by the
<a href="#synchronization-pipeline-stages-masks">destination stage mask</a> specified
by <code>dstStageMask</code>.
Within that, the second access scope only includes the second access scopes
defined by elements of the <code>pMemoryBarriers</code>,
<code>pBufferMemoryBarriers</code> and <code>pImageMemoryBarriers</code> arrays, which
each define a set of <a href="#synchronization-memory-barriers">memory barriers</a>.
If no memory barriers are specified, then the second access scope includes
no accesses.</p>
</div>
<div class="paragraph">
<p>If <code>dependencyFlags</code> includes <code>VK_DEPENDENCY_BY_REGION_BIT</code>, then
any dependency between <a href="#synchronization-framebuffer-regions">framebuffer-space</a> pipeline stages is
<a href="#synchronization-framebuffer-regions">framebuffer-local</a> - otherwise it is
<a href="#synchronization-framebuffer-regions">framebuffer-global</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-srcStageMask-01168"></a>
If the <a href="chap31.html#features-geometryShader">geometry shaders</a> feature is not
enabled, <code>srcStageMask</code> <strong class="purple">must</strong> not contain
<code>VK_PIPELINE_STAGE_GEOMETRY_SHADER_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-dstStageMask-01169"></a>
If the <a href="chap31.html#features-geometryShader">geometry shaders</a> feature is not
enabled, <code>dstStageMask</code> <strong class="purple">must</strong> not contain
<code>VK_PIPELINE_STAGE_GEOMETRY_SHADER_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-srcStageMask-01170"></a>
If the <a href="chap31.html#features-tessellationShader">tessellation shaders</a> feature is
not enabled, <code>srcStageMask</code> <strong class="purple">must</strong> not contain
<code>VK_PIPELINE_STAGE_TESSELLATION_CONTROL_SHADER_BIT</code> or
<code>VK_PIPELINE_STAGE_TESSELLATION_EVALUATION_SHADER_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-dstStageMask-01171"></a>
If the <a href="chap31.html#features-tessellationShader">tessellation shaders</a> feature is
not enabled, <code>dstStageMask</code> <strong class="purple">must</strong> not contain
<code>VK_PIPELINE_STAGE_TESSELLATION_CONTROL_SHADER_BIT</code> or
<code>VK_PIPELINE_STAGE_TESSELLATION_EVALUATION_SHADER_BIT</code></p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-pDependencies-02285"></a>
If <code>vkCmdPipelineBarrier</code> is called within a render pass instance,
the render pass <strong class="purple">must</strong> have been created with at least one
<code>VkSubpassDependency</code> instance in
<code>VkRenderPassCreateInfo</code>::<code>pDependencies</code> that expresses a
dependency from the current subpass to itself, and for which
<code>srcStageMask</code> contains a subset of the bit values in
<code>VkSubpassDependency</code>::<code>srcStageMask</code>, <code>dstStageMask</code>
contains a subset of the bit values in
<code>VkSubpassDependency</code>::<code>dstStageMask</code>, <code>dependencyFlags</code> is
equal to <code>VkSubpassDependency</code>::<code>dependencyFlags</code>,
<code>srcAccessMask</code> member of each element of <code>pMemoryBarriers</code> and
<code>pImageMemoryBarriers</code> contains a subset of the bit values in
<code>VkSubpassDependency</code>::<code>srcAccessMask</code>, and <code>dstAccessMask</code>
member of each element of <code>pMemoryBarriers</code> and
<code>pImageMemoryBarriers</code> contains a subset of the bit values in
<code>VkSubpassDependency</code>::<code>dstAccessMask</code></p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-bufferMemoryBarrierCount-01178"></a>
If <code>vkCmdPipelineBarrier</code> is called within a render pass instance,
<code>bufferMemoryBarrierCount</code> <strong class="purple">must</strong> be <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-image-02635"></a>
If <code>vkCmdPipelineBarrier</code> is called within a render pass instance,
the <code>image</code> member of any element of <code>pImageMemoryBarriers</code>
<strong class="purple">must</strong> be equal to one of the elements of <code>pAttachments</code> that the
current <code>framebuffer</code> was created with, that is also referred to by
one of the elements of the <code>pColorAttachments</code>,
<code>pResolveAttachments</code> or <code>pDepthStencilAttachment</code> members of
the <code>VkSubpassDescription</code> instance or by the
<code>pDepthStencilResolveAttachment</code> member of the
<code>VkSubpassDescriptionDepthStencilResolveKHR</code> structure that the
current subpass was created with</p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-oldLayout-02636"></a>
If <code>vkCmdPipelineBarrier</code> is called within a render pass instance,
the <code>oldLayout</code> and <code>newLayout</code> members of any element of
<code>pImageMemoryBarriers</code> <strong class="purple">must</strong> be equal to the <code>layout</code> member of
an element of the <code>pColorAttachments</code>, <code>pResolveAttachments</code> or
<code>pDepthStencilAttachment</code> members of the <code>VkSubpassDescription</code>
instance or by the <code>pDepthStencilResolveAttachment</code> member of the
<code>VkSubpassDescriptionDepthStencilResolveKHR</code> structure that the
current subpass was created with, that refers to the same <code>image</code></p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-oldLayout-01181"></a>
If <code>vkCmdPipelineBarrier</code> is called within a render pass instance,
the <code>oldLayout</code> and <code>newLayout</code> members of an element of
<code>pImageMemoryBarriers</code> <strong class="purple">must</strong> be equal</p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-srcQueueFamilyIndex-01182"></a>
If <code>vkCmdPipelineBarrier</code> is called within a render pass instance,
the <code>srcQueueFamilyIndex</code> and <code>dstQueueFamilyIndex</code> members of
any element of <code>pImageMemoryBarriers</code> <strong class="purple">must</strong> be
<code>VK_QUEUE_FAMILY_IGNORED</code></p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-srcStageMask-01183"></a>
Any pipeline stage included in <code>srcStageMask</code> or <code>dstStageMask</code>
<strong class="purple">must</strong> be supported by the capabilities of the queue family specified by
the <code>queueFamilyIndex</code> member of the <a href="chap5.html#VkCommandPoolCreateInfo">VkCommandPoolCreateInfo</a>
structure that was used to create the <code>VkCommandPool</code> that
<code>commandBuffer</code> was allocated from, as specified in the
<a href="#synchronization-pipeline-stages-supported">table of supported pipeline
stages</a>.</p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-pMemoryBarriers-01184"></a>
Each element of <code>pMemoryBarriers</code>, <code>pBufferMemoryBarriers</code> and
<code>pImageMemoryBarriers</code> <strong class="purple">must</strong> not have any access flag included in
its <code>srcAccessMask</code> member if that bit is not supported by any of
the pipeline stages in <code>srcStageMask</code>, as specified in the
<a href="#synchronization-access-types-supported">table of supported access
types</a>.</p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-pMemoryBarriers-01185"></a>
Each element of <code>pMemoryBarriers</code>, <code>pBufferMemoryBarriers</code> and
<code>pImageMemoryBarriers</code> <strong class="purple">must</strong> not have any access flag included in
its <code>dstAccessMask</code> member if that bit is not supported by any of
the pipeline stages in <code>dstStageMask</code>, as specified in the
<a href="#synchronization-access-types-supported">table of supported access
types</a>.</p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-dependencyFlags-01186"></a>
If <code>vkCmdPipelineBarrier</code> is called outside of a render pass
instance, <code>dependencyFlags</code> <strong class="purple">must</strong> not include
<code>VK_DEPENDENCY_VIEW_LOCAL_BIT</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-commandBuffer-parameter"></a> <code>commandBuffer</code> <strong class="purple">must</strong> be a valid <code>VkCommandBuffer</code> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-srcStageMask-parameter"></a> <code>srcStageMask</code> <strong class="purple">must</strong> be a valid combination of <a href="#VkPipelineStageFlagBits">VkPipelineStageFlagBits</a> values</p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-srcStageMask-requiredbitmask"></a> <code>srcStageMask</code> <strong class="purple">must</strong> not be <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-dstStageMask-parameter"></a> <code>dstStageMask</code> <strong class="purple">must</strong> be a valid combination of <a href="#VkPipelineStageFlagBits">VkPipelineStageFlagBits</a> values</p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-dstStageMask-requiredbitmask"></a> <code>dstStageMask</code> <strong class="purple">must</strong> not be <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-dependencyFlags-parameter"></a> <code>dependencyFlags</code> <strong class="purple">must</strong> be a valid combination of <a href="#VkDependencyFlagBits">VkDependencyFlagBits</a> values</p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-pMemoryBarriers-parameter"></a> If <code>memoryBarrierCount</code> is not <code>0</code>, <code>pMemoryBarriers</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>memoryBarrierCount</code> valid <code>VkMemoryBarrier</code> structures</p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-pBufferMemoryBarriers-parameter"></a> If <code>bufferMemoryBarrierCount</code> is not <code>0</code>, <code>pBufferMemoryBarriers</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>bufferMemoryBarrierCount</code> valid <code>VkBufferMemoryBarrier</code> structures</p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-pImageMemoryBarriers-parameter"></a> If <code>imageMemoryBarrierCount</code> is not <code>0</code>, <code>pImageMemoryBarriers</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>imageMemoryBarrierCount</code> valid <code>VkImageMemoryBarrier</code> structures</p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-commandBuffer-recording"></a> <code>commandBuffer</code> <strong class="purple">must</strong> be in the <a href="chap5.html#commandbuffers-lifecycle">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdPipelineBarrier-commandBuffer-cmdpool"></a> The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> support transfer, graphics, or compute operations</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="chap5.html#VkCommandBufferLevel">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="chap7.html#vkCmdBeginRenderPass">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap4.html#VkQueueFlagBits">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="#synchronization-pipeline-stages-types">Pipeline Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Both</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transfer<br>
Graphics<br>
Compute</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Bits which <strong class="purple">can</strong> be set in <code>vkCmdPipelineBarrier</code>::<code>dependencyFlags</code>,
specifying how execution and memory dependencies are formed, are:</p>
</div>
<div id="VkDependencyFlagBits" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">enum</span> VkDependencyFlagBits {
    VK_DEPENDENCY_BY_REGION_BIT = <span class="hex">0x00000001</span>,
    VK_DEPENDENCY_DEVICE_GROUP_BIT = <span class="hex">0x00000004</span>,
    VK_DEPENDENCY_VIEW_LOCAL_BIT = <span class="hex">0x00000002</span>,
    VK_DEPENDENCY_VIEW_LOCAL_BIT_KHR = VK_DEPENDENCY_VIEW_LOCAL_BIT,
    VK_DEPENDENCY_DEVICE_GROUP_BIT_KHR = VK_DEPENDENCY_DEVICE_GROUP_BIT,
    VK_DEPENDENCY_FLAG_BITS_MAX_ENUM = <span class="hex">0x7FFFFFFF</span>
} VkDependencyFlagBits;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_DEPENDENCY_BY_REGION_BIT</code> specifies that dependencies will be
<a href="#synchronization-framebuffer-regions">framebuffer-local</a>.</p>
</li>
<li>
<p><code>VK_DEPENDENCY_VIEW_LOCAL_BIT</code> specifies that a
<a href="#synchronization-pipeline-barriers-subpass-self-dependencies">subpass
has more than one view</a>.</p>
</li>
<li>
<p><code>VK_DEPENDENCY_DEVICE_GROUP_BIT</code> specifies that dependencies are
<a href="#synchronization-device-local-dependencies">non-device-local
dependency</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkDependencyFlags" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> VkFlags VkDependencyFlags;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkDependencyFlags</code> is a bitmask type for setting a mask of zero or more
<a href="#VkDependencyFlagBits">VkDependencyFlagBits</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="synchronization-pipeline-barriers-subpass-self-dependencies">6.6.1. Subpass Self-dependency</h4>
<div class="paragraph">
<p>If <code>vkCmdPipelineBarrier</code> is called inside a render pass instance, the
following restrictions apply.
For a given subpass to allow a pipeline barrier, the render pass <strong class="purple">must</strong>
declare a <em>self-dependency</em> from that subpass to itself.
That is, there <strong class="purple">must</strong> exist a <code>VkSubpassDependency</code> in the subpass
dependency list for the render pass with <code>srcSubpass</code> and
<code>dstSubpass</code> equal to that subpass index.
More than one self-dependency <strong class="purple">can</strong> be declared for each subpass.</p>
</div>
<div class="paragraph">
<p>Self-dependencies <strong class="purple">must</strong> only include pipeline stage bits that are graphics
stages.
If any of the stages in <code>srcStages</code> are
<a href="#synchronization-framebuffer-regions">framebuffer-space stages</a>,
<code>dstStages</code> <strong class="purple">must</strong> only contain
<a href="#synchronization-framebuffer-regions">framebuffer-space stages</a>.
Additionally, <code>srcStages</code> <strong class="purple">must</strong> not contain
<code>VK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BIT</code> in a self-dependency.</p>
</div>
<div class="paragraph">
<p>If the source and destination stage masks both include framebuffer-space
stages, then <code>dependencyFlags</code> <strong class="purple">must</strong> include
<code>VK_DEPENDENCY_BY_REGION_BIT</code>.
If the subpass has more than one view, then <code>dependencyFlags</code> <strong class="purple">must</strong>
include <code>VK_DEPENDENCY_VIEW_LOCAL_BIT</code>.</p>
</div>
<div class="paragraph">
<p>A <code>vkCmdPipelineBarrier</code> command inside a render pass instance <strong class="purple">must</strong> be
a <em>subset</em> of one of the self-dependencies of the subpass it is used in,
meaning that the stage masks and access masks <strong class="purple">must</strong> each include only a
subset of the bits of the corresponding mask in that self-dependency.
If the self-dependency has <code>VK_DEPENDENCY_BY_REGION_BIT</code>
or <code>VK_DEPENDENCY_VIEW_LOCAL_BIT</code>
set, then so <strong class="purple">must</strong> the pipeline barrier.
Pipeline barriers within a render pass instance <strong class="purple">can</strong> only be types
<code>VkMemoryBarrier</code> or <code>VkImageMemoryBarrier</code>.
If a <code>VkImageMemoryBarrier</code> is used, the image and image subresource
range specified in the barrier <strong class="purple">must</strong> be a subset of one of the image views
used by the framebuffer in the current subpass.
Additionally, <code>oldLayout</code> <strong class="purple">must</strong> be equal to <code>newLayout</code>, and both
the <code>srcQueueFamilyIndex</code> and <code>dstQueueFamilyIndex</code> <strong class="purple">must</strong> be
<code>VK_QUEUE_FAMILY_IGNORED</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="synchronization-memory-barriers">6.7. Memory Barriers</h3>
<div class="paragraph">
<p><em>Memory barriers</em> are used to explicitly control access to buffer and image
subresource ranges.
Memory barriers are used to <a href="#synchronization-queue-transfers">transfer
ownership between queue families</a>,
<a href="#synchronization-image-layout-transitions">change image layouts</a>, and
define <a href="#synchronization-dependencies-available-and-visible">availability
and visibility operations</a>.
They explicitly define the <a href="#synchronization-access-types">access types</a>
and buffer and image subresource ranges that are included in the
<a href="#synchronization-dependencies-access-scopes">access scopes</a> of a memory
dependency that is created by a synchronization command that includes them.</p>
</div>
<div class="sect3">
<h4 id="synchronization-global-memory-barriers">6.7.1. Global Memory Barriers</h4>
<div class="paragraph">
<p>Global memory barriers apply to memory accesses involving all memory objects
that exist at the time of its execution.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkMemoryBarrier</code> structure is defined as:</p>
</div>
<div id="VkMemoryBarrier" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">struct</span> VkMemoryBarrier {
    VkStructureType    sType;
    <span class="directive">const</span> <span class="directive">void</span>*        pNext;
    VkAccessFlags      srcAccessMask;
    VkAccessFlags      dstAccessMask;
} VkMemoryBarrier;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is the type of this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to an extension-specific structure.</p>
</li>
<li>
<p><code>srcAccessMask</code> is a bitmask of <a href="#VkAccessFlagBits">VkAccessFlagBits</a> specifying a
<a href="#synchronization-access-masks">source access mask</a>.</p>
</li>
<li>
<p><code>dstAccessMask</code> is a bitmask of <a href="#VkAccessFlagBits">VkAccessFlagBits</a> specifying a
<a href="#synchronization-access-masks">destination access mask</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first <a href="#synchronization-dependencies-access-scopes">access scope</a> is
limited to access types in the <a href="#synchronization-access-masks">source access
mask</a> specified by <code>srcAccessMask</code>.</p>
</div>
<div class="paragraph">
<p>The second <a href="#synchronization-dependencies-access-scopes">access scope</a> is
limited to access types in the <a href="#synchronization-access-masks">destination
access mask</a> specified by <code>dstAccessMask</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkMemoryBarrier-sType-sType"></a> <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_MEMORY_BARRIER</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryBarrier-pNext-pNext"></a> <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkMemoryBarrier-srcAccessMask-parameter"></a> <code>srcAccessMask</code> <strong class="purple">must</strong> be a valid combination of <a href="#VkAccessFlagBits">VkAccessFlagBits</a> values</p>
</li>
<li>
<p><a id="VUID-VkMemoryBarrier-dstAccessMask-parameter"></a> <code>dstAccessMask</code> <strong class="purple">must</strong> be a valid combination of <a href="#VkAccessFlagBits">VkAccessFlagBits</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="synchronization-buffer-memory-barriers">6.7.2. Buffer Memory Barriers</h4>
<div class="paragraph">
<p>Buffer memory barriers only apply to memory accesses involving a specific
buffer range.
That is, a memory dependency formed from a buffer memory barrier is
<a href="#synchronization-dependencies-access-scopes">scoped</a> to access via the
specified buffer range.
Buffer memory barriers <strong class="purple">can</strong> also be used to define a
<a href="#synchronization-queue-transfers">queue family ownership transfer</a> for the
specified buffer range.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkBufferMemoryBarrier</code> structure is defined as:</p>
</div>
<div id="VkBufferMemoryBarrier" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">struct</span> VkBufferMemoryBarrier {
    VkStructureType    sType;
    <span class="directive">const</span> <span class="directive">void</span>*        pNext;
    VkAccessFlags      srcAccessMask;
    VkAccessFlags      dstAccessMask;
    uint32_t           srcQueueFamilyIndex;
    uint32_t           dstQueueFamilyIndex;
    VkBuffer           buffer;
    VkDeviceSize       offset;
    VkDeviceSize       size;
} VkBufferMemoryBarrier;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is the type of this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to an extension-specific structure.</p>
</li>
<li>
<p><code>srcAccessMask</code> is a bitmask of <a href="#VkAccessFlagBits">VkAccessFlagBits</a> specifying a
<a href="#synchronization-access-masks">source access mask</a>.</p>
</li>
<li>
<p><code>dstAccessMask</code> is a bitmask of <a href="#VkAccessFlagBits">VkAccessFlagBits</a> specifying a
<a href="#synchronization-access-masks">destination access mask</a>.</p>
</li>
<li>
<p><code>srcQueueFamilyIndex</code> is the source queue family for a
<a href="#synchronization-queue-transfers">queue family ownership transfer</a>.</p>
</li>
<li>
<p><code>dstQueueFamilyIndex</code> is the destination queue family for a
<a href="#synchronization-queue-transfers">queue family ownership transfer</a>.</p>
</li>
<li>
<p><code>buffer</code> is a handle to the buffer whose backing memory is affected
by the barrier.</p>
</li>
<li>
<p><code>offset</code> is an offset in bytes into the backing memory for
<code>buffer</code>; this is relative to the base offset as bound to the buffer
(see <a href="chap11.html#vkBindBufferMemory">vkBindBufferMemory</a>).</p>
</li>
<li>
<p><code>size</code> is a size in bytes of the affected area of backing memory for
<code>buffer</code>, or <code>VK_WHOLE_SIZE</code> to use the range from <code>offset</code>
to the end of the buffer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first <a href="#synchronization-dependencies-access-scopes">access scope</a> is
limited to access to memory through the specified buffer range, via access
types in the <a href="#synchronization-access-masks">source access mask</a> specified
by <code>srcAccessMask</code>.
If <code>srcAccessMask</code> includes <code>VK_ACCESS_HOST_WRITE_BIT</code>, memory
writes performed by that access type are also made visible, as that access
type is not performed through a resource.</p>
</div>
<div class="paragraph">
<p>The second <a href="#synchronization-dependencies-access-scopes">access scope</a> is
limited to access to memory through the specified buffer range, via access
types in the <a href="#synchronization-access-masks">destination access mask</a>.
specified by <code>dstAccessMask</code>.
If <code>dstAccessMask</code> includes <code>VK_ACCESS_HOST_WRITE_BIT</code> or
<code>VK_ACCESS_HOST_READ_BIT</code>, available memory writes are also made visible
to accesses of those types, as those access types are not performed through
a resource.</p>
</div>
<div class="paragraph">
<p>If <code>srcQueueFamilyIndex</code> is not equal to <code>dstQueueFamilyIndex</code>, and
<code>srcQueueFamilyIndex</code> is equal to the current queue family, then the
memory barrier defines a <a href="#synchronization-queue-transfers-release">queue
family release operation</a> for the specified buffer range, and the second
access scope includes no access, as if <code>dstAccessMask</code> was <code>0</code>.</p>
</div>
<div class="paragraph">
<p>If <code>dstQueueFamilyIndex</code> is not equal to <code>srcQueueFamilyIndex</code>, and
<code>dstQueueFamilyIndex</code> is equal to the current queue family, then the
memory barrier defines a <a href="#synchronization-queue-transfers-acquire">queue
family acquire operation</a> for the specified buffer range, and the first
access scope includes no access, as if <code>srcAccessMask</code> was <code>0</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkBufferMemoryBarrier-offset-01187"></a>
<code>offset</code> <strong class="purple">must</strong> be less than the size of <code>buffer</code></p>
</li>
<li>
<p><a id="VUID-VkBufferMemoryBarrier-size-01188"></a>
If <code>size</code> is not equal to <code>VK_WHOLE_SIZE</code>, <code>size</code> <strong class="purple">must</strong> be
greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkBufferMemoryBarrier-size-01189"></a>
If <code>size</code> is not equal to <code>VK_WHOLE_SIZE</code>, <code>size</code> <strong class="purple">must</strong> be
less than or equal to than the size of <code>buffer</code> minus <code>offset</code></p>
</li>
<li>
<p><a id="VUID-VkBufferMemoryBarrier-buffer-01191"></a>
If <code>buffer</code> was created with a sharing mode of
<code>VK_SHARING_MODE_CONCURRENT</code>, at least one of
<code>srcQueueFamilyIndex</code> and <code>dstQueueFamilyIndex</code> <strong class="purple">must</strong> be
<code>VK_QUEUE_FAMILY_IGNORED</code></p>
</li>
<li>
<p><a id="VUID-VkBufferMemoryBarrier-buffer-01763"></a>
If <code>buffer</code> was created with a sharing mode of
<code>VK_SHARING_MODE_CONCURRENT</code>, and one of <code>srcQueueFamilyIndex</code>
and <code>dstQueueFamilyIndex</code> is <code>VK_QUEUE_FAMILY_IGNORED</code>, the
other <strong class="purple">must</strong> be <code>VK_QUEUE_FAMILY_IGNORED</code> or a special queue family
reserved for external memory ownership transfers, as described in
<a href="#synchronization-queue-transfers">Queue Family Ownership Transfer</a>.</p>
</li>
<li>
<p><a id="VUID-VkBufferMemoryBarrier-buffer-01193"></a>
If <code>buffer</code> was created with a sharing mode of
<code>VK_SHARING_MODE_EXCLUSIVE</code> and <code>srcQueueFamilyIndex</code> is
<code>VK_QUEUE_FAMILY_IGNORED</code>, <code>dstQueueFamilyIndex</code> <strong class="purple">must</strong> also be
<code>VK_QUEUE_FAMILY_IGNORED</code></p>
</li>
<li>
<p><a id="VUID-VkBufferMemoryBarrier-buffer-01764"></a>
If <code>buffer</code> was created with a sharing mode of
<code>VK_SHARING_MODE_EXCLUSIVE</code> and <code>srcQueueFamilyIndex</code> is not
<code>VK_QUEUE_FAMILY_IGNORED</code>, it <strong class="purple">must</strong> be a valid queue family or a
special queue family reserved for external memory transfers, as
described in <a href="#synchronization-queue-transfers">Queue Family Ownership Transfer</a>.</p>
</li>
<li>
<p><a id="VUID-VkBufferMemoryBarrier-buffer-01765"></a>
If <code>buffer</code> was created with a sharing mode of
<code>VK_SHARING_MODE_EXCLUSIVE</code> and <code>dstQueueFamilyIndex</code> is not
<code>VK_QUEUE_FAMILY_IGNORED</code>, it <strong class="purple">must</strong> be a valid queue family or a
special queue family reserved for external memory transfers, as
described in <a href="#synchronization-queue-transfers">Queue Family Ownership Transfer</a>.</p>
</li>
<li>
<p><a id="VUID-VkBufferMemoryBarrier-buffer-01196"></a>
If <code>buffer</code> was created with a sharing mode of
<code>VK_SHARING_MODE_EXCLUSIVE</code>, and <code>srcQueueFamilyIndex</code> and
<code>dstQueueFamilyIndex</code> are not <code>VK_QUEUE_FAMILY_IGNORED</code>, at
least one of them <strong class="purple">must</strong> be the same as the family of the queue that will
execute this barrier</p>
</li>
<li>
<p><a id="VUID-VkBufferMemoryBarrier-buffer-01931"></a>
If <code>buffer</code> is non-sparse then it <strong class="purple">must</strong> be bound completely and
contiguously to a single <code>VkDeviceMemory</code> object</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkBufferMemoryBarrier-sType-sType"></a> <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_BUFFER_MEMORY_BARRIER</code></p>
</li>
<li>
<p><a id="VUID-VkBufferMemoryBarrier-pNext-pNext"></a> <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkBufferMemoryBarrier-srcAccessMask-parameter"></a> <code>srcAccessMask</code> <strong class="purple">must</strong> be a valid combination of <a href="#VkAccessFlagBits">VkAccessFlagBits</a> values</p>
</li>
<li>
<p><a id="VUID-VkBufferMemoryBarrier-dstAccessMask-parameter"></a> <code>dstAccessMask</code> <strong class="purple">must</strong> be a valid combination of <a href="#VkAccessFlagBits">VkAccessFlagBits</a> values</p>
</li>
<li>
<p><a id="VUID-VkBufferMemoryBarrier-buffer-parameter"></a> <code>buffer</code> <strong class="purple">must</strong> be a valid <code>VkBuffer</code> handle</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="synchronization-image-memory-barriers">6.7.3. Image Memory Barriers</h4>
<div class="paragraph">
<p>Image memory barriers only apply to memory accesses involving a specific
image subresource range.
That is, a memory dependency formed from an image memory barrier is
<a href="#synchronization-dependencies-access-scopes">scoped</a> to access via the
specified image subresource range.
Image memory barriers <strong class="purple">can</strong> also be used to define
<a href="#synchronization-image-layout-transitions">image layout transitions</a> or a
<a href="#synchronization-queue-transfers">queue family ownership transfer</a> for the
specified image subresource range.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkImageMemoryBarrier</code> structure is defined as:</p>
</div>
<div id="VkImageMemoryBarrier" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++"><span class="keyword">typedef</span> <span class="keyword">struct</span> VkImageMemoryBarrier {
    VkStructureType            sType;
    <span class="directive">const</span> <span class="directive">void</span>*                pNext;
    VkAccessFlags              srcAccessMask;
    VkAccessFlags              dstAccessMask;
    VkImageLayout              oldLayout;
    VkImageLayout              newLayout;
    uint32_t                   srcQueueFamilyIndex;
    uint32_t                   dstQueueFamilyIndex;
    VkImage                    image;
    VkImageSubresourceRange    subresourceRange;
} VkImageMemoryBarrier;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is the type of this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to an extension-specific structure.</p>
</li>
<li>
<p><code>srcAccessMask</code> is a bitmask of <a href="#VkAccessFlagBits">VkAccessFlagBits</a> specifying a
<a href="#synchronization-access-masks">source access mask</a>.</p>
</li>
<li>
<p><code>dstAccessMask</code> is a bitmask of <a href="#VkAccessFlagBits">VkAccessFlagBits</a> specifying a
<a href="#synchronization-access-masks">destination access mask</a>.</p>
</li>
<li>
<p><code>oldLayout</code> is the old layout in an
<a href="#synchronization-image-layout-transitions">image layout transition</a>.</p>
</li>
<li>
<p><code>newLayout</code> is the new layout in an
<a href="#synchronization-image-layout-transitions">image layout transition</a>.</p>
</li>
<li>
<p><code>srcQueueFamilyIndex</code> is the source queue family for a
<a href="#synchronization-queue-transfers">queue family ownership transfer</a>.</p>
</li>
<li>
<p><code>dstQueueFamilyIndex</code> is the destination queue family for a
<a href="#synchronization-queue-transfers">queue family ownership transfer</a>.</p>
</li>
<li>
<p><code>image</code> is a handle to the image affected by this barrier.</p>
</li>
<li>
<p><code>subresourceRange</code> describes the <a href="chap11.html#resources-image-views">image
subresource range</a> within <code>image</code> that is affected by this barrier.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first <a href="#synchronization-dependencies-access-scopes">access scope</a> is
limited to access to memory through the specified image subresource range,
via access types in the <a href="#synchronization-access-masks">source access mask</a>
specified by <code>srcAccessMask</code>.
If <code>srcAccessMask</code> includes <code>VK_ACCESS_HOST_WRITE_BIT</code>, memory
writes performed by that access type are also made visible, as that access
type is not performed through a resource.</p>
</div>
<div class="paragraph">
<p>The second <a href="#synchronization-dependencies-access-scopes">access scope</a> is
limited to access to memory through the specified image subresource range,
via access types in the <a href="#synchronization-access-masks">destination access
mask</a> specified by <code>dstAccessMask</code>.
If <code>dstAccessMask</code> includes <code>VK_ACCESS_HOST_WRITE_BIT</code> or
<code>VK_ACCESS_HOST_READ_BIT</code>, available memory writes are also made visible
to accesses of those types, as those access types are not performed through
a resource.</p>
</div>
<div class="paragraph">
<p>If <code>srcQueueFamilyIndex</code> is not equal to <code>dstQueueFamilyIndex</code>, and
<code>srcQueueFamilyIndex</code> is equal to the current queue family, then the
memory barrier defines a <a href="#synchronization-queue-transfers-release">queue
family release operation</a> for the specified image subresource range, and
the second access scope includes no access, as if <code>dstAccessMask</code> was
<code>0</code>.</p>
</div>
<div class="paragraph">
<p>If <code>dstQueueFamilyIndex</code> is not equal to <code>srcQueueFamilyIndex</code>, and
<code>dstQueueFamilyIndex</code> is equal to the current queue family, then the
memory barrier defines a <a href="#synchronization-queue-transfers-acquire">queue
family acquire operation</a> for the specified image subresource range, and
the first access scope includes no access, as if <code>srcAccessMask</code> was
<code>0</code>.</p>
</div>
<div class="paragraph">
<p>If <code>oldLayout</code> is not equal to <code>newLayout</code>, then the memory barrier
defines an <a href="#synchronization-image-layout-transitions">image layout
transition</a> for the specified image subresource range.</p>
</div>
<div id="synchronization-image-barrier-layout-transition-order" class="paragraph">
<p>Layout transitions that are performed via image memory barriers execute in
their entirety in <a href="#synchronization-submission-order">submission order</a>,
relative to other image layout transitions submitted to the same queue,
including those performed by <a href="chap7.html#renderpass">render passes</a>.
In effect there is an implicit execution dependency from each such layout
transition to all layout transitions previously submitted to the same queue.</p>
</div>
<div class="paragraph">
<p>If <code>image</code> has a multi-planar format and the image is <em>disjoint</em>, then
including <code>VK_IMAGE_ASPECT_COLOR_BIT</code> in the <code>aspectMask</code> member of
<code>subresourceRange</code> is equivalent to including
<code>VK_IMAGE_ASPECT_PLANE_0_BIT</code>, <code>VK_IMAGE_ASPECT_PLANE_1_BIT</code>, and
(for three-plane formats only) <code>VK_IMAGE_ASPECT_PLANE_2_BIT</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImageMemoryBarrier-oldLayout-01197"></a>
<code>oldLayout</code> <strong class="purple">must</strong> be <code>VK_IMAGE_LAYOUT_UNDEFINED</code> or the current
layout of the image subresources affected by the barrier</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-newLayout-01198"></a>
<code>newLayout</code> <strong class="purple">must</strong> not be <code>VK_IMAGE_LAYOUT_UNDEFINED</code> or
<code>VK_IMAGE_LAYOUT_PREINITIALIZED</code></p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-image-01381"></a>
If <code>image</code> was created with a sharing mode of
<code>VK_SHARING_MODE_CONCURRENT</code>, at least one of
<code>srcQueueFamilyIndex</code> and <code>dstQueueFamilyIndex</code> <strong class="purple">must</strong> be
<code>VK_QUEUE_FAMILY_IGNORED</code></p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-image-01766"></a>
If <code>image</code> was created with a sharing mode of
<code>VK_SHARING_MODE_CONCURRENT</code>, and one of <code>srcQueueFamilyIndex</code>
and <code>dstQueueFamilyIndex</code> is <code>VK_QUEUE_FAMILY_IGNORED</code>, the
other <strong class="purple">must</strong> be <code>VK_QUEUE_FAMILY_IGNORED</code> or a special queue family
reserved for external memory transfers, as described in
<a href="#synchronization-queue-transfers">Queue Family Ownership Transfer</a>.</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-image-01201"></a>
If <code>image</code> was created with a sharing mode of
<code>VK_SHARING_MODE_EXCLUSIVE</code> and <code>srcQueueFamilyIndex</code> is
<code>VK_QUEUE_FAMILY_IGNORED</code>, <code>dstQueueFamilyIndex</code> <strong class="purple">must</strong> also be
<code>VK_QUEUE_FAMILY_IGNORED</code>.</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-image-01767"></a>
If <code>image</code> was created with a sharing mode of
<code>VK_SHARING_MODE_EXCLUSIVE</code> and <code>srcQueueFamilyIndex</code> is not
<code>VK_QUEUE_FAMILY_IGNORED</code>, it <strong class="purple">must</strong> be a valid queue family or a
special queue family reserved for external memory transfers, as
described in <a href="#synchronization-queue-transfers">Queue Family Ownership Transfer</a>.</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-image-01768"></a>
If <code>image</code> was created with a sharing mode of
<code>VK_SHARING_MODE_EXCLUSIVE</code> and <code>dstQueueFamilyIndex</code> is not
<code>VK_QUEUE_FAMILY_IGNORED</code>, it <strong class="purple">must</strong> be a valid queue family or a
special queue family reserved for external memory transfers, as
described in <a href="#synchronization-queue-transfers">Queue Family Ownership Transfer</a>.</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-image-01205"></a>
If <code>image</code> was created with a sharing mode of
<code>VK_SHARING_MODE_EXCLUSIVE</code>, and <code>srcQueueFamilyIndex</code> and
<code>dstQueueFamilyIndex</code> are not <code>VK_QUEUE_FAMILY_IGNORED</code>, at
least one of them <strong class="purple">must</strong> be the same as the family of the queue that will
execute this barrier</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-subresourceRange-01486"></a>
<code>subresourceRange.baseMipLevel</code> <strong class="purple">must</strong> be less than the
<code>mipLevels</code> specified in <a href="chap11.html#VkImageCreateInfo">VkImageCreateInfo</a> when <code>image</code>
was created</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-subresourceRange-01724"></a>
If <code>subresourceRange.levelCount</code> is not
<code>VK_REMAINING_MIP_LEVELS</code>, <span class="eq"><code>subresourceRange.baseMipLevel</code>
+  <code>subresourceRange.levelCount</code></span> <strong class="purple">must</strong> be less than or equal to
the <code>mipLevels</code> specified in <a href="chap11.html#VkImageCreateInfo">VkImageCreateInfo</a> when
<code>image</code> was created</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-subresourceRange-01488"></a>
<code>subresourceRange.baseArrayLayer</code> <strong class="purple">must</strong> be less than the
<code>arrayLayers</code> specified in <a href="chap11.html#VkImageCreateInfo">VkImageCreateInfo</a> when <code>image</code>
was created</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-subresourceRange-01725"></a>
If <code>subresourceRange.layerCount</code> is not
<code>VK_REMAINING_ARRAY_LAYERS</code>,
<span class="eq"><code>subresourceRange.baseArrayLayer</code> + 
<code>subresourceRange.layerCount</code></span> <strong class="purple">must</strong> be less than or equal to the
<code>arrayLayers</code> specified in <a href="chap11.html#VkImageCreateInfo">VkImageCreateInfo</a> when <code>image</code>
was created</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-image-01207"></a>
If <code>image</code> has a depth/stencil format with both depth and stencil
components, then the <code>aspectMask</code> member of <code>subresourceRange</code>
<strong class="purple">must</strong> include both <code>VK_IMAGE_ASPECT_DEPTH_BIT</code> and
<code>VK_IMAGE_ASPECT_STENCIL_BIT</code></p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-image-01671"></a>
If <code>image</code> has a single-plane color format or is not <em>disjoint</em>,
then the <code>aspectMask</code> member of <code>subresourceRange</code> <strong class="purple">must</strong> be
<code>VK_IMAGE_ASPECT_COLOR_BIT</code></p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-image-01672"></a>
If <code>image</code> has a multi-planar format and the image is <em>disjoint</em>,
then the <code>aspectMask</code> member of <code>subresourceRange</code> <strong class="purple">must</strong> include
either at least one of <code>VK_IMAGE_ASPECT_PLANE_0_BIT</code>,
<code>VK_IMAGE_ASPECT_PLANE_1_BIT</code>, and
<code>VK_IMAGE_ASPECT_PLANE_2_BIT</code>; or <strong class="purple">must</strong> include
<code>VK_IMAGE_ASPECT_COLOR_BIT</code></p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-image-01673"></a>
If <code>image</code> has a multi-planar format with only two planes, then the
<code>aspectMask</code> member of <code>subresourceRange</code> <strong class="purple">must</strong> not include
<code>VK_IMAGE_ASPECT_PLANE_2_BIT</code></p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-oldLayout-01208"></a>
If either <code>oldLayout</code> or <code>newLayout</code> is
<code>VK_IMAGE_LAYOUT_COLOR_ATTACHMENT_OPTIMAL</code> then <code>image</code> <strong class="purple">must</strong>
have been created with <code>VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT</code> set</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-oldLayout-01209"></a>
If either <code>oldLayout</code> or <code>newLayout</code> is
<code>VK_IMAGE_LAYOUT_DEPTH_STENCIL_ATTACHMENT_OPTIMAL</code> then <code>image</code>
<strong class="purple">must</strong> have been created with
<code>VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT</code> set</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-oldLayout-01210"></a>
If either <code>oldLayout</code> or <code>newLayout</code> is
<code>VK_IMAGE_LAYOUT_DEPTH_STENCIL_READ_ONLY_OPTIMAL</code> then <code>image</code>
<strong class="purple">must</strong> have been created with
<code>VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT</code> set</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-oldLayout-01658"></a>
If either <code>oldLayout</code> or <code>newLayout</code> is
<code>VK_IMAGE_LAYOUT_DEPTH_READ_ONLY_STENCIL_ATTACHMENT_OPTIMAL</code> then
<code>image</code> <strong class="purple">must</strong> have been created with
<code>VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT</code> set</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-oldLayout-01659"></a>
If either <code>oldLayout</code> or <code>newLayout</code> is
<code>VK_IMAGE_LAYOUT_DEPTH_ATTACHMENT_STENCIL_READ_ONLY_OPTIMAL</code> then
<code>image</code> <strong class="purple">must</strong> have been created with
<code>VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT</code> set</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-oldLayout-01211"></a>
If either <code>oldLayout</code> or <code>newLayout</code> is
<code>VK_IMAGE_LAYOUT_SHADER_READ_ONLY_OPTIMAL</code> then <code>image</code> <strong class="purple">must</strong>
have been created with <code>VK_IMAGE_USAGE_SAMPLED_BIT</code> or
<code>VK_IMAGE_USAGE_INPUT_ATTACHMENT_BIT</code> set</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-oldLayout-01212"></a>
If either <code>oldLayout</code> or <code>newLayout</code> is
<code>VK_IMAGE_LAYOUT_TRANSFER_SRC_OPTIMAL</code> then <code>image</code> <strong class="purple">must</strong> have
been created with <code>VK_IMAGE_USAGE_TRANSFER_SRC_BIT</code> set</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-oldLayout-01213"></a>
If either <code>oldLayout</code> or <code>newLayout</code> is
<code>VK_IMAGE_LAYOUT_TRANSFER_DST_OPTIMAL</code> then <code>image</code> <strong class="purple">must</strong> have
been created with <code>VK_IMAGE_USAGE_TRANSFER_DST_BIT</code> set</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-image-01932"></a>
If <code>image</code> is non-sparse then it <strong class="purple">must</strong> be bound completely and
contiguously to a single <code>VkDeviceMemory</code> object</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkImageMemoryBarrier-sType-sType"></a> <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_IMAGE_MEMORY_BARRIER</code></p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-pNext-pNext"></a> <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-srcAccessMask-parameter"></a> <code>srcAccessMask</code> <strong class="purple">must</strong> be a valid combination of <a href="#VkAccessFlagBits">VkAccessFlagBits</a> values</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-dstAccessMask-parameter"></a> <code>dstAccessMask</code> <strong class="purple">must</strong> be a valid combination of <a href="#VkAccessFlagBits">VkAccessFlagBits</a> values</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-oldLayout-parameter"></a> <code>oldLayout</code> <strong class="purple">must</strong> be a valid <a href="chap11.html#VkImageLayout">VkImageLayout</a> value</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-newLayout-parameter"></a> <code>newLayout</code> <strong class="purple">must</strong> be a valid <a href="chap11.html#VkImageLayout">VkImageLayout</a> value</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-image-parameter"></a> <code>image</code> <strong class="purple">must</strong> be a valid <code>VkImage</code> handle</p>
</li>
<li>
<p><a id="VUID-VkImageMemoryBarrier-subresourceRange-parameter"></a> <code>subresourceRange</code> <strong class="purple">must</strong> be a valid <code>VkImageSubresourceRange</code> structure</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="synchronization-queue-transfers">6.7.4. Queue Family Ownership Transfer</h4>
<div class="paragraph">
<p>Resources created with a <a href="chap11.html#VkSharingMode">VkSharingMode</a> of
<code>VK_SHARING_MODE_EXCLUSIVE</code> <strong class="purple">must</strong> have their ownership explicitly
transferred from one queue family to another in order to access their
content in a well-defined manner on a queue in a different queue family.
Resources shared with external APIs or instances using external memory <strong class="purple">must</strong>
also explicitly manage ownership transfers between local and external queues
(or equivalent constructs in external APIs) regardless of the
<a href="chap11.html#VkSharingMode">VkSharingMode</a> specified when creating them.
The special queue family index <code>VK_QUEUE_FAMILY_EXTERNAL</code> represents any
queue external to the resource’s current Vulkan instance, as long as the
queue uses the same underlying physical device
or device group
and uses the same driver version as the resource’s <a href="chap4.html#VkDevice">VkDevice</a>, as
indicated by <a href="chap4.html#VkPhysicalDeviceIDProperties">VkPhysicalDeviceIDProperties</a>::<code>deviceUUID</code> and
<a href="chap4.html#VkPhysicalDeviceIDProperties">VkPhysicalDeviceIDProperties</a>::<code>driverUUID</code>.
If memory dependencies are correctly expressed between uses of such a
resource between two queues in different families, but no ownership transfer
is defined, the contents of that resource are undefined for any read
accesses performed by the second queue family.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>If an application does not need the contents of a resource to remain valid
when transferring from one queue family to another, then the ownership
transfer <strong class="purple">should</strong> be skipped.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A queue family ownership transfer consists of two distinct parts:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Release exclusive ownership from the source queue family</p>
</li>
<li>
<p>Acquire exclusive ownership for the destination queue family</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>An application <strong class="purple">must</strong> ensure that these operations occur in the correct order
by defining an execution dependency between them, e.g. using a semaphore.</p>
</div>
<div class="paragraph">
<p><a id="synchronization-queue-transfers-release"></a> A <em>release operation</em> is used to
release exclusive ownership of a range of a buffer or image subresource
range.
A release operation is defined by executing a
<a href="#synchronization-buffer-memory-barriers">buffer memory barrier</a> (for a
buffer range) or an <a href="#synchronization-image-memory-barriers">image memory
barrier</a> (for an image subresource range), on a queue from the source queue
family.
The <code>srcQueueFamilyIndex</code> parameter of the barrier <strong class="purple">must</strong> be set to the
source queue family index, and the <code>dstQueueFamilyIndex</code> parameter to
the destination queue family index.
<code>dstStageMask</code> is ignored for such a barrier, such that no visibility
operation is executed - the value of this mask does not affect the validity
of the barrier.
The release operation happens-after the availability operation.</p>
</div>
<div class="paragraph">
<p><a id="synchronization-queue-transfers-acquire"></a> An <em>acquire operation</em> is used
to acquire exclusive ownership of a range of a buffer or image subresource
range.
An acquire operation is defined by executing a
<a href="#synchronization-buffer-memory-barriers">buffer memory barrier</a> (for a
buffer range) or an <a href="#synchronization-image-memory-barriers">image memory
barrier</a> (for an image subresource range), on a queue from the destination
queue family.
The buffer range or image subresource range specified in an acquire
operation <strong class="purple">must</strong> match exactly that of a previous release operation.
The <code>srcQueueFamilyIndex</code> parameter of the barrier <strong class="purple">must</strong> be set to the
source queue family index, and the <code>dstQueueFamilyIndex</code> parameter to
the destination queue family index.
<code>srcStageMask</code> is ignored for such a barrier, such that no availability
operation is executed - the value of this mask does not affect the validity
of the barrier.
The acquire operation happens-before the visibility operation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Whilst it is not invalid to provide destination or source access masks for
memory barriers used for release or acquire operations, respectively, they
have no practical effect.
Access after a release operation has undefined results, and so visibility
for those accesses has no practical effect.
Similarly, write access before an acquire operation will produce undefined
results for future access, so availability of those writes has no practical
use.
In an earlier version of the specification, these were required to match on
both sides - but this was subsequently relaxed.
These masks <strong class="purple">should</strong> be set to 0.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the transfer is via an image memory barrier, and an
<a href="#synchronization-image-layout-transitions">image layout transition</a> is
desired, then the values of <code>oldLayout</code> and <code>newLayout</code> in the
release memory barrier <strong class="purple">must</strong> be equal to values of <code>oldLayout</code> and
<code>newLayout</code> in the acquire memory barrier.
Although the image layout transition is submitted twice, it will only be
executed once.
A layout transition specified in this way happens-after the release
operation and happens-before the acquire operation.</p>
</div>
<div class="paragraph">
<p>If the values of <code>srcQueueFamilyIndex</code> and <code>dstQueueFamilyIndex</code> are
equal, no ownership transfer is performed, and the barrier operates as if
they were both set to <code>VK_QUEUE_FAMILY_IGNORED</code>.</p>
</div>
<div class="paragraph">
<p>Queue family ownership transfers <strong class="purple">may</strong> perform read and write accesses on all
memory bound to the image subresource or buffer range, so applications <strong class="purple">must</strong>
ensure that all memory writes have been made
<a href="#synchronization-dependencies-available-and-visible">available</a> before a
queue family ownership transfer is executed.
Available memory is automatically made visible to queue family release and
acquire operations, and writes performed by those operations are
automatically made available.</p>
</div>
<div class="paragraph">
<p>Once a queue family has acquired ownership of a buffer range or image
subresource range of an <code>VK_SHARING_MODE_EXCLUSIVE</code> resource, its
contents are undefined to other queue families unless ownership is
transferred.
The contents of any portion of another resource which aliases memory that is
bound to the transferred buffer or image subresource range are undefined
after a release or acquire operation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="synchronization-wait-idle">6.8. Wait Idle Operations</h3>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To wait on the host for the completion of outstanding queue operations for a
given queue, call:</p>
</div>
<div id="vkQueueWaitIdle" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VkResult vkQueueWaitIdle(
    VkQueue                                     queue);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>queue</code> is the queue on which to wait.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>vkQueueWaitIdle</code> is equivalent to submitting a fence to a queue and
waiting with an infinite timeout for that fence to signal.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkQueueWaitIdle-queue-parameter"></a> <code>queue</code> <strong class="purple">must</strong> be a valid <code>VkQueue</code> handle</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>queue</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="chap5.html#VkCommandBufferLevel">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="chap7.html#vkCmdBeginRenderPass">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap4.html#VkQueueFlagBits">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="#synchronization-pipeline-stages-types">Pipeline Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap2.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap2.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_DEVICE_LOST</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To wait on the host for the completion of outstanding queue operations for
all queues on a given logical device, call:</p>
</div>
<div id="vkDeviceWaitIdle" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c++">VkResult vkDeviceWaitIdle(
    VkDevice                                    device);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device to idle.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>vkDeviceWaitIdle</code> is equivalent to calling <code>vkQueueWaitIdle</code> for
all queues owned by <code>device</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkDeviceWaitIdle-device-parameter"></a> <code>device</code> <strong class="purple">must</strong> be a valid <code>VkDevice</code> handle</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to all <code>VkQueue</code> objects created from <code>device</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap2.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap2.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_DEVICE_LOST</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="synchronization-submission-host-writes">6.9. Host Write Ordering Guarantees</h3>
<div class="paragraph">
<p>When batches of command buffers are submitted to a queue via
<a href="chap5.html#vkQueueSubmit">vkQueueSubmit</a>, it defines a memory dependency with prior host
operations, and execution of command buffers submitted to the queue.</p>
</div>
<div class="paragraph">
<p>The first <a href="#synchronization-dependencies-scopes">synchronization scope</a> is
defined by the host execution model, but includes execution of
<a href="chap5.html#vkQueueSubmit">vkQueueSubmit</a> on the host and anything that happened-before it.</p>
</div>
<div class="paragraph">
<p>The second <a href="#synchronization-dependencies-scopes">synchronization scope</a>
includes all commands submitted in the same <a href="chap4.html#devsandqueues-submission">queue submission</a>, and all commands that occur later in
<a href="#synchronization-submission-order">submission order</a>.</p>
</div>
<div class="paragraph">
<p>The first <a href="#synchronization-dependencies-access-scopes">access scope</a>
includes all host writes to mappable device memory that are available to the
host memory domain.</p>
</div>
<div class="paragraph">
<p>The second <a href="#synchronization-dependencies-access-scopes">access scope</a>
includes all memory access performed by the device.</p>
</div>
</div>
<div class="sect2">
<h3 id="synchronization-device-group">6.10. Synchronization and Multiple Physical Devices</h3>
<div class="paragraph">
<p>If a logical device includes more than one physical device, then fences,
semaphores, and events all still have a single instance of the signaled
state.</p>
</div>
<div class="paragraph">
<p>A fence becomes signaled when all physical devices complete the necessary
queue operations.</p>
</div>
<div class="paragraph">
<p>Semaphore wait and signal operations all include a device index that is the
sole physical device that performs the operation.
These indices are provided in the <a href="chap5.html#VkDeviceGroupSubmitInfo">VkDeviceGroupSubmitInfo</a> and
<a href="chap28.html#VkDeviceGroupBindSparseInfo">VkDeviceGroupBindSparseInfo</a> structures.
Semaphores are not exclusively owned by any physical device.
For example, a semaphore can be signaled by one physical device and then
waited on by a different physical device.</p>
</div>
<div class="paragraph">
<p>An event <strong class="purple">can</strong> only be waited on by the same physical device that signaled it
(or the host).</p>
</div>
</div>
</div>
</div></div>
<div id="footer">
<div id="footer-text">
Version 1.1.111<br>
Last updated 2019-03-03 21:04:48 -0800
</div>
</div>


</body>
</html>