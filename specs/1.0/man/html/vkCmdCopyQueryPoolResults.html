<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>vkCmdCopyQueryPoolResults</title><link rel="stylesheet" type="text/css" href="vkman.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /></head><body><div xml:lang="en" class="refentry" lang="en"><a id="id-1"></a><div class="titlepage"></div><div class="refnamediv"><h2>Name</h2><p>vkCmdCopyQueryPoolResults — Copy the results of queries in a query pool to a buffer object.</p></div><div class="refsect1"><a id="_c_specification"></a><h2>C Specification</h2><p>To copy query statuses and numerical results directly to buffer memory,
call:</p><pre class="programlisting">void vkCmdCopyQueryPoolResults(
    VkCommandBuffer                             commandBuffer,
    VkQueryPool                                 queryPool,
    uint32_t                                    firstQuery,
    uint32_t                                    queryCount,
    VkBuffer                                    dstBuffer,
    VkDeviceSize                                dstOffset,
    VkDeviceSize                                stride,
    VkQueryResultFlags                          flags);</pre></div><div class="refsect1"><a id="_parameters"></a><h2>Parameters</h2><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>commandBuffer</code></em> is the command buffer into which this command will
    be recorded.
</li><li class="listitem">
<em class="parameter"><code>queryPool</code></em> is the query pool managing the queries containing the
    desired results.
</li><li class="listitem">
<em class="parameter"><code>firstQuery</code></em> is the initial query index.
</li><li class="listitem">
<em class="parameter"><code>queryCount</code></em> is the number of queries. <em class="parameter"><code>firstQuery</code></em> and
    <em class="parameter"><code>queryCount</code></em> together define a range of queries.
</li><li class="listitem">
<em class="parameter"><code>dstBuffer</code></em> is a <code class="code">VkBuffer</code> object that will receive the results
    of the copy command.
</li><li class="listitem">
<em class="parameter"><code>dstOffset</code></em> is an offset into <em class="parameter"><code>dstBuffer</code></em>.
</li><li class="listitem">
<em class="parameter"><code>stride</code></em> is the stride in bytes between results for individual
    queries within <em class="parameter"><code>dstBuffer</code></em>. The required size of the backing memory
    for <em class="parameter"><code>dstBuffer</code></em> is determined as described above for
    <code class="code"><a class="link" href="#">vkGetQueryPoolResults</a></code>.
</li><li class="listitem">
<em class="parameter"><code>flags</code></em> is a bitmask of <code class="code"><a class="link" href="#">VkQueryResultFlagBits</a></code> specifying how
    and when results are returned.
</li></ul></div></div><div class="refsect1"><a id="_description"></a><h2>Description</h2><p><span class="strong"><strong><code class="code">vkCmdCopyQueryPoolResults</code></strong></span> is guaranteed to see the effect of previous
uses of <span class="strong"><strong><code class="code">vkCmdResetQueryPool</code></strong></span> in the same queue, without any additional
synchronization. Thus, the results will always reflect the most
recent use of the query.</p><p><em class="parameter"><code>flags</code></em> has the same possible values described above for the <em class="parameter"><code>flags</code></em>
parameter of <code class="code"><a class="link" href="#">vkGetQueryPoolResults</a></code>, but the different style of
execution causes some subtle behavioral differences. Because
<span class="strong"><strong><code class="code">vkCmdCopyQueryPoolResults</code></strong></span> executes in order with respect to other
query commands, there is less ambiguity about which use of a query is being
requested.</p><p>If no bits are set in <em class="parameter"><code>flags</code></em>, results for all requested queries in the
available state are written as 32-bit unsigned integer values, and nothing
is written for queries in the unavailable state.</p><p>If <code class="code">VK_QUERY_RESULT_64_BIT</code> is set, the results are written as an array
of 64-bit unsigned integer values as described for
<code class="code"><a class="link" href="#">vkGetQueryPoolResults</a></code>.</p><p>If <code class="code">VK_QUERY_RESULT_WAIT_BIT</code> is set, the implementation will wait for
each query’s status to be in the available state before retrieving the
numerical results for that query. This is guaranteed to reflect the most
recent use of the query on the same queue, assuming that the query is
not being simultaneously used by other queues. If the query does not become
available in a finite amount of time (e.g. due to not issuing a query
since the last reset), a <code class="code">VK_ERROR_DEVICE_LOST</code> error <span class="normative">may</span> occur.</p><p>Similarly, if <code class="code">VK_QUERY_RESULT_WITH_AVAILABILITY_BIT</code> is set and
<code class="code">VK_QUERY_RESULT_WAIT_BIT</code> is not set, the availability is guaranteed to
reflect the most recent use of the query on the same queue, assuming
that the query is not being simultaneously used by other queues. As with
<span class="strong"><strong><code class="code">vkGetQueryPoolResults</code></strong></span>, implementations <span class="normative">must</span> guarantee that if they
return a non-zero availability value, then the numerical results are valid.</p><p>If <code class="code">VK_QUERY_RESULT_PARTIAL_BIT</code> is set, <code class="code">VK_QUERY_RESULT_WAIT_BIT</code>
is not set, and the query’s status is unavailable, an intermediate
result value between zero and the final result value is written for that
query.</p><p><code class="code">VK_QUERY_RESULT_PARTIAL_BIT</code> <span class="normative">must not</span> be used if the pool’s
<em class="parameter"><code>queryType</code></em> is <code class="code">VK_QUERY_TYPE_TIMESTAMP</code>.</p><p><span class="strong"><strong><code class="code">vkCmdCopyQueryPoolResults</code></strong></span> is considered to be a transfer operation,
and its writes to buffer memory <span class="normative">must</span> be synchronized using
<code class="code">VK_PIPELINE_STAGE_TRANSFER_BIT</code> and
<code class="code">VK_ACCESS_TRANSFER_WRITE_BIT</code> before using the results.</p></div><div class="refsect1"><a id="_valid_usage"></a><h2>Valid Usage</h2><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<em class="parameter"><code>commandBuffer</code></em> <span class="normative">must</span> be a valid <code class="code">VkCommandBuffer</code> handle
</li><li class="listitem">
<em class="parameter"><code>queryPool</code></em> <span class="normative">must</span> be a valid <code class="code">VkQueryPool</code> handle
</li><li class="listitem">
<em class="parameter"><code>dstBuffer</code></em> <span class="normative">must</span> be a valid <code class="code">VkBuffer</code> handle
</li><li class="listitem">
<em class="parameter"><code>flags</code></em> <span class="normative">must</span> be a valid combination of <code class="code"><a class="link" href="#">VkQueryResultFlagBits</a></code> values
</li><li class="listitem">
<em class="parameter"><code>commandBuffer</code></em> <span class="normative">must</span> be in the recording state
</li><li class="listitem">
The <code class="code">VkCommandPool</code> that <em class="parameter"><code>commandBuffer</code></em> was allocated from <span class="normative">must</span> support graphics or compute operations
</li><li class="listitem">
This command <span class="normative">must</span> only be called outside of a render pass instance
</li><li class="listitem">
Each of <em class="parameter"><code>commandBuffer</code></em>, <em class="parameter"><code>queryPool</code></em> and <em class="parameter"><code>dstBuffer</code></em> <span class="normative">must</span> have been created, allocated or retrieved from the same <code class="code">VkDevice</code>
</li><li class="listitem">
<em class="parameter"><code>dstOffset</code></em> <span class="normative">must</span> be less than the size of <em class="parameter"><code>dstBuffer</code></em>
</li><li class="listitem">
<em class="parameter"><code>firstQuery</code></em> <span class="normative">must</span> be less than the number of queries in <em class="parameter"><code>queryPool</code></em>
</li><li class="listitem">
The sum of <em class="parameter"><code>firstQuery</code></em> and <em class="parameter"><code>queryCount</code></em> <span class="normative">must</span> be less than or equal to the number of queries in <em class="parameter"><code>queryPool</code></em>
</li><li class="listitem">
If <code class="code">VK_QUERY_RESULT_64_BIT</code> is not set in <em class="parameter"><code>flags</code></em> then <em class="parameter"><code>dstOffset</code></em> and <em class="parameter"><code>stride</code></em> <span class="normative">must</span> be multiples of <code class="literal">4</code>
</li><li class="listitem">
If <code class="code">VK_QUERY_RESULT_64_BIT</code> is set in <em class="parameter"><code>flags</code></em> then <em class="parameter"><code>dstOffset</code></em> and <em class="parameter"><code>stride</code></em> <span class="normative">must</span> be multiples of <code class="literal">8</code>
</li><li class="listitem">
<em class="parameter"><code>dstBuffer</code></em> <span class="normative">must</span> have enough storage, from <em class="parameter"><code>dstOffset</code></em>, to contain the result of each query, as described <a class="link" href="#">here</a>
</li><li class="listitem">
<em class="parameter"><code>dstBuffer</code></em> <span class="normative">must</span> have been created with <code class="code">VK_BUFFER_USAGE_TRANSFER_DST_BIT</code> usage flag
</li><li class="listitem">
If the <em class="parameter"><code>queryType</code></em> used to create <em class="parameter"><code>queryPool</code></em> was <code class="code">VK_QUERY_TYPE_TIMESTAMP</code>, <em class="parameter"><code>flags</code></em> <span class="normative">must not</span> contain <code class="code">VK_QUERY_RESULT_PARTIAL_BIT</code>
</li></ul></div></div><div class="refsect1"><a id="_host_synchronization"></a><h2>Host Synchronization</h2><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Host access to <em class="parameter"><code>commandBuffer</code></em> <span class="normative">must</span> be externally synchronized
</li></ul></div></div><div class="refsect1"><a id="_command_properties"></a><h2>Command Properties</h2><div class="informaltable"><table cellpadding="4px" style="border-collapse: collapse;border-top: 3px solid #527bbd; border-bottom: 3px solid #527bbd; border-left: 3px solid #527bbd; border-right: 3px solid #527bbd; " width="100%"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /></colgroup><thead><tr><th style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top">Command Buffer Levels</th><th style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top">Render Pass Scope</th><th style="border-bottom: 1px solid #527bbd; " align="left" valign="top">Supported Queue Types</th></tr></thead><tbody><tr><td style="border-right: 1px solid #527bbd; " align="left" valign="top"><p>Primary
Secondary</p></td><td style="border-right: 1px solid #527bbd; " align="left" valign="top"><p>Outside</p></td><td style="" align="left" valign="top"><p>GRAPHICS
COMPUTE</p></td></tr></tbody></table></div></div><div class="refsect1"><a id="_see_also"></a><h2>See Also</h2><p><code class="code"><a class="link" href="#">VkBuffer</a></code>, <code class="code"><a class="link" href="#">VkCommandBuffer</a></code>, basetypes:VkDeviceSize, <code class="code"><a class="link" href="#">VkQueryPool</a></code>, <code class="code"><a class="link" href="#">VkQueryResultFlags</a></code></p></div><div class="refsect1"><a id="_document_notes"></a><h2>Document Notes</h2><p>For more information, see the Vulkan Specification at URL</p><p><a class="ulink" href="https://www.khronos.org/registry/vulkan/specs/1.0/xhtml/vkspec.html#vkCmdCopyQueryPoolResults" target="_top">https://www.khronos.org/registry/vulkan/specs/1.0/xhtml/vkspec.html#vkCmdCopyQueryPoolResults</a></p><p>This page is extracted from the Vulkan Specification.
Fixes and changes should be made to the Specification,not directly.</p></div><div class="refsect1"><a id="_copyright"></a><h2>Copyright</h2><p>Copyright (c) 2014-2016 Khronos Group. This work is licensed under a
<a class="ulink" href="http://creativecommons.org/licenses/by/4.0/" target="_top">Creative Commons
Attribution 4.0 International License</a>.</p></div></div></body></html>